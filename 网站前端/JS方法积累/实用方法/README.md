# JSå®ç”¨æ–¹æ³•

## ç›®å½•
1. æ ¹æ®UAæˆ–æµè§ˆå™¨ç‰¹æ€§åˆ¤æ–­

    1. [åˆ¤æ–­æ‰€åœ¨ç³»ç»Ÿ](#åŸç”Ÿjsåˆ¤æ–­æ‰€åœ¨ç³»ç»Ÿ)
    1. [åˆ¤æ–­Androidç‰ˆæœ¬å·](#åŸç”Ÿjsåˆ¤æ–­androidç‰ˆæœ¬å·)
    1. [åˆ¤æ–­iOSç‰ˆæœ¬å·](#åŸç”Ÿjsåˆ¤æ–­iosç‰ˆæœ¬å·)
    1. [åˆ¤æ–­ç§»åŠ¨å¹³å°](#åŸç”Ÿjsåˆ¤æ–­ç§»åŠ¨å¹³å°)
    1. [åˆ¤æ–­ie6ã€7ã€8ã€9ç‰ˆæœ¬](#åŸç”Ÿjsåˆ¤æ–­ie6789ç‰ˆæœ¬)
    1. [åˆ¤æ–­ieæ‰€æœ‰ç‰ˆæœ¬](#åŸç”Ÿjsåˆ¤æ–­ieæ‰€æœ‰ç‰ˆæœ¬)
1. `é”®-å€¼`æ“ä½œ

    1. [åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŸcookie](#åŸç”Ÿjsåˆ¤æ–­æ˜¯å¦å­˜åœ¨æŸcookie)
    1. [è·å–URLç›¸å…³ä¿¡æ¯](#åŸç”Ÿjsè·å–urlç›¸å…³ä¿¡æ¯)
    1. [åœ¨URLæœ«å°¾ä¿®æ”¹searché”®-å€¼](#åŸç”Ÿjsåœ¨urlæœ«å°¾ä¿®æ”¹searché”®-å€¼)
1. äº‹ä»¶ç›¸å…³

    1. [ç»‘å®šã€è§£ç»‘äº‹ä»¶](#åŸç”Ÿjsç»‘å®šè§£ç»‘äº‹ä»¶)
    1. [é˜»æ­¢å†’æ³¡å’Œé˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸º](#åŸç”Ÿjsjqueryé˜»æ­¢å†’æ³¡å’Œé˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸º)
    1. [äº‹ä»¶ä»£ç†](#åŸç”Ÿjsäº‹ä»¶ä»£ç†)
    1. [å®ç°åˆ¤æ–­æŒ‰ä¸‹å…·ä½“æŸæŒ‰é”®](#åŸç”Ÿjsjqueryå®ç°åˆ¤æ–­æŒ‰ä¸‹å…·ä½“æŸæŒ‰é”®)
    1. [æ‹–æ‹½å’Œæ”¾ä¸‹](#åŸç”Ÿjsæ‹–æ‹½å’Œæ”¾ä¸‹)
    1. [è§¦æ‘¸å±æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶ï¼ˆæ¶ˆé™¤ã€Œå»¶æ—¶300æ¯«ç§’åæ‰è§¦å‘clickäº‹ä»¶ã€ï¼Œä½¿ç‚¹å‡»äº‹ä»¶æå‰è§¦å‘ï¼‰](#åŸç”Ÿjsè§¦æ‘¸å±æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶æ¶ˆé™¤å»¶æ—¶300æ¯«ç§’åæ‰è§¦å‘clickäº‹ä»¶ä½¿ç‚¹å‡»äº‹ä»¶æå‰è§¦å‘)
    1. [åˆ¤æ–­äº‹ä»¶åœ¨æµè§ˆå™¨æ˜¯å¦å­˜åœ¨](#åŸç”Ÿjsåˆ¤æ–­äº‹ä»¶åœ¨æµè§ˆå™¨æ˜¯å¦å­˜åœ¨)
    1. [æ ¹æ®æ»šåŠ¨æ–¹å‘æ‰§è¡Œå‡½æ•°](#åŸç”Ÿjsæ ¹æ®æ»šåŠ¨æ–¹å‘æ‰§è¡Œå‡½æ•°)
1. æ•°å­—æ“ä½œ

    1. [ç§‘å­¦è®¡æ•°æ³•è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ•°å­—](#åŸç”Ÿjsç§‘å­¦è®¡æ•°æ³•è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ•°å­—)
    1. [ä¸åŒè¿›åˆ¶æ•°äº’ç›¸è½¬æ¢](#åŸç”Ÿjsä¸åŒè¿›åˆ¶æ•°äº’ç›¸è½¬æ¢)
    1. [é€‰å–èŒƒå›´å†…éšæœºå€¼](#åŸç”Ÿjsé€‰å–èŒƒå›´å†…éšæœºå€¼)
    1. [é€‰å–èŒƒå›´å†…å¤šä¸ªéšæœºå€¼](#åŸç”Ÿjsé€‰å–èŒƒå›´å†…å¤šä¸ªéšæœºå€¼)
    1. [é˜¿æ‹‰ä¼¯æ•°å­—è½¬ä¸­æ–‡](#åŸç”Ÿjsé˜¿æ‹‰ä¼¯æ•°å­—è½¬ä¸­æ–‡)
1. å­—ç¬¦ä¸²æ“ä½œ

    1. [è½¬åŒ–ä¸ºUnicodeã€åè½¬å­—ç¬¦ä¸²ã€å­—ç¬¦ä¸²é•¿åº¦ã€æ‰€å å­—èŠ‚æ•°](#åŸç”Ÿjsè½¬åŒ–ä¸ºunicodeåè½¬å­—ç¬¦ä¸²å­—ç¬¦ä¸²é•¿åº¦æ‰€å å­—èŠ‚æ•°)
    1. [å­—ç¬¦ä¸²åŒ¹é…ã€æ›¿æ¢](#åŸç”Ÿjså­—ç¬¦ä¸²åŒ¹é…æ›¿æ¢)
    1. [åˆ†å‰²å­—ç¬¦ä¸²](#åŸç”Ÿjsåˆ†å‰²å­—ç¬¦ä¸²)
    1. [æ•°å­—å¢åŠ åˆ†éš”ç¬¦](#åŸç”Ÿjsæ•°å­—å¢åŠ åˆ†éš”ç¬¦)
    1. [äº§ç”Ÿéšæœºæ•°](#åŸç”Ÿjsäº§ç”Ÿéšæœºæ•°)
    1. [åˆ¤æ–­ç‰ˆæœ¬å·æ˜¯å¦åœ¨æŸä¸ªç‰ˆæœ¬åŒºé—´ï¼ˆçº¯æ•°å­—ï¼‰](#åŸç”Ÿjsåˆ¤æ–­ç‰ˆæœ¬å·æ˜¯å¦åœ¨æŸä¸ªç‰ˆæœ¬åŒºé—´çº¯æ•°å­—)
    1. [åˆ¤æ–­æ£€ç´¢å†…å®¹æ˜¯å¦åœ¨è¢«æ£€ç´¢å†…å®¹çš„åˆ†éš”ç¬¦é—´](#åŸç”Ÿjsåˆ¤æ–­æ£€ç´¢å†…å®¹æ˜¯å¦åœ¨è¢«æ£€ç´¢å†…å®¹çš„åˆ†éš”ç¬¦é—´)
    1. [æ ¼å¼åŒ–æ–‡ä»¶å¤§å°](#åŸç”Ÿjsæ ¼å¼åŒ–æ–‡ä»¶å¤§å°)
    1. [å•è¯é¦–å­—æ¯å¤§å†™](#åŸç”Ÿjså•è¯é¦–å­—æ¯å¤§å†™)
    1. [æ–‡ä»¶æ‰©å±•å](#åŸç”Ÿjsæ–‡ä»¶æ‰©å±•å)
1. æ•°ç»„æ“ä½œ

    1. [æ•°ç»„å»é‡ï¼ˆé¡¹ä¸ºå¯¹è±¡ï¼‰](#åŸç”Ÿjsæ•°ç»„å»é‡é¡¹ä¸ºå¯¹è±¡)
    1. [æ•°ç»„å»é‡](#æ•°ç»„å»é‡)
    1. [æ•°ç»„åˆ å»æŸå€¼](#æ•°ç»„åˆ å»æŸå€¼)
    1. [æ•°ç»„çš„æŸé¡¹æ’å…¥æŸä½ç½®](#æ•°ç»„çš„æŸé¡¹æ’å…¥æŸä½ç½®)
    1. [å£°æ˜æŸé•¿åº¦å¹¶è®¾å®šå€¼çš„æ•°ç»„](#å£°æ˜æŸé•¿åº¦å¹¶è®¾å®šå€¼çš„æ•°ç»„)
1. åŠŸèƒ½

    1. [ç”¨è¯·æ±‚å›¾ç‰‡ä½œlogç»Ÿè®¡](#åŸç”Ÿjsç”¨è¯·æ±‚å›¾ç‰‡ä½œlogç»Ÿè®¡)
    1. [éªŒè¯é‚®ç®±æœ‰æ•ˆæ€§](#åŸç”ŸjséªŒè¯é‚®ç®±æœ‰æ•ˆæ€§)
    1. [åˆ›å»ºå…¼å®¹çš„XHRå¯¹è±¡](#åŸç”Ÿjsåˆ›å»ºå…¼å®¹çš„xhrå¯¹è±¡)
    1. [åŠ¨æ€æ·»åŠ è„šæœ¬ã€æ ·å¼](#åŸç”ŸjsåŠ¨æ€æ·»åŠ è„šæœ¬æ ·å¼)
    1. [è·å–æ˜Ÿåº§](#åŸç”Ÿjsè·å–æ˜Ÿåº§)
    1. [åŠ å…¥æ”¶è—å¤¹](#åŸç”ŸjsåŠ å…¥æ”¶è—å¤¹)
    1. [ä»å­—ç¬¦ä¸²ä¸­è·å–ç»å¯¹è·¯å¾„](#åŸç”Ÿjsä»å­—ç¬¦ä¸²ä¸­è·å–ç»å¯¹è·¯å¾„)
    1. [ä¸ä¼ é€’è¯·æ±‚å¤´çš„Referrerè¿›è¡Œè·³è½¬](#åŸç”Ÿjsä¸ä¼ é€’è¯·æ±‚å¤´çš„referrerè¿›è¡Œè·³è½¬)
    1. [æ ¼å¼åŒ–æ¥å£è¿”å›çš„æ•°æ®](#åŸç”Ÿjsæ ¼å¼åŒ–æ¥å£è¿”å›çš„æ•°æ®)
    1. [åˆ¤æ–­æ˜¯å¦æ”¯æŒWebP](#åŸç”Ÿjsåˆ¤æ–­æ˜¯å¦æ”¯æŒwebp)
    1. [æ‰§è¡Œæ–¹æ³•çš„å‰/åè¿›è¡Œå¼€/å…³loading](#åŸç”Ÿjsæ‰§è¡Œæ–¹æ³•çš„å‰åè¿›è¡Œå¼€å…³loading)
    1. [ç‚¹å‡»ä¸‹è½½](#åŸç”Ÿjsç‚¹å‡»ä¸‹è½½)
    1. [å†™å…¥å‰ªåˆ‡æ¿](#åŸç”Ÿjså†™å…¥å‰ªåˆ‡æ¿)
    1. [Reactç»„ä»¶ä¸šåŠ¡ç±»ä¼¼Promise.allçš„æ•ˆæœ](#reactç»„ä»¶ä¸šåŠ¡ç±»ä¼¼promiseallçš„æ•ˆæœ)
    1. [åˆ¤æ–­æ˜¯å¦æœ‰å¾ªç¯å¼•ç”¨](#åŸç”Ÿjsåˆ¤æ–­æ˜¯å¦æœ‰å¾ªç¯å¼•ç”¨)
1. DOMç›¸å…³

    1. [DOMå±•ç¤ºæˆ–æ¶ˆå¤±æ‰§è¡Œæ–¹æ³•ï¼ˆIntersectionObserverï¼‰](#åŸç”Ÿjsdomå±•ç¤ºæˆ–æ¶ˆå¤±æ‰§è¡Œæ–¹æ³•intersectionobserver)
    1. [åˆ¤æ–­æ˜¯å¦ä¸º`Node`ã€æ˜¯å¦ä¸º`Element`](#åŸç”Ÿjsåˆ¤æ–­æ˜¯å¦ä¸ºnodeæ˜¯å¦ä¸ºelement)
    1. [è¾“å…¥æ¡†å…‰æ ‡ä½ç½®çš„è·å–å’Œè®¾ç½®](#åŸç”Ÿjsè¾“å…¥æ¡†å…‰æ ‡ä½ç½®çš„è·å–å’Œè®¾ç½®)
    1. [æ–‡æœ¬é€‰åŒºè¦†ç›–æŸDOMçš„æ–‡æœ¬èŒƒå›´](#åŸç”Ÿjsæ–‡æœ¬é€‰åŒºè¦†ç›–æŸdomçš„æ–‡æœ¬èŒƒå›´)
    1. [é’ˆå¯¹WAPçš„é˜»æ­¢æ»šåŠ¨å†’æ³¡ï¼ˆä»…DOMï¼‰](#åŸç”Ÿjsé’ˆå¯¹wapçš„é˜»æ­¢æ»šåŠ¨å†’æ³¡ä»…dom)
    1. [è·å–æ»šåŠ¨æ¡å®½åº¦ï¼ˆæˆ–é«˜åº¦ï¼‰](#åŸç”Ÿjsè·å–æ»šåŠ¨æ¡å®½åº¦æˆ–é«˜åº¦)
    1. [å±•ç¤ºé¡µé¢å¸§æ•°](#åŸç”Ÿjså±•ç¤ºé¡µé¢å¸§æ•°)
    1. [é»˜è®¤å›¾ç»„ä»¶](#reacté»˜è®¤å›¾ç»„ä»¶)
    1. [æº¢å‡ºæ–‡æœ¬çš„çœç•¥](#åŸç”Ÿjsæº¢å‡ºæ–‡æœ¬çš„çœç•¥)
    1. [ä¹å®«æ ¼æŠ½å¥–](#ä¹å®«æ ¼æŠ½å¥–)
1. ä»»åŠ¡æ‰§è¡Œ

    1. [sleep](#sleep)
    1. [è½®è¯¢](#åŸç”Ÿjsè½®è¯¢)
    1. [èŠ‚æµå‡½æ•°](#åŸç”ŸjsèŠ‚æµå‡½æ•°)
    1. [ç”¨`setTimeout`æ¨¡æ‹Ÿ`setInterval`](#åŸç”Ÿjsç”¨settimeoutæ¨¡æ‹Ÿsetinterval)
    1. [`requestAnimationFrame`çš„é€’å½’](#åŸç”Ÿjsrequestanimationframeçš„é€’å½’)
    1. [`requestAnimationFrame`æ¨¡æ‹Ÿ`setTimeout`å’Œ`setInterval`](#åŸç”Ÿjsrequestanimationframeæ¨¡æ‹Ÿsettimeoutå’Œsetinterval)
1. ç®—æ³•æ€è·¯

    1. [åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºç©º](#åŸç”Ÿjsåˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºç©º)
    1. [æ— ç¼è½®æ’­](#æ— ç¼è½®æ’­)
    1. [è·å–æŸä¸€ä½çš„æ•°å­—](#è·å–æŸä¸€ä½çš„æ•°å­—)
1. Node.jsç›¸å…³

    1. [ç¡®ä¿æ–‡ä»¶å¤¹å­˜åœ¨](#ç¡®ä¿æ–‡ä»¶å¤¹å­˜åœ¨)
1. <details>

    <summary>jQueryæ–¹æ³•</summary>

    1. å»¶è¿Ÿå¼‚æ­¥åŠ è½½

        1. [æ»šåŠ¨åŠ è½½](#jqueryæ»šåŠ¨åŠ è½½)
        1. [å›¾ç‰‡å»¶æ—¶åŠ è½½ï¼ˆlazyloadï¼‰](#jqueryå›¾ç‰‡å»¶æ—¶åŠ è½½lazyload)
    1. [èŠ‚ç‚¹è·Ÿéšå±å¹•æ»šåŠ¨è€Œç›¸å¯¹é™æ­¢](#jqueryèŠ‚ç‚¹è·Ÿéšå±å¹•æ»šåŠ¨è€Œç›¸å¯¹é™æ­¢)
    1. [å¼¹å‡ºtoast](#jqueryå¼¹å‡ºtoast)
    1. [å…¨é€‰ã€å–æ¶ˆå…¨é€‰](#jqueryå…¨é€‰å–æ¶ˆå…¨é€‰)
    1. [ç‚¹å‡»æŒ‡å®šåŒºåŸŸä»¥å¤–æ‰§è¡Œå‡½æ•°](#jqueryç‚¹å‡»æŒ‡å®šåŒºåŸŸä»¥å¤–æ‰§è¡Œå‡½æ•°)
    1. [hoverå±•ç¤ºå†…å®¹å¹¶ä¸”å¯è·¨è¶Šé—´éš™åˆ°å†…å®¹](#jquery-hoverå±•ç¤ºå†…å®¹å¹¶ä¸”å¯è·¨è¶Šé—´éš™åˆ°å†…å®¹)
    1. [å¯åŠ¨ã€æš‚åœCSSåŠ¨ç”»](#jqueryå¯åŠ¨æš‚åœcssåŠ¨ç”»)
    1. [è·å–`HTTP response header`ä¿¡æ¯](#jqueryè·å–http-response-headerä¿¡æ¯)
    1. [ä¿®å¤HTMLæ ‡ç­¾`placeholder`å±æ€§æ— æ•ˆ](#jqueryä¿®å¤htmlæ ‡ç­¾placeholderå±æ€§æ— æ•ˆ)
    1. [æ¨¡æ‹Ÿæ‰‹æœºæ—‹è½¬ï¼ˆä½¿é¡µé¢éƒ½ä»¥ã€Œæ¨ªå±ã€å±•ç¤ºï¼‰](#jqueryæ¨¡æ‹Ÿæ‰‹æœºæ—‹è½¬ä½¿é¡µé¢éƒ½ä»¥æ¨ªå±å±•ç¤º)

    >å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒjQueryå†…å®¹é€‚ç”¨äºZeptoã€‚
    </details>

---
## æ ¹æ®UAæˆ–æµè§ˆå™¨ç‰¹æ€§åˆ¤æ–­
>æ›´å…¨é¢åˆ¤æ–­æ‰€åœ¨ç³»ç»Ÿã€æµè§ˆå™¨ï¼š[bowser](https://github.com/lancedikson/bowser)ã€‚

### *åŸç”ŸJS*åˆ¤æ–­æ‰€åœ¨ç³»ç»Ÿ
```js
/**
 * åˆ¤æ–­æ‰€åœ¨ç³»ç»Ÿ
 * @param {String} [ua = window.navigator.userAgent] - ç”¨æˆ·ä»£ç†
 * @param {String} [pf = window.navigator.platform] - ç³»ç»Ÿå¹³å°ç±»å‹
 * @returns {String} os - ç³»ç»Ÿåï¼š'iOS'|'Android'|'Windows Phone'|'macOS'|'Win2000'|'WinXP'|'Win2003'|'WinVista'|'Win7'|'Win10'|'Windows'|'Unix'|'Linux'
 */
function detectOS (ua = window.navigator.userAgent, pf = window.navigator.platform) {
  let os = ''

  if (/iPhone|iPad|iPod|iOS/.test(ua)) {    // fixme: æ³¨æ„iOS13ä¹‹åçš„iPadå¯èƒ½ä¼šåˆ¤æ–­ä¸ºmacOS
    os = 'iOS'
  } else if (/Android/.test(ua)) {
    os = 'Android'
  } else if (/\bWindows Phone/.test(ua)) {
    os = 'Windows Phone'
  } else {
    if (pf === 'Mac68K' || pf === 'MacPPC' || pf === 'Macintosh' || pf === 'MacIntel') {    // pf.includes('Mac')
      os = 'macOS'
    } else if (pf === 'Win32' || pf === 'Windows') {
      if (/Windows NT 5.0/.test(ua) || /Windows 2000/.test(ua)) {
        os = 'Win2000'
      } else if (/Windows NT 5.1/.test(ua) || /Windows XP/.test(ua)) {
        os = 'WinXP'
      } else if (/Windows NT 5.2/.test(ua) || /Windows 2003/.test(ua)) {
        os = 'Win2003'
      } else if (/Windows NT 6.0/.test(ua) || /Windows Vista/.test(ua)) {
        os = 'WinVista'
      } else if (/Windows NT 6.1/.test(ua) || /Windows 7/.test(ua)) {
        os = 'Win7'
      } else if (/Windows NT 10.0/.test(ua) || /Windows 10/.test(ua)) {
        os = 'Win10'
      } else {
        os = 'Windows'
      }
    } else if (pf === 'X11') {
      os = 'Unix'
    } else if (/Linux/.test(pf)) {
      os = 'Linux'
    }
  }

  return os
}
```
>åˆ¤æ–­æ˜¯WAPæˆ–PCï¼š`if (/AppleWebKit.*Mobile/.test(window.navigator.userAgent)) { /* WAP */ } else { /* PC */ }`

### *åŸç”ŸJS*åˆ¤æ–­Androidç‰ˆæœ¬å·
```js
function versionAndroid (ua = window.navigator.userAgent) {
  return ua.toLowerCase().match(/android (.*?);/)?.[1] || '';
}
```

### *åŸç”ŸJS*åˆ¤æ–­iOSç‰ˆæœ¬å·
```js
function versionIOS (ua = window.navigator.userAgent) {
  return ua.toLowerCase().match(/cpu iphone os (.*?) like mac os/)?.[1] || '';
}
```

### *åŸç”ŸJS*åˆ¤æ–­ç§»åŠ¨å¹³å°
```js
// åˆ¤æ–­ç§»åŠ¨å¹³å°ï¼ˆå¾®ä¿¡ã€QQã€å¾®åšã€QQç©ºé—´ã€UCæµè§ˆå™¨ï¼‰
function platform (ua = window.navigator.userAgent) {
  let platform

  if (/MicroMessenger/.test(ua)) {
    platform = 'wx'
  } else if (/QQ\//.test(ua)) {
    platform = 'qq'
  } else if (/\bWeibo|__weibo__\d/.test(ua)) {
    platform = 'weibo'
  } else if (/Qzone\//.test(ua)) {
    platform = 'qzone'
  } else if (/UCBrowser/.test(ua)) {
    platform = 'uc'
  } else {
    platform = 'other'
  }

  return platform
}
```

### *åŸç”ŸJS*åˆ¤æ–­ie6ã€7ã€8ã€9ç‰ˆæœ¬
>HTMLæ¡ä»¶æ³¨é‡Šæ³•ä»…æ”¯æŒie9-ã€‚

```js
/**
 * åˆ¤æ–­ie6ã€7ã€8ã€9ç‰ˆæœ¬
 * @param {Number|String} [num] - ieç‰ˆæœ¬å·ã€‚å¯å¡«6ã€7ã€8ã€9ï¼›è‹¥ä¸ºç©ºåˆ™åªè¦æ˜¯ie6~9åˆ™è¿”å›1
 * @returns {Number} - 0 æˆ– 1
 */
function isIE(num) {
    var dom = document.createElement('b');

    dom.innerHTML = '<!--[if IE ' + num + ']><i></i><![endif]-->';

    return dom.getElementsByTagName('i').length;
}
```

### *åŸç”ŸJS*åˆ¤æ–­ieæ‰€æœ‰ç‰ˆæœ¬
```js
/**
 * åˆ¤æ–­ieæ‰€æœ‰ç‰ˆæœ¬
 * @returns {Number} - ieç‰ˆæœ¬å· æˆ– false
 */
function detectIE() {
    var ua = window.navigator.userAgent;

    var msie = ua.indexOf('MSIE ');
    if (msie > 0) {

        /* ie10- è¿”å›ç‰ˆæœ¬å· */
        return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
    }

    var trident = ua.indexOf('Trident/');
    if (trident > 0) {
        var rv = ua.indexOf('rv:');

        /* ie11 è¿”å›ç‰ˆæœ¬å· */
        return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
    }

    var edge = ua.indexOf('Edge/');
    if (edge > 0) {

        /* Edge(ie 12+) è¿”å›ç‰ˆæœ¬å· */
        return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
    }

    /* å…¶ä»–æµè§ˆå™¨ è¿”å›false */
    return false;
}
```

---
## `é”®-å€¼`æ“ä½œ

### *åŸç”ŸJS*åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŸcookie
```js
function hasCookie (checkKey) {
  checkKey = checkKey.toString()

  var cookieArr = document.cookie.split('; '),
    tempArr, key, value

  for (var i = 0, len = cookieArr.length; i < len; i++) {
    if (cookieArr[i] !== '') {
      tempArr = cookieArr[i].split('=')
      key = tempArr.shift()
      value = tempArr.join('=')

      if (key === checkKey) {
        /* æ“ä½œvalue */

        return true
      }
    }
  }

  return false
}
```
>å…¨é¢æ“ä½œcookieï¼š[jsæ“ä½œcookie](https://github.com/realgeoffrey/knowledge/blob/master/ç½‘ç«™å‰ç«¯/JSæ–¹æ³•ç§¯ç´¯/åºŸå¼ƒä»£ç /README.md#åŸç”Ÿjsæ“ä½œcookie)ã€‚

### *åŸç”ŸJS*è·å–URLç›¸å…³ä¿¡æ¯
```js
/**
 * è·å–URLç›¸å…³ä¿¡æ¯
 * @param {String} [url = window.location.href] - URL
 * @returns {Object} location - åŒ…æ‹¬ï¼šhrefã€protocolã€hostnameã€portã€pathnameã€searchã€searchObjã€hash çš„å¯¹è±¡ã€‚è‹¥ä¸æ˜¯åˆæ³•URLï¼Œè¿”å›false
 */
function getLocation(url = window.location.href) {
  try {
    /* ä¸ºäº†æ–¹ä¾¿é˜…è¯» */
    const protocolStr = /^(?:([A-Za-z]+):)?/.source
    const slashStr = /\/*/.source
    const hostnameStr = /([0-9A-Za-z.-]+)/.source
    const portStr = /(?::(\d+))?/.source
    const pathnameStr = /(\/[^?#]*)?/.source
    const searchStr = /(?:\?([^#]*))?/.source
    const hashStr = /(?:#(.*))?$/.source

    const regex = new RegExp(protocolStr + slashStr + hostnameStr + portStr + pathnameStr + searchStr + hashStr, 'g');
    const regexArr = regex.exec(url);
    const keyArr = [ 'href', 'protocol', 'hostname', 'port', 'pathname', 'search', 'hash' ];
    const location = { 'searchObj': {} };

    keyArr.forEach(function (item, index) {
      location[item] = regexArr[index] || ''
    })

    const searchArr = location['search'].split('&')

    for (let i = 0; i < searchArr.length; i++) {
      if (searchArr[i] !== '') {
        const searchItem = searchArr[i].split('=')
        const key = searchItem.shift()
        const value = searchItem.join('=')
        if (!Object.prototype.hasOwnProperty.call(location['searchObj'], key)) {  // ç”¨ç¬¬ä¸€æ¬¡å‡ºç°çš„
          location['searchObj'][key] = value
        }
      }
    }

    return location
  } catch (e) {  // ä¸æ˜¯åˆæ³•URL
    return false
  }
}
```

>å‚è€ƒï¼š[ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†æ URL](https://harttle.land/2016/02/23/javascript-regular-expressions.html)ã€‚

>1. è·å–æŸsearchå€¼ï¼š
>
>    ```js
>    /**
>     * è·å–æŸsearchå€¼
>     * @param {String} checkKey - searchçš„key
>     * @param {String} [search = window.location.search] - searchæ€»å­—ç¬¦ä¸²ï¼ˆä¸æ ¡éªŒï¼‰
>     * @returns {String|Boolean} - searchçš„value æˆ– ä¸å­˜åœ¨false
>     */
>    function getSearchValue (checkKey, search = window.location.search) {
>      checkKey = checkKey.toString()
>
>      if (search.slice(0, 1) === '?') {
>        search = search.slice(1)
>      }
>
>      for (let i = 0, searchArr = search.split('&'); i < searchArr.length; i++) {
>        if (searchArr[i] !== '') {
>          const tempArr = searchArr[i].split('=')
>          const key = tempArr.shift()
>          const value = tempArr.join('=')
>
>          if (key === checkKey) {
>
>            return decodeURIComponent(value)
>          }
>        }
>      }
>
>      return false
>    }
>    ```
>2. æ‹¼æ¥æ¥å£URLæ—¶ï¼Œå¯ä»¥åœ¨è·¯ç”±æœ€åæ·»åŠ `?`å¹¶ä¸”åŠ ä¸Šä¸€äº›å›ºå®šä¸å˜çš„searchå‚æ•°ï¼Œåœ¨ä½¿ç”¨URLæ—¶å€™éƒ½ä»¥`&å‚æ•°=å€¼`çš„å½¢å¼æ·»åŠ é¢å¤–å‚æ•°ï¼š
>
>    >`xxx/xxx?&a=1`å¯ä»¥æ­£å¸¸è§£æ
>
>    ```js
>    const api1 = 'xxx/xxx?'
>    const api2 = 'xxx/xxx?v=1.0'
>
>    // ä½¿ç”¨æ—¶
>    url1 = api1 + '&a=1' + '&b=2' + '&c=3'
>    url2 = api2 + '&a=1' + '&b=2' + '&c=3'
>    ```
>3. URLæºå¸¦JSONæ•°æ®ï¼š
>
>    searchæŸkeyçš„å€¼ä¸º`encodeURIComponent(JSON.stringify(JSONæ•°æ®))`ï¼Œè·å–æŸkeyå€¼å`JSON.parse(decodeURIComponent(å‰é¢çš„å€¼))`ã€‚

### *åŸç”ŸJS*åœ¨URLæœ«å°¾ä¿®æ”¹searché”®-å€¼
1. æ‰¹é‡ä¿®æ”¹ï¼ˆæœªåŠ `encodeURIComponent`ï¼‰

    >å¯¹è±¡è½¬æ¢ä¸º`a=1&b=2`ï¼š`Object.entries(å¯¹è±¡).map((val) => val.join('=')).join('&')`ã€‚

    ```ts
    /**
     * åœ¨URLæœ«å°¾ä¿®æ”¹searché”®-å€¼
     * @param {String} [url = window.location.href] - URL
     * @param {Object} searchObj - ä¿®æ”¹çš„searché”®-å€¼ï¼ˆè‹¥key-valueçš„valueè®¾ç½®ä¸º`false`ï¼Œåˆ™åˆ é™¤è¿™ä¸ªkeyï¼‰
     * @returns {String} - ä¿®æ”¹å®Œæ¯•çš„URL
     */
    function changeUrlSearch(url: string = window.location.href, searchObj: Record<string, string | false> = {}): string {
      if (Object.keys(searchObj).length === 0) {
        // ç©ºå¯¹è±¡ä¸å¤„ç†
        return url;
      }

      const hashIndex = url.includes("#") ? url.indexOf("#") : url.length; // "#"æ‰€åœ¨çš„å­—ç¬¦ä¸²ä½ç½®ç´¢å¼•
      const urlWithoutHash = url.slice(0, hashIndex); // å»é™¤hashåçš„url
      const searchIndex = urlWithoutHash.indexOf("?"); // "?"æ‰€åœ¨çš„å­—ç¬¦ä¸²ä½ç½®ç´¢å¼•

      // æŠŠåŸå§‹searchå€¼å†™å…¥å¯¹è±¡
      const originalSearchObj: Record<string, string> = {};
      if (searchIndex !== -1) {
        const search = urlWithoutHash.slice(searchIndex + 1); // searchå€¼ï¼ˆä¸åŒ…æ‹¬ ?ï¼‰

        // å†™å…¥å·²å­˜åœ¨searchçš„é”®-å€¼
        const searchArr = search.split("&");
        for (let i = 0; i < searchArr.length; i++) {
          if (searchArr[i] !== "") {
            const searchItem = searchArr[i].split("=");
            const key = searchItem.shift() as string;
            const value = searchItem.join("="); // å…œåº•æœ‰äº›å€¼åŒ…å«"="
            if (!Object.prototype.hasOwnProperty.call(originalSearchObj, key)) {  // ç”¨ç¬¬ä¸€æ¬¡å‡ºç°çš„
              originalSearchObj[key] = value;
            }
          }
        }
      }

      // åˆå¹¶åŸå§‹searchå’Œæ–°å¢searchï¼ˆåŒåè¦†ç›–ï¼‰
      const newSearchObj: Record<string, string | false> = Object.assign({}, originalSearchObj, searchObj);

      // ç”Ÿæˆæ–°çš„åˆå¹¶è¿‡åçš„searchå­—ç¬¦ä¸²
      const newSearch = Object.entries(newSearchObj)
        // å€¼ä¸º`false`çš„keyè¢«åˆ é™¤
        .filter(([key, value]) => {
          return value !== false;
        })
        .map((val) => {
          return val.join("=");
        })
        .join("&");

      const hash = url.slice(hashIndex); // åŸå§‹hash

      let urlWithoutSearch; // å»é™¤searchã€hashåçš„url
      if (searchIndex !== -1) {
        urlWithoutSearch = urlWithoutHash.slice(0, searchIndex);
      } else {
        urlWithoutSearch = urlWithoutHash;
      }

      return urlWithoutSearch + (newSearch ? `?${newSearch}` : "") + hash;
    }
    ```
2. <details>

    <summary>å•ä¸ªä¿®æ”¹</summary>

    ```js
    /**
     * åœ¨URLæœ«å°¾ä¿®æ”¹searché”®-å€¼
     * @param {String} url - URL
     * @param {String} name - å
     * @param {String|Boolean} value - å€¼ï¼ˆè‹¥ä¼ `false`åˆ™åˆ é™¤å±æ€§åï¼‰
     * @returns {String} - æ·»åŠ å®Œæ¯•çš„URL
     */
    function changeUrlSearch (url, name, value) {
      if (!name) {
        return url
      }

      var hashIndex = url.includes('#') ? url.indexOf('#') : url.length
      var urlWithoutHash = url.slice(0, hashIndex)
      var hash = url.slice(hashIndex)
      var searchIndex = urlWithoutHash.indexOf('?')

      if (searchIndex === -1) {
        if (value === false) {
          return url
        }
        return urlWithoutHash + '?' + encodeURIComponent(name) + '=' + encodeURIComponent(value) + hash
      } else if (searchIndex === urlWithoutHash.length - 1) {
        if (value === false) {
          return url.slice(0, urlWithoutHash.length - 1) + hash
        }
        return urlWithoutHash + encodeURIComponent(name) + '=' + encodeURIComponent(value) + hash
      } else {
        const urlWithoutSearch = urlWithoutHash.slice(0, searchIndex)
        const search = urlWithoutHash.slice(searchIndex + 1)

        const originalSearchObj = {}

        // å†™å…¥å·²å­˜åœ¨searchçš„é”®-å€¼
        const searchArr = search.split('&')
        for (let i = 0; i < searchArr.length; i++) {
          if (searchArr[i] !== '') {
            const searchItem = searchArr[i].split('=')
            const key = searchItem.shift()
            const value = searchItem.join('=')
            if (!Object.prototype.hasOwnProperty.call(originalSearchObj, key)) {  // ç”¨ç¬¬ä¸€æ¬¡å‡ºç°çš„
              originalSearchObj[key] = value
            }
          }
        }

        let newSearch
        if (value === false) {
          delete originalSearchObj[name]
          newSearch = Object.entries(originalSearchObj)
            .map((val) => {
              return val.join('=')
            })
            .join('&')
        } else {
          const newSearchObj = Object.assign({}, originalSearchObj, {
            [encodeURIComponent(name)]: encodeURIComponent(value)
          })
          newSearch = Object.entries(newSearchObj)
            .map((val) => {
              return val.join('=')
            })
            .join('&')
        }

        return urlWithoutSearch + (newSearch ? `?${newSearch}` : '') + hash
      }
    }
    ```
    </details>

---
## äº‹ä»¶ç›¸å…³

### *åŸç”ŸJS*ç»‘å®šã€è§£ç»‘äº‹ä»¶
```js
var eventUtil = {

    /**
     * ç»‘å®šäº‹ä»¶
     * @param {Object} dom - DOMå¯¹è±¡
     * @param {String} type - äº‹ä»¶å
     * @param {Function} handle - å¤„ç†å‡½æ•°
     */
    addHandler: function (dom, type, handle) {
        if (typeof dom.addEventListener === 'function') {   /* DOM2çº§ï¼Œé™¤ie8- */
            dom.addEventListener(type, handle, false);
        } else if (typeof dom.attachEvent === 'function') { /* æ‰€æœ‰ieæµè§ˆå™¨ */
            dom.attachEvent('on' + type, handle);   // æ³¨æ„ï¼šä¼ å…¥çš„å‚æ•°å’Œthisçš„å…¼å®¹
        } else {    /* DOM0çº§ï¼Œæœ€æ—©æœŸçš„æµè§ˆå™¨éƒ½æ”¯æŒ */
            dom['on' + type] = handle;
        }
    },

    /**
     * è§£ç»‘äº‹ä»¶
     * @param {Object} dom - DOMå¯¹è±¡
     * @param {String} type - äº‹ä»¶å
     * @param {Function} handle - å¤„ç†å‡½æ•°
     */
    removeHandler: function (dom, type, handle) {
        if (typeof dom.removeEventListener === 'function') {
            dom.removeEventListener(type, handle, false);
        } else if (typeof dom.detachEvent === 'function') {
            dom.detachEvent('on' + type, handle);   // æ³¨æ„ï¼šä¼ å…¥çš„å‚æ•°å’Œthisçš„å…¼å®¹
        } else {
            dom['on' + type] = null;
        }
    }
};
```

### *åŸç”ŸJS*ã€jQueryé˜»æ­¢å†’æ³¡å’Œé˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸º
1. é˜»æ­¢å†’æ³¡

    1. *åŸç”ŸJS*

        ```js
        function stopBubble(e) {
            if (e && e.stopPropagation) {
                e.stopPropagation();
            } else {
                window.event.cancelBubble = true;
            }
        }
        ```
    2. jQuery

        ```js
        $('...').on('...', function (e) {
            e.stopPropagation();
        });
        ```
2. é˜»æ­¢é»˜è®¤è¡Œä¸º

    1. *åŸç”ŸJS*

        ```js
        function stopDefault(e) {
            if (e && e.preventDefault) {
                e.preventDefault();
            } else {
                window.event.returnValue = false;
            }
        }
        ```
    2. jQuery

        ```js
        $('...').on('...', function (e) {
            e.preventDefault();
        });
        ```
3. é˜»æ­¢å†’æ³¡ && é˜»æ­¢é»˜è®¤è¡Œä¸º

    1. *åŸç”ŸJS*

        ```js
        function returnFalse(e) {
            if (e && e.stopPropagation) {
                e.stopPropagation();
                e.preventDefault();
            } else {
                window.event.cancelBubble = true;
                window.event.returnValue = false;
            }
        }
        ```
    2. jQuery

        ```js
        $('...').on('...', function () {

            return false;
        });
        // æˆ–ç®€å†™ï¼š$('...').on('...', false);
        ```

### *åŸç”ŸJS*äº‹ä»¶ä»£ç†
```js
dom.addEventListener('äº‹ä»¶å', function (e) {
  const event = e || window.event
  const target = event.target || event.srcElement // å…¼å®¹ie8-

  // targetä¸ºç›®æ ‡å…ƒç´ ï¼ˆæ•è·çš„ç»ˆç‚¹ã€å†’æ³¡çš„èµ·ç‚¹ï¼‰ï¼›å¯ä»¥ç”¨dom.matches(CSSé€‰æ‹©å™¨)åˆ¤æ–­æ˜¯å¦æ˜¯é€‰æ‹©å™¨
  // å¯¹targetæ»¡è¶³çš„å…ƒç´ è¿›è¡Œæ“ä½œ
})
```

### *åŸç”ŸJS*ã€jQueryå®ç°åˆ¤æ–­æŒ‰ä¸‹å…·ä½“æŸæŒ‰é”®
1. `KeyboardEvent.key`

    >[MDN:KeyboardEvent.key](https://developer.mozilla.org/zh-CN/docs/Web/API/KeyboardEvent/key/Key_Values)ã€[W3C:KeyboardEvent.key](https://www.w3.org/TR/uievents-key/)ã€‚

    1. *åŸç”ŸJS*

        ```js
        function checkKey(e) {
            var event = e || window.event,
                key = event.key;

            if (key === 'Enter') {   /* æŸ¥è¯¢é”®å€¼è¡¨ ä¾‹ï¼š'Enter' -> æ¢è¡Œ */
                /* å…·ä½“æ“ä½œ... */

                /* é˜»æ­¢å†’æ³¡&é˜»æ­¢é»˜è®¤è¡Œä¸º */
                if (e && e.stopPropagation) {
                    e.stopPropagation();
                    e.preventDefault();
                } else {
                    window.event.cancelBubble = true;
                    window.event.returnValue = false;
                }
            }
        }


        /* ä½¿ç”¨æµ‹è¯• */
        addEvent(document.getElementById('test'), 'keydown', checkKey);  // ä¸Šé¢ç»‘å®šäº‹ä»¶
        ```
    2. jQuery

        ```js
        $(è¾“å…¥æ¡†é€‰æ‹©å™¨).on('keydown', function (e) {
            if (e.key === 'Enter') {   /* æŸ¥è¯¢é”®å€¼è¡¨ ä¾‹ï¼š'Enter' -> æ¢è¡Œ */
                /* å…·ä½“æ“ä½œ... */

                return false;   // é˜»æ­¢å†’æ³¡&é˜»æ­¢é»˜è®¤è¡Œä¸º
            }
        });
        ```
2. ~~`KeyboardEvent.which/keyCode/charCode`~~ï¼ˆå·²åºŸå¼ƒï¼‰

    1. *åŸç”ŸJS*

        ```js
        function checkKeyCode(e) {
            var event = e || window.event,
                keyCode = event.keyCode || event.charCode;  /* è·å–é”®å€¼ */

            if (keyCode === 13) {   /* æŸ¥è¯¢é”®å€¼è¡¨ ä¾‹ï¼š13 -> æ¢è¡Œ */
                /* å…·ä½“æ“ä½œ... */

                /* é˜»æ­¢å†’æ³¡&é˜»æ­¢é»˜è®¤è¡Œä¸º */
                if (e && e.stopPropagation) {
                    e.stopPropagation();
                    e.preventDefault();
                } else {
                    window.event.cancelBubble = true;
                    window.event.returnValue = false;
                }
            }
        }


        /* ä½¿ç”¨æµ‹è¯• */
        addEvent(document.getElementById('test'), 'keydown', checkKeyCode);  // ä¸Šé¢ç»‘å®šäº‹ä»¶
        ```
    2. jQuery

        ```js
        $(è¾“å…¥æ¡†é€‰æ‹©å™¨).on('keydown', function (e) {
            if (e.which === 13) {   /* æŸ¥è¯¢é”®å€¼è¡¨ ä¾‹ï¼š13 -> æ¢è¡Œ */
                /* å…·ä½“æ“ä½œ... */

                return false;   // é˜»æ­¢å†’æ³¡&é˜»æ­¢é»˜è®¤è¡Œä¸º
            }
        });
        ```
>çº¿ä¸ŠæŸ¥è¯¢ï¼š[keycode.info](http://keycode.info/)ã€‚

### *åŸç”ŸJS*æ‹–æ‹½å’Œæ”¾ä¸‹
- æ­¥éª¤ï¼š

    1. åœ¨DOMä¸Šç»‘å®š`mousedown`ï¼ˆæˆ–`touchstart`ï¼‰ï¼Œæ‰§è¡Œï¼š

        1. è®°å½•åŸºç¡€åˆå§‹ä½ç½®ï¼šåˆå§‹é¼ æ ‡ï¼ˆæˆ–touchç‚¹ï¼‰ä½ç½®ã€DOMè‡ªèº«ä½ç½®
        2. åœ¨DOMä¸Šç»‘å®š`mousemove`ï¼ˆæˆ–`touchmove`ï¼‰

            1. è·å–æœ€ç»ˆä½ç½®ï¼š`å½“å‰é¼ æ ‡ï¼ˆæˆ–touchï¼‰ä½ç½® - åˆå§‹é¼ æ ‡ï¼ˆæˆ–touchï¼‰ä½ç½® + DOMè‡ªèº«ä½ç½®`
            2. æŠŠæœ€ç»ˆä½ç½®èµ‹äºˆDOM
    2. åœ¨DOMç¥–å…ˆä¸Šç»‘å®š`mouseup`ã€`mouseleave`ï¼ˆæˆ–`touchend`ã€`touchcancel`ï¼‰ï¼Œæ‰§è¡Œï¼š

        åœ¨DOMä¸Šè§£ç»‘`mousemove`ï¼ˆæˆ–`touchmove`ï¼‰

    >æ¯ä¸€ä¸ªäº‹ä»¶å¤„ç†ï¼Œéƒ½å¯åŠ å…¥é˜»æ­¢å†’æ³¡ã€‚

1. PCç«¯çš„é¼ æ ‡äº‹ä»¶

    ```js
    function Drag(dom, parentDom) {
        var maxX = parentDom.offsetWidth - dom.offsetWidth,
            maxY = parentDom.offsetHeight - dom.offsetHeight,
            domX, domY, beginX, beginY;

        /* ç»‘å®šäº‹ä»¶ */
        function _addHandler(dom, type, handle) {
            if (typeof dom.addEventListener === 'function') {
                dom.addEventListener(type, handle, false);
            } else if (typeof dom.attachEvent === 'function') {
                dom.attachEvent('on' + type, handle);
            } else {
                dom['on' + type] = handle;
            }
        }

        /* è§£ç»‘äº‹ä»¶ */
        function _removeHandler(dom, type, handle) {
            if (typeof dom.removeEventListener === 'function') {
                dom.removeEventListener(type, handle, false);
            } else if (typeof dom.detachEvent === 'function') {
                dom.detachEvent('on' + type, handle);
            } else {
                dom['on' + type] = null;
            }
        }

        /* é˜»æ­¢å†’æ³¡&é˜»æ­¢é»˜è®¤è¡Œä¸º */
        function _returnFalse(e) {
            if (e && e.stopPropagation) {
                e.stopPropagation();
                e.preventDefault();
            } else {
                window.event.cancelBubble = true;
                window.event.returnValue = false;
            }
        }

        /* æ‹–æ‹½å¼€å§‹ */
        function actBegin(e) {
            e = e || window.event;

            domX = dom.offsetLeft;
            domY = dom.offsetTop;

            beginX = e.clientX; // æˆ–e.pageX/Yï¼ˆieä¸å…¼å®¹ï¼‰
            beginY = e.clientY;

            _addHandler(parentDom, 'mousemove', actMove);

            _returnFalse(e); // é˜»æ­¢å†’æ³¡ã€é˜»æ­¢é»˜è®¤è¡Œä¸º
        }

        /* æ‹–æ‹½ç§»åŠ¨ */
        function actMove(e) {
            e = e || window.event;

            var finalX = e.clientX - beginX + domX,
                finalY = e.clientY - beginY + domY;

            if (finalX > maxX) {
                finalX = maxX;
            } else if (finalX < 0) {
                finalX = 0;
            }
            if (finalY > maxY) {
                finalY = maxY;
            } else if (finalY < 0) {
                finalY = 0;
            }

            /* å…·ä½“ç§»åŠ¨ï¼ˆä½¿ç”¨leftã€topï¼‰ */
            // requestAnimationFrame(function () {
                dom.style.left = finalX + 'px';
                dom.style.top = finalY + 'px';
            // });

            _returnFalse(e); // é˜»æ­¢å†’æ³¡ã€é˜»æ­¢é»˜è®¤è¡Œä¸º
        }

        /* æ‹–æ‹½å–æ¶ˆ */
        function cancel(e) {
            _removeHandler(parentDom, 'mousemove', actMove);

            _returnFalse(e); // é˜»æ­¢å†’æ³¡ã€é˜»æ­¢é»˜è®¤è¡Œä¸º
        }

        /* ç»‘å®šäº‹ä»¶ */
        _addHandler(dom, 'mousedown', actBegin);
        _addHandler(parentDom, 'mouseup', cancel);
        _addHandler(parentDom, 'mouseleave', cancel);

        this.stop = function () {
            _removeHandler(dom, 'mousedown', actBegin);
            _removeHandler(parentDom, 'mouseup', cancel);
            _removeHandler(parentDom, 'mouseleave', cancel);
            _removeHandler(parentDom, 'mousemove', actMove);
        };
    }


    /* ä½¿ç”¨æµ‹è¯• */
    var dom = document.getElementById('j-rect');
    var action = new Drag(dom, dom.offsetParent);

    // action.stop();
    ```

    [CodePen demo](https://codepen.io/realgeoffrey/pen/GVNPeN)
2. WAPç«¯çš„touchäº‹ä»¶

    ```js
    function Drag(dom, parentDom) {
        var maxX = parentDom.offsetWidth - dom.offsetWidth,
            maxY = parentDom.offsetHeight - dom.offsetHeight,
            domX, domY, beginX, beginY;

        /* æ‹–æ‹½å¼€å§‹ */
        function actBegin(e) {
            domX = dom.offsetLeft;
            domY = dom.offsetTop;

            beginX = e.touches[0].pageX;
            beginY = e.touches[0].pageY;

            parentDom.addEventListener('touchmove', actMove, false);

            /* é˜»æ­¢å†’æ³¡ã€é˜»æ­¢é»˜è®¤è¡Œä¸º */
            e.stopPropagation();
            e.preventDefault();
        }

        /* æ‹–æ‹½ç§»åŠ¨ */
        function actMove(e) {
            var finalX = e.touches[0].pageX - beginX + domX,
                finalY = e.touches[0].pageY - beginY + domY;

            if (finalX > maxX) {
                finalX = maxX;
            } else if (finalX < 0) {
                finalX = 0;
            }
            if (finalY > maxY) {
                finalY = maxY;
            } else if (finalY < 0) {
                finalY = 0;
            }

            /* å…·ä½“ç§»åŠ¨ï¼ˆä½¿ç”¨leftã€topï¼‰ */
            requestAnimationFrame(function () {
                dom.style.left = finalX + 'px';
                dom.style.top = finalY + 'px';
            });

            /* é˜»æ­¢å†’æ³¡ã€é˜»æ­¢é»˜è®¤è¡Œä¸º */
            e.stopPropagation();
            e.preventDefault();
        }

        /* æ‹–æ‹½å–æ¶ˆ */
        function cancel(e) {
            parentDom.removeEventListener('touchmove', actMove, false);

            /* é˜»æ­¢å†’æ³¡ã€é˜»æ­¢é»˜è®¤è¡Œä¸º */
            e.stopPropagation();
            e.preventDefault();
        }

        /* ç»‘å®šäº‹ä»¶ */
        dom.addEventListener('touchstart', actBegin, false);
        parentDom.addEventListener('touchend', cancel, false);
        parentDom.addEventListener('touchcancel', cancel, false);

        this.stop = function () {
            dom.removeEventListener('touchstart', actBegin, false);
            parentDom.removeEventListener('touchend', cancel, false);
            parentDom.removeEventListener('touchcancel', cancel, false);
            parentDom.removeEventListener('touchmove', actMove, false);
        };
    }


    /* ä½¿ç”¨æµ‹è¯• */
    var dom = document.getElementById('j-rect');
    var action = new Drag(dom, dom.offsetParent);

    // action.stop();
    ```

### *åŸç”ŸJS*è§¦æ‘¸å±æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶ï¼ˆæ¶ˆé™¤ã€Œå»¶æ—¶300æ¯«ç§’åæ‰è§¦å‘clickäº‹ä»¶ã€ï¼Œä½¿ç‚¹å‡»äº‹ä»¶æå‰è§¦å‘ï¼‰
```js
/* ä¸è¦ç»‘å®šclickäº‹ä»¶ï¼Œç”¨touchstartå’Œtouchendæ¨¡æ‹Ÿï¼Œä»¥æ¶ˆé™¤ã€Œå»¶æ—¶300æ¯«ç§’åæ‰è§¦å‘ã€çš„é—®é¢˜ */

var start_x, start_y;

document.getElementById('...').addEventListener('touchstart', function (e) {
    start_x = e.changedTouches[0].clientX;
    start_y = e.changedTouches[0].clientY;
}, false);

document.getElementById('...').addEventListener('touchend', function (e) {
    var end_x = e.changedTouches[0].clientX,
        end_y = e.changedTouches[0].clientY;

    if (Math.abs(end_x - start_x) > 5 || Math.abs(end_y - start_y) > 5) {
        /* è§¦å‘æ»‘åŠ¨äº‹ä»¶è¦åšçš„äº‹æƒ…ï¼ˆå¦‚ï¼šä»€ä¹ˆéƒ½ä¸åšï¼‰ */
    } else {
        /* è§¦å‘ç‚¹å‡»äº‹ä»¶è¦åšçš„äº‹æƒ… */
    }
}, false);

/* è¿˜è¦å¤„ç†æµè§ˆå™¨é»˜è®¤ç‚¹å‡»äº‹ä»¶ï¼ˆå¦‚ï¼š`<a>`ï¼‰ */
```

### *åŸç”ŸJS*åˆ¤æ–­äº‹ä»¶åœ¨æµè§ˆå™¨æ˜¯å¦å­˜åœ¨
```js
/**
 * åˆ¤æ–­DOMèŠ‚ç‚¹æ˜¯å¦æ”¯æŒæŸäº‹ä»¶
 * @param {String} eventName - äº‹ä»¶å
 * @param {Object} [element] - DOMçš„Documentå¯¹è±¡
 * @returns {Boolean} isSupported
 */
function isEventSupported(eventName, element) {
    var tagNames = {
            'select': 'input',
            'change': 'input',
            'submit': 'form',
            'reset': 'form',
            'error': 'img',
            'load': 'img',
            'abort': 'img'
        },
        isSupported;

    element = element || document.createElement(tagNames[eventName] || 'div');
    eventName = 'on' + eventName;

    isSupported = eventName in element;

    if (!isSupported) {
        if (!element.setAttribute) {    /* è‹¥èŠ‚ç‚¹æ²¡æœ‰setAttributeæ–¹æ³•ï¼Œåˆ™æ”¹ç”¨divèŠ‚ç‚¹è¿›è¡Œæµ‹è¯• */
            element = document.createElement('div');
        }
        if (element.setAttribute && element.removeAttribute) {
            element.setAttribute(eventName, '');
            isSupported = typeof element[eventName] === 'function';

            if (element[eventName] !== undefined) { /* å†…å­˜å›æ”¶ */
                element[eventName] = undefined;
            }
            element.removeAttribute(eventName); /* å†…å­˜å›æ”¶ */
        }
    }

    element = null; /* å†…å­˜å›æ”¶ */

    return isSupported;
}
```

>æ›´å…¨é¢çš„æ€§èƒ½ç›‘å¬ï¼š[stats.js](https://github.com/mrdoob/stats.js/)ã€‚

### *åŸç”ŸJS*æ ¹æ®æ»šåŠ¨æ–¹å‘æ‰§è¡Œå‡½æ•°
```js
/**
 * æ ¹æ®æ»šåŠ¨æ–¹å‘ç›´è¡Œå¯¹åº”
 * @constructor
 * @param {object} [dom = window] - ç›‘å¬æ»šåŠ¨çš„DOM
 * @param {Function} [up] - å‘ä¸Šæ»šåŠ¨çš„å›è°ƒ
 * @param {Function} [down] - å‘ä¸‹æ»šåŠ¨çš„å›è°ƒ
 * @param {Function} [left] - å‘å·¦æ»šåŠ¨çš„å›è°ƒ
 * @param {Function} [right] - å‘å³æ»šåŠ¨çš„å›è°ƒ
 */
function ScrollDirection ({dom = window, up = () => {}, down = () => {}, left = () => {}, right = () => {}} = {}) {
  let beforeV // å‚ç›´æ»šåŠ¨é«˜åº¦
  let beforeH // æ°´å¹³æ»šåŠ¨é«˜åº¦
  if (dom === window) {
    beforeV = document.body.scrollTop || document.documentElement.scrollTop
    beforeH = document.body.scrollLeft || document.documentElement.scrollLeft
  } else {
    beforeV = dom.scrollTop
    beforeH = dom.scrollLeft
  }

  const handleScroll = () => {
    let afterV  // å‚ç›´æ»šåŠ¨é«˜åº¦
    let afterH  // æ°´å¹³æ»šåŠ¨é«˜åº¦
    if (dom === window) {
      afterV = document.body.scrollTop || document.documentElement.scrollTop
      afterH = document.body.scrollLeft || document.documentElement.scrollLeft
    } else {
      afterV = dom.scrollTop
      afterH = dom.scrollLeft
    }

    const gapV = afterV - beforeV
    const gapH = afterH - beforeH

    if (gapV > 0) {
      down()
    } else if (gapV < 0) {
      up()
    }

    if (gapH > 0) {
      right()
    } else if (gapH < 0) {
      left()
    }

    beforeV = afterV
    beforeH = afterH
  }

  dom.addEventListener('scroll', handleScroll, false)

  this.stop = () => {
    dom.removeEventListener('scroll', handleScroll, false)
  }
}


/* ä½¿ç”¨æµ‹è¯• */
var a = new ScrollDirection({
  up: () => {console.log('up')},
  down: () => {console.log('down')},
  left: () => {console.log('left')},
  right: () => {console.log('right')}
})
var b = new ScrollDirection({
  dom: document.getElementById('j-div'), up: () => {console.log('dom up')}, down: () => {console.log('dom down')}
})

// a.stop()
// b.stop()
```

---
## æ•°å­—æ“ä½œ

### *åŸç”ŸJS*ç§‘å­¦è®¡æ•°æ³•è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ•°å­—
```js
function eToString(number) {
    number = number.toString(10);

    var regex = /^(\d)(?:\.(\d*))?[eE]([+-]?)(\d+)$/,   // ç§‘å­¦è®¡æ•°æ³•
        regexArr = regex.exec(number);

    if (regexArr === null) {

        return number;
    } else {
        var dotNumber = regexArr[2] ? regexArr[2] : '',
            dotLength = dotNumber.length, // å°æ•°ä½æ•°
            multiple = regexArr[4], // 10è¿›åˆ¶ä½æ•°
            gap = Math.abs(multiple - dotLength),
            tempArr = [],
            i, result;

        if (regexArr[3] !== '-') {  /* å¤§äº1 */
            if (multiple >= dotLength) {    /* æ²¡æœ‰å°æ•° */
                for (i = 0; i < gap; i++) {
                    tempArr.push('0');
                }

                result = regexArr[1] + dotNumber + tempArr.join('');
            } else {  /* æœ‰å°æ•° */
                result = regexArr[1] + dotNumber.substr(0, multiple) + '.' + dotNumber.substr(multiple);
            }
        } else { /* å°äº1 */
            if (multiple === '0') {
                result = regexArr[1] + dotNumber;
            } else {
                for (i = 0; i < multiple - 1; i++) {
                    tempArr.push('0');
                }

                result = '0.' + tempArr.join('') + regexArr[1] + dotNumber;
            }
        }
    }

    return result;
}
```

### *åŸç”ŸJS*ä¸åŒè¿›åˆ¶æ•°äº’ç›¸è½¬æ¢
```js
/**
 * ä¸åŒè¿›åˆ¶ï¼ˆ2è‡³36è¿›åˆ¶ï¼‰æ¢ç®—ï¼ˆ10ä¸ªé˜¿æ‹‰ä¼¯æ•°å­—+26ä¸ªå­—æ¯ï¼‰
 * @param {String} operand - è½¬æ¢æ•°ï¼ˆ2è¿›åˆ¶ä»…ä½¿ç”¨0~1ã€8è¿›åˆ¶ä»…ä½¿ç”¨0~7ã€10è¿›åˆ¶ä»…ä½¿ç”¨0~9ã€16è¿›åˆ¶ä»…ä½¿ç”¨0~9å’Œa~fï¼Œç­‰ï¼‰
 * @param {Number} fromRadix - è½¬æ¢æ•°çš„è¿›åˆ¶æ•°ï¼ˆ2~36ï¼‰
 * @param {Number} toRadix - ç»“æœçš„è¿›åˆ¶æ•°
 * @returns {String|Boolean|Number} - è½¬æ¢åçš„æ•°å€¼ï¼›è¿›åˆ¶æ•°ä¸åœ¨2~36ï¼šfalseï¼›æ“ä½œæ•°ä¸è¿›åˆ¶æ•°ä¸åŒ¹é…ï¼šNaN
 */
function numConvert (operand, fromRadix, toRadix) {
  if (fromRadix > 36 || fromRadix < 2 || toRadix > 36 || toRadix < 2) {    /* ä»…æ”¯æŒ2è‡³36è¿›åˆ¶ */
    console.log('è¿›åˆ¶æ•°åªèƒ½åœ¨2è‡³36ä¹‹é—´')
    return false
  } else {
    // å…ˆè½¬åŒ–ä¸º10è¿›åˆ¶
    if (fromRadix === 10) {
      operand = parseInt(operand, 10)
    } else {
      operand = parseInt(operand, fromRadix)  // å…¶ä»–è¿›åˆ¶è½¬åŒ–ä¸º10è¿›åˆ¶
    }

    // å†ç”±10è¿›åˆ¶è½¬åŒ–ä¸ºå…¶ä»–è¿›åˆ¶
    return operand.toString(toRadix)
  }
}
```

### *åŸç”ŸJS*é€‰å–èŒƒå›´å†…éšæœºå€¼
>æ³¨æ„ï¼š
>
>1. æ£€æŸ¥ä¸åŒè¯­è¨€åŸå§‹è¿”å›çš„éšæœºå€¼ä¸¤è¾¹ç«¯ç‚¹å¼€é—­æƒ…å†µâ€”â€”ä¸åŒçš„å¼€é—­åŒºé—´å½±å“æœ€ç»ˆç®—æ³•ã€‚
>2. è·å–åˆ°çš„æ¯ä¸ªæ•´æ•°çš„æ¦‚ç‡æ˜¯å¦å‡ç­‰â€”â€”ç”¨å‘ä¸‹å–æ•´æ›¿ä»£å››èˆäº”å…¥å¯ä»¥ä½¿æ¦‚ç‡å‡ç­‰ã€‚

```js
/**
 * é€‰å–èŒƒå›´å†…éšæœºå€¼
 * @param {Number} min - ä¸‹é™ï¼ˆæˆ–ä¸Šé™ï¼‰
 * @param {Number} max - ä¸Šé™ï¼ˆæˆ–ä¸‹é™ï¼‰
 * @returns {Number} - ä¸Šä¸‹é™åŒºé—´å†…çš„éšæœºå€¼ï¼ˆé—­åŒºé—´ï¼Œ[ä¸‹é™, ä¸Šé™]ï¼‰
 */
function randomFrom(min, max) {
    var temp;

    if (min > max) {
        temp = min;
        min = max;
        max = temp;
    }

    return Math.floor(Math.random() * (max - min + 1) + min);
}
```
><details>
><summary><code>Math.random()</code>è¿”å›<code>[0,1)</code>ã€‚</summary>
>
>å‡è®¾è¿”å›çš„å€¼çš„å¼€é—­åŒºé—´æ”¹å˜ï¼š
>
>1. è‹¥è¿”å›çš„æ˜¯ï¼š`(0,1)`ï¼Œåˆ™è¿”å›`Math.floor(Math.random() * (max - min + 2) + min - 1);`ã€‚
>2. è‹¥è¿”å›çš„æ˜¯ï¼š`(0,1]`ï¼Œåˆ™è¿”å›`Math.floor(Math.random() * (max - min + 1) + min - 1);`ã€‚
>3. è‹¥è¿”å›çš„æ˜¯ï¼š`[0,1]`ï¼Œåˆ™è¿”å›`Math.floor(Math.random() * (max - min) + min);`ã€‚
></details>

### *åŸç”ŸJS*é€‰å–èŒƒå›´å†…å¤šä¸ªéšæœºå€¼
```js
/**
 * é€‰å–èŒƒå›´å†…å¤šä¸ªéšæœºå€¼
 * @param {Number} min - ä¸‹é™ï¼ˆæˆ–ä¸Šé™ï¼‰
 * @param {Number} max - ä¸Šé™ï¼ˆæˆ–ä¸‹é™ï¼‰
 * @param {Number} [num = 1] - è¿”å›éšæœºæ•°çš„æ•°é‡
 * @returns {Array|Boolean} - ä¸Šä¸‹é™åŒºé—´å†…çš„numä¸ªéšæœºå€¼ç»„æˆçš„æ•°ç»„ï¼ˆé—­åŒºé—´ï¼Œ[ä¸‹é™, ä¸Šé™]ï¼‰ æˆ– falseï¼ˆé”™è¯¯ï¼‰
 */
function randomsFrom(min, max, num = 1) {
  let temp;

  if (min > max) {
    temp = min;
    min = max;
    max = temp;
  }

  const count = max - min + 1;

  const arr = Array.apply(null, new Array(count)).map(
    (item, index) => index + min
  );

  if (num <= 0 || num > count) {
    return false;
  } else if (num === count) {
    return arr;
  } else {
    const outs = [];
    while (num > outs.length) {
      outs.push(...arr.splice(Math.floor(Math.random() * arr.length), 1));
    }
    return outs.sort((a, b) => a - b);
  }
}
```

### *åŸç”ŸJS*é˜¿æ‹‰ä¼¯æ•°å­—è½¬ä¸­æ–‡
```js
function intToChinese(num = 0) {
  // ä¸è¦è¶…è¿‡æœ€å¤§å®‰å…¨æ•°å­—ï¼Œä¹Ÿå°±æ˜¯ ä¹åƒä¸‡äº¿å¤šï¼ˆå…¶å®æ˜¯ äº¿äº¿ä¹‹åçš„å•ä½ä¸æƒ³æŸ¥äº†ï¼‰
  if (!Number.isSafeInteger(num)) {
    return new Error(`è¶…è¿‡${Number.MAX_SAFE_INTEGER}(${intToChinese(Number.MAX_SAFE_INTEGER)})`);
  }
  if (isNaN(num)) return "é›¶";

  const CHINESE_NUMBERS = [ "é›¶", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹" ];
  const CHINESE_UNITS = [ "", "å", "ç™¾", "åƒ", "ä¸‡", "å", "ç™¾", "åƒ", "äº¿", "å", "ç™¾", "åƒ", "ä¸‡", "å", "ç™¾", "åƒ", "äº¿" ];

  // é€†åºä¸€ä¸‹ï¼Œæ•°ç»„ç¬¬ä¸€ä¸ªé¡¹æ˜¯ä¸ªä½æ•°ï¼Œç¬¬äºŒä¸ªé¡¹æ˜¯åä½æ•°ï¼Œä»¥æ­¤ç±»æ¨
  const numStr = num.toString().split("").reverse();
  let result = "";
  for (let i = 0; i < numStr.length; i++) {
    result = CHINESE_UNITS[i] + result; // å•ä½
    result = CHINESE_NUMBERS[numStr[i]] + result; // å€¼
  }

  // å¤„ç†ä¸­æ–‡æ•°å­—çš„ç‰¹æ®Šæƒ…å†µ
  result = result.replace(/é›¶(åƒ|ç™¾|å)/g, "é›¶").replace(/åé›¶/g, "å");
  result = result.replace(/é›¶+/g, "é›¶");
  result = result.replace(/é›¶äº¿/g, "äº¿").replace(/é›¶ä¸‡/g, "ä¸‡");
  result = result.replace(/äº¿ä¸‡/g, "äº¿");
  result = result.replace(/é›¶+$/, "");
  result = result.replace(/^ä¸€å/g, "å");

  return result;
}
```

---
## å­—ç¬¦ä¸²æ“ä½œ

### *åŸç”ŸJS*è½¬åŒ–ä¸ºUnicodeã€åè½¬å­—ç¬¦ä¸²ã€å­—ç¬¦ä¸²é•¿åº¦ã€æ‰€å å­—èŠ‚æ•°
>æ³¨æ„ï¼šUnicodeç ç‚¹å¤§äº`\uFFFF`ï¼ˆ65535ï¼‰çš„å­—ç¬¦ï¼Œå¦‚ï¼š`'ğŸ’©'.codePointAt(0) // 128169`

1. è½¬åŒ–ä¸ºUnicode

    ```js
    // è½¬åŒ–ä¸ºUnicode
    function toUnicode (words) {
      const arr = []

      for (let i = 0; i < words.length; i++) {
        const unicode = words.charCodeAt(i).toString(16)
        arr[i] = '\\u' + '0'.repeat(4 - unicode.length) + unicode // å•ä¸ªUnicodeï¼š\u+4ä½16è¿›åˆ¶æ•°ï¼›ä¸€ä¸ªå­—å¯èƒ½ä¸æ­¢ä¸€ä¸ªUnicodeï¼Œå¦‚ï¼šğŸ’©
      }

      return arr.join('')
    }


    /* ä½¿ç”¨æµ‹è¯• */
    console.log(toUnicode('ğŸ’©'), toUnicode('å“ˆ'), toUnicode('Â©')) // => \ud83d\udca9 \u54c8 \u00a9
    ```
2. åè½¬å­—ç¬¦ä¸²

    ```js
    // åè½¬å­—ç¬¦ä¸²
    function reverseWords (words) {
      return Array.from(words).reverse().join('')

      // æˆ–ï¼šreturn [...words].reverse().join('');
    }


    /* ä½¿ç”¨æµ‹è¯• */
    console.log(reverseWords('ğŸ’©å“ˆÂ©')) // => Â©å“ˆğŸ’©
    ```
3. å­—ç¬¦ä¸²é•¿åº¦

    ```js
    // å­—ç¬¦ä¸²é•¿åº¦
    function codePointLength (words) {
      const result = words.match(/[\s\S]/gu)
      return result ? result.length : 0

      // æˆ–ï¼šreturn [...words].length;
    }


    /* ä½¿ç”¨æµ‹è¯• */
    console.log(codePointLength('ğŸ’©å“ˆÂ©'))  // => 3
    ```
4. æ‰€å å­—èŠ‚æ•°

    ```js
    /**
     * æ‰€å å­—èŠ‚æ•°
     *
     * UTF-8 ä¸€ç§å¯å˜é•¿åº¦çš„Unicodeç¼–ç æ ¼å¼ï¼Œä½¿ç”¨ä¸€è‡³å››ä¸ªå­—èŠ‚ä¸ºæ¯ä¸ªå­—ç¬¦ç¼–ç ï¼ˆUnicodeåœ¨èŒƒå›´ D800-DFFF ä¸­ä¸å­˜åœ¨ä»»ä½•å­—ç¬¦ï¼‰
     * 000000 - 00007F(128ä¸ªä»£ç )      0zzzzzzz(00-7F)                             ä¸€ä¸ªå­—èŠ‚
     * 000080 - 0007FF(1920ä¸ªä»£ç )     110yyyyy(C0-DF) 10zzzzzz(80-BF)             ä¸¤ä¸ªå­—èŠ‚
     * 000800 - 00D7FF
     * 00E000 - 00FFFF(61440ä¸ªä»£ç )    1110xxxx(E0-EF) 10yyyyyy 10zzzzzz           ä¸‰ä¸ªå­—èŠ‚
     * 010000 - 10FFFF(1048576ä¸ªä»£ç )  11110www(F0-F7) 10xxxxxx 10yyyyyy 10zzzzzz  å››ä¸ªå­—èŠ‚
     * {@link https://zh.wikipedia.org/wiki/UTF-8}
     *
     * UTF-16 ç¼–ç 65535ä»¥å†…ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ç¼–ç ï¼Œè¶…å‡º65535çš„ä½¿ç”¨å››ä¸ªå­—èŠ‚ï¼ˆJSå†…éƒ¨ï¼Œå­—ç¬¦å‚¨å­˜æ ¼å¼æ˜¯ï¼šUCS-2â€”â€”UTF-16çš„å­çº§ï¼‰
     * 000000 - 00FFFF  ä¸¤ä¸ªå­—èŠ‚
     * 010000 - 10FFFF  å››ä¸ªå­—èŠ‚
     * {@link https://zh.wikipedia.org/wiki/UTF-16}
     *
     * GBK(ASCIIçš„ä¸­æ–‡æ‰©å±•) é™¤äº†0~126ç¼–å·æ˜¯1ä¸ªå­—èŠ‚ä¹‹å¤–ï¼Œå…¶ä»–éƒ½2ä¸ªå­—èŠ‚ï¼ˆè¶…è¿‡65535ä¼šç”±2ä¸ªå­—æ˜¾ç¤ºï¼‰
     * {@link https://zh.wikipedia.org/wiki/æ±‰å­—å†…ç æ‰©å±•è§„èŒƒ}
     *
     * @param  {String} str
     * @param  {String} [charset= 'gbk'] utf-8, utf-16
     * @return {Number}
     */
    function sizeofByte (str, charset = 'gbk') {
      let total = 0
      let charCode

      charset = charset.toLowerCase()

      if (charset === 'utf-8' || charset === 'utf8') {
        for (let i = 0, len = str.length; i < len; i++) {
          charCode = str.codePointAt(i)

          if (charCode <= 0x007f) {
            total += 1
          } else if (charCode <= 0x07ff) {
            total += 2
          } else if (charCode <= 0xffff) {
            total += 3
          } else {
            total += 4
            i++
          }
        }
      } else if (charset === 'utf-16' || charset === 'utf16') {
        for (let i = 0, len = str.length; i < len; i++) {
          charCode = str.codePointAt(i)

          if (charCode <= 0xffff) {
            total += 2
          } else {
            total += 4
            i++
          }
        }
      } else {
        total = str.replace(/[^\x00-\xff]/g, 'aa').length
      }

      return total
    }


    /* ä½¿ç”¨æµ‹è¯• */
    console.log(sizeofByte('ğŸ’©'), sizeofByte('å“ˆ'), sizeofByte('Â©')) // => 4 2 1
    ```

### *åŸç”ŸJS*å­—ç¬¦ä¸²åŒ¹é…ã€æ›¿æ¢
```js
/**
 * å­—ç¬¦ä¸²åŒ¹é…å¹¶æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ä¸²
 * @param {String} key - è¢«åŒ¹é…å†…å®¹
 * @param {String} sentence - åŸå§‹å­—ç¬¦ä¸²
 * @param {String} prefix - åŒ¹é…å¤„å¢åŠ çš„å‰ç¼€
 * @param {String} suffix - åŒ¹é…å¤„å¢åŠ çš„åç¼€
 * @param {String} [keyReplace = key] - æ›¿æ¢å†…å®¹
 * @returns {String} - åŒ¹é…åçš„å­—ç¬¦ä¸²
 */
function highlightWords ({ key, sentence, prefix = '', suffix = '', keyReplace = key }) {
  // æŠŠéœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸²é‡Œ`æ­£åˆ™è¡¨è¾¾å¼éœ€è¦è½¬ä¹‰çš„ç‰¹æ®Šå­—ç¬¦`ï¼ˆé™¤å»åŸæœ¬åœ¨å­—ç¬¦ä¸²ä¸­ä½œä¸ºè½¬ä¹‰çš„`\`ï¼‰å‰æ·»åŠ `\\`
  const keyReformat = key.replace(/([()[\]{}\\/^$|?*+.])/g, '\\$1')

  const regexp = new RegExp(keyReformat, 'g')

  return sentence.replace(regexp, `${prefix + keyReplace + suffix}`)
}


/* ä½¿ç”¨æµ‹è¯• */
highlightWords({
  key: 'abc',
  sentence: 'abc123aabbccabc123',
  prefix: '<span style="color: red;">',
  suffix: '</span>',
  keyReplace: 'è¢«é€‰ä¸­'
})
```

### *åŸç”ŸJS*åˆ†å‰²å­—ç¬¦ä¸²
```js
/**
 * æŒ‰å•ä¸ªå­—åˆ†å‰²å­—ç¬¦ä¸²ï¼ˆå¼¥è¡¥String.prototype.splitä¼šåˆ†å‰²65535ä»¥ä¸Šçš„å­—ä¸º2ä¸ªå­—ï¼‰
 * @param  {String} str
 * @return {Array} resultArray - åˆ†å‰²å­—ç¬¦ä¸²åçš„æ•°ç»„
 */
function split (str) {
  const resultArray = []

  for (let i = 0, len = str.length; i < len; i++) {
    if (str.codePointAt(i) <= 0xffff) {
      resultArray.push(str[i])
    } else {
      resultArray.push(str[i] + str[i + 1])
      i++
    }
  }

  return resultArray
}


/* ä½¿ç”¨æµ‹è¯• */
console.log(split('ğŸ’©1ağŸ’©å“ˆã€‚.â†‘'))  // => ["ğŸ’©", "1", "a", "ğŸ’©", "å“ˆ", "ã€‚", ".", "â†‘"]
```

### *åŸç”ŸJS*æ•°å­—å¢åŠ åˆ†éš”ç¬¦
```ts
// æ¯nä½æ•°æ·»åŠ ä¸€ä¸ªåˆ†éš”ç¬¦
export function numberSeparator({
  num,
  gap = 3,
  separator = ","
}: {
  num: number;
  gap?: number;
  separator?: string;
}): string {
  const strSplit = num.toString().split(".");
  const integer = strSplit[0];
  const decimal = strSplit[1] ? `.${strSplit[1]}` : "";

  const reg = new RegExp(`\\B(?=(\\d{${gap}})+(?!\\d))`, "g");
  return integer.replace(reg, separator) + decimal;
}


/* ä½¿ç”¨æµ‹è¯• */
numberSeparator({ num: 12345.123 })  // -> '12,345.123'
```

### *åŸç”ŸJS*äº§ç”Ÿéšæœºæ•°
```js
/**
 * éšæœºæ•°äº§ç”Ÿ
 * @param {Number} length - éšæœºæ•°é•¿åº¦
 * @param {String} [charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'] - éšæœºæ•°çš„å­—ç¬¦
 * @returns {String} - éšæœºæ•°
 */
function random (length, charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789') {
  return Array.from({ length }, () => {
    return charset.charAt(Math.floor(Math.random() * charset.length))
  }).join('')
}
```

### *åŸç”ŸJS*åˆ¤æ–­ç‰ˆæœ¬å·æ˜¯å¦åœ¨æŸä¸ªç‰ˆæœ¬åŒºé—´ï¼ˆçº¯æ•°å­—ï¼‰
```js
/**
 * åˆ¤æ–­ç‰ˆæœ¬å·æ˜¯å¦åœ¨æŸä¸ªç‰ˆæœ¬åŒºé—´ï¼ˆçº¯æ•°å­—ï¼‰
 * @param {Number|String} version - åˆ¤æ–­çš„ç‰ˆæœ¬å·
 * @param {Number|String} base - ç‰ˆæœ¬åŒºé—´æˆ–ç‰ˆæœ¬ï¼ˆå¦‚ï¼š123 æˆ– 123- æˆ– -123 æˆ– 123-456ï¼‰
 * @param {String} [separator = '-'] - ç‰ˆæœ¬åŒºé—´
 * @returns {Boolean} - æ˜¯å¦åœ¨åŒºé—´
 */
function isVersionIncluded (version, base, separator = '-') {
  version = String(version)
  base = String(base)

  if (version === base) {
    return true
  } else {
    const vArr = base.split(separator)
    if (vArr.length === 1) {
      return false
    } else {
      version = parseInt(version)
      if (vArr[0] === '') {
        if (vArr[1] && version <= parseInt(vArr[1])) {
          return true
        }
      } else if (vArr[1] === '') {
        if (vArr[0] && version >= parseInt(vArr[0])) {
          return true
        }
      } else {
        if ((vArr[0] && version >= parseInt(vArr[0])) && (vArr[1] && version <= parseInt(vArr[1]))) {
          return true
        }
      }
    }
  }

  return false
}


/* ä½¿ç”¨æµ‹è¯• */
console.log(isVersionIncluded(123, '123'), '=> true')
console.log(isVersionIncluded(123, '-22'), '=> false')
console.log(isVersionIncluded(123, '-222'), '=> true')
console.log(isVersionIncluded(123, '123-'), '=> true')
console.log(isVersionIncluded(123, '124-'), '=> false')
console.log(isVersionIncluded(123, '1-122'), '=> false')
console.log(isVersionIncluded(123, '123-200'), '=> true')
console.log(isVersionIncluded('asd', '123-200'), '=> false')
console.log(isVersionIncluded('1', '5-6'), '=> false')
```

### *åŸç”ŸJS*åˆ¤æ–­æ£€ç´¢å†…å®¹æ˜¯å¦åœ¨è¢«æ£€ç´¢å†…å®¹çš„åˆ†éš”ç¬¦é—´
```js
/**
 * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ä»¥separatoråˆ†å‰²çš„strå½“ä¸­
 * @param {Number|String} key - æ£€ç´¢å†…å®¹
 * @param {Number|String} str - è¢«æ£€ç´¢å†…å®¹
 * @param {String} [separator = '|'] - strçš„åˆ†éš”ç¬¦
 * @returns {Boolean} flag
 */
function isKeyInStr(key, str, separator) {
    separator = separator || '|';

    var flag = false,
        strArr, i;

    key = key.toString();
    str = str.toString();

    strArr = str.split(separator);

    for (i = 0; i < strArr.length; i++) {
        if (key === strArr[i]) {
            flag = true;

            break;
        }
    }

    return flag;
}


/* ä½¿ç”¨æµ‹è¯• */
isKeyInStr('d','abc|d|efg123','|')  // -> true
```

### *åŸç”ŸJS*æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
```js
/**
 * æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
 */
function fileSize (bytes = 0) {
  if (bytes === 0) {
    return '0'
  }

  const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'] // å•ä½
  const rate = 1024 // æ¢ç®—å…³ç³»
  const exponent = Math.min( // æ‰€åœ¨å•ä½
    Math.floor(Math.log(bytes) / Math.log(rate)),
    units.length - 1
  )
  let value = bytes / (rate ** exponent)  // å€¼

  // ç²¾ç¡®ä½æ•°
  value = (exponent === 0 || value > 1000)
    ? Math.round(value)
    : value.toPrecision(3)

  return value + units[exponent]  // å€¼ + å•ä½
}


/* ä½¿ç”¨æµ‹è¯• */
fileSize(æ•°å­—)
```

### *åŸç”ŸJS*å•è¯é¦–å­—æ¯å¤§å†™
```js
function upperCaseWord(str) {

    return str.replace(/\b[a-zA-Z]/g, function (match) {

        return match.toUpperCase();
    });
}
```

### *åŸç”ŸJS*æ–‡ä»¶æ‰©å±•å
```js
/**
 * è¿”å›æ–‡ä»¶æ‰©å±•åï¼ˆæ³¨æ„ï¼Œæ²¡æœ‰è¿›è¡ŒtoLowerCaseï¼‰ï¼šç®€å•å®ç°Node.jsçš„path.extnameï¼Œæœªå¤„ç†éä¸€èˆ¬æ–‡ä»¶åçš„æƒ…å†µ
 * @param {String} filename - æ–‡ä»¶åå­—ç¬¦ä¸²
 * @param {Boolean} [needSeparator = true] - è¿”å›å†…å®¹æ˜¯å¦åŒ…å«åˆ†éš”ç¬¦.
 * @returns {String} - æ–‡ä»¶æ‰©å±•å
 */
function getFileExtension(filename, needSeparator = true) {
  const firstDotIndex = filename.indexOf('.');
  const lastDotIndex = filename.lastIndexOf('.');

  if ((filename.startsWith('.') && firstDotIndex === lastDotIndex) || firstDotIndex === -1) {
    // å¤„ç†ç‰¹æ®Šæƒ…å†µ
    return '';
  }

  return filename.slice(needSeparator ? lastDotIndex : lastDotIndex + 1);
}


/* ä½¿ç”¨æµ‹è¯• */
const path = require('node:path');
console.log(`æœŸæœ›è¾“å‡ºï¼š"${path.extname('')}"ã€‚`, getFileExtension('') === path.extname(''));
console.log(`æœŸæœ›è¾“å‡ºï¼š"${path.extname('.')}"ã€‚`, getFileExtension('.') === path.extname('.'));
console.log(`æœŸæœ›è¾“å‡ºï¼š"${path.extname('ABC.')}"ã€‚`, getFileExtension('ABC.') === path.extname('ABC.'));
console.log(`æœŸæœ›è¾“å‡ºï¼š"${path.extname('ABC')}"ã€‚`, getFileExtension('ABC') === path.extname('ABC'));
console.log(`æœŸæœ›è¾“å‡ºï¼š"${path.extname('.ABC')}"ã€‚`, getFileExtension('.ABC') === path.extname('.ABC'));
console.log(`æœŸæœ›è¾“å‡ºï¼š"${path.extname('1.ABC')}"ã€‚`, getFileExtension('1.ABC') === path.extname('1.ABC'));
console.log(`æœŸæœ›è¾“å‡ºï¼š"${path.extname('1.2.3.a.b.ABC')}"ã€‚`, getFileExtension('1.2.3.a.b.ABC') === path.extname('1.2.3.a.b.ABC'));
console.log(`æœŸæœ›è¾“å‡ºï¼š"${path.extname('.ABC.md')}"ã€‚`, getFileExtension('.ABC.md') === path.extname('.ABC.md'));
```

---
## æ•°ç»„æ“ä½œ

### *åŸç”ŸJS*æ•°ç»„å»é‡ï¼ˆé¡¹ä¸ºå¯¹è±¡ï¼‰
```js
/**
 * è·å–å¯¹è±¡æŒ‡å®šæ·±åº¦å±æ€§
 * @param {Object} source - è¦å¤„ç†çš„å¯¹è±¡
 * @param {Array} path - è·¯å¾„æ·±åº¦
 * @returns result - å±æ€§å€¼
 */
function get(source, path) {
  let result = source;
  for (const key of path) {
    if (Object.hasOwn(result, key)) {
      result = result[key];
    } else {
      return undefined;
    }
  }
  return result;
}

/**
 * æ•°ç»„å»é‡ï¼ˆé¡¹ä¸ºå¯¹è±¡ï¼‰
 * @param {Array} arr - è¦å¤„ç†çš„æ•°ç»„
 * @param {Array} path - è·¯å¾„æ·±åº¦
 * @returns å»é‡åçš„æ•°ç»„
 */
function deduplicateArray (arr, path = []) {
  if (path.length > 0) {
    const newArr = [];
    return arr.filter((data) => {
      const id = get(data, path);
      if (newArr.includes(id)) {
        return false;
      } else {
        newArr.push(id);
        return true;
      }
    });
  } else {
    return Array.from(new Set(arr));
  }
}


/* ä½¿ç”¨æµ‹è¯• */
deduplicateArray( // [idä»1åˆ°4çš„å¯¹è±¡]
  [
    { id: 1, text: "aaaaa" },
    { id: 2, text: "bbbb" },
    { id: 3, text: "cccc" },
    { id: 1, text: "dddd" },
    { id: 4, text: "eeee" }
  ],
  ["id"]
);
deduplicateArray([1, 2, 3, 1, 4]);    // [1, 2, 3, 4]
```

### æ•°ç»„å»é‡
>æ¥è‡ªï¼š[JavaScript æ•°ç»„å»é‡](https://github.com/hanzichi/underscore-analysis/issues/9)ã€‚

1. å®šä¹‰ä¸€ä¸ªç©ºæ•°ç»„å˜é‡ï¼Œéå†éœ€è¦å»é‡çš„æ•°ç»„ï¼šè‹¥é¡¹çš„å€¼ä¸å­˜åœ¨æ–°æ•°ç»„ä¸­ï¼Œåˆ™æ”¾å…¥æ–°æ•°ç»„ï¼›è‹¥å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸¢å¼ƒã€‚

    >é‡å¤çš„é¡¹å–æœ€å‰çš„æ”¾å…¥æ–°æ•°ç»„ã€‚

    1. ä½¿ç”¨`Array.prototype.indexOf`ã€`Array.prototype.filter`

        ```js
        function uniqueArr (arr) {
          return arr.filter((item, index, array) => array.indexOf(item) === index)
        }
        ```
    2. ä¸ä½¿ç”¨~~Array.prototype.indexOf~~ã€~~Array.prototype.filter~~

        ```js
        function uniqueArr(arr) {
            var newArr = [],
                i, j, iLen, jLen, item;

            for (i = 0, iLen = arr.length; i < iLen; i++) {
                item = arr[i];

                for (j = 0, jLen = newArr.length; j < jLen; j++) {
                    if (newArr[j] === item) {
                        break;
                    }
                }

                if (j === jLen) {
                    newArr.push(item);
                }
            }

            return newArr;
        }
        ```
    >æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)ã€‚
2. å®šä¹‰ä¸€ä¸ªç©ºæ•°ç»„å˜é‡ï¼Œéå†éœ€è¦å»é‡çš„æ•°ç»„ï¼šè‹¥é¡¹çš„å€¼åœ¨åŸæ•°ç»„ä¸­å”¯ä¸€ï¼Œåˆ™æ”¾å…¥æ–°æ•°ç»„ï¼›è‹¥ä¸å”¯ä¸€ï¼Œä¸¢å¼ƒå¹¶ç»§ç»­å‘åéå†ã€‚

    >é‡å¤çš„é¡¹å–æœ€åçš„æ”¾å…¥æ–°æ•°ç»„ã€‚

    ```js
    function uniqueArr(arr) {
        var newArr = [],
            len = arr.length,
            i, j;

        for (i = 0; i < len; i++) {
            for (j = i + 1; j < len; j++) {
                if (arr[i] === arr[j]) {    // è‹¥å‘ç°ç›¸åŒå…ƒç´ ï¼Œåˆ™iè‡ªå¢å¹¶ä¸”è¿›å…¥ä¸‹ä¸€ä¸ªæ•°çš„å¾ªç¯æ¯”è¾ƒ
                    i += 1;
                    j = i;
                }
            }

            newArr.push(arr[i]);
        }

        return newArr;
    }
    ```
    >æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)ã€‚
3. å…ˆæ’åºåŸå§‹æ•°ç»„ï¼ˆéœ€è¦é¢å¤–æ’åºç®—æ³•ï¼Œå¦åˆ™åªèƒ½å¤„ç†Numberå‹æ•°æ®ï¼‰ï¼Œç¬¬ä¸€é¡¹åŠ å…¥ï¼Œä¹‹åæ¯ä¸ªé¡¹å¯¹æ¯”å‰ä¸€ä¸ªé¡¹ï¼šè‹¥ä¸åŒï¼Œåˆ™åŠ å…¥ï¼›è‹¥ç›¸åŒï¼Œåˆ™ä¸¢å¼ƒã€‚

    ```js
    function uniqueArr (arr) {
      return arr.concat().sort().filter((item, index, array) => !index || item !== array[index - 1])
    }
    ```
    >æ—¶é—´å¤æ‚åº¦ï¼šO(n) + æ•°ç»„æ’åºã€‚
4. ç”¨å¯¹è±¡ï¼ˆå“ˆå¸Œè¡¨ï¼‰å»é‡ï¼ˆåªèƒ½å¤„ç†Numberå‹æ•°æ®ï¼‰ã€‚

    ```js
    function uniqueArr (arr) {
      const obj = {}

      return arr.filter((item) => obj.hasOwnProperty(item) ? false : (obj[item] = true))
    }
    ```
    >æ—¶é—´å¤æ‚åº¦ï¼šO(n)ã€‚
5. ES6çš„`Set`

    ```js
    function uniqueArr(arr) {
        return Array.from(new Set(arr));
        // æˆ–ï¼šreturn [...new Set(arr)];
    }
    ```

### æ•°ç»„åˆ å»æŸå€¼
1. ä½¿ç”¨`Array.prototype.splice`ï¼š

    ```js
    function reduceArr(arr, delValue) {
        arr = arr.slice();

        var i, len;

        for (i = 0, len = arr.length; i < len; i++) {
            if (arr[i] === delValue) {
                arr.splice(i, 1);
                i--;
            }
        }

        return arr;
    }
    ```
2. ä½¿ç”¨æ–°æ•°ç»„ä¿å­˜ï¼š

    ```js
    function reduceArr(arr, delValue) {
        var newArr = [],
            i, len;

        for (i = 0, len = arr.length; i < len; i++) {
            if (arr[i] !== delValue) {
                newArr.push(arr[i]);
            }
        }

        return newArr;
    }
    ```
3. ä½¿ç”¨`Array.prototype.filter`ï¼ˆæ•°ç»„ç©ºä½ä¸éå†ï¼‰ï¼š

    ```js
    function reduceArr (arr, delValue) {
      return arr.filter((value) => value !== delValue)
    }
    ```
4. leetcodeè§£æ³•ï¼š[ç§»é™¤å…ƒç´ ](https://github.com/realgeoffrey/knowledge/blob/master/ç½‘ç«™å‰ç«¯/æ•°æ®ç»“æ„ä¸ç®—æ³•/LeetCodeè®°å½•/README.md#ç§»é™¤å…ƒç´ )

### æ•°ç»„çš„æŸé¡¹æ’å…¥æŸä½ç½®
```js
/**
 * ç§»åŠ¨æ•°ç»„çš„é¡¹ï¼Œä»ä¸€ä¸ªä½ç½®æ’å…¥è‡³å¦ä¸€ä¸ªä½ç½®ï¼ˆä¸æ˜¯è°ƒæ¢ä½ç½®ï¼‰
 * @param {Array} arr - æ•°ç»„
 * @param {Number} from - åŸæ•°ç»„èµ·å§‹ä½ç½®
 * @param {Number} to - åŸæ•°ç»„æ’å…¥ä½ç½®
 * @param {Boolean} [isLeft = false] - æ˜¯å¦æ’å…¥å·¦è¾¹ï¼ˆé»˜è®¤ï¼šæ’å…¥å³è¾¹ï¼‰
 * @returns {Array} arr - è°ƒæ¢ä½ç½®çš„æ•°ç»„
 */
function switchArr ({ arr, from, to, isLeft = false }) {
  arr = arr.slice()

  if (isLeft) {
    if (from < to - 1) {
      arr.splice(to - 1, 0, ...arr.splice(from, 1))
    } else if (from >= to + 1) {
      arr.splice(to, 0, ...arr.splice(from, 1))
    }
  } else {
    if (from > to + 1) {
      arr.splice(to + 1, 0, ...arr.splice(from, 1))
    } else if (from < to) {
      arr.splice(to, 0, ...arr.splice(from, 1))
    }
  }

  return arr
}
```

### å£°æ˜æŸé•¿åº¦å¹¶è®¾å®šå€¼çš„æ•°ç»„
>e.g. å£°æ˜arrï¼šé•¿åº¦ä¸ºnï¼Œå€¼ä¸ºä¸‹æ ‡ï¼ˆæˆ–æŸå›ºå®šå€¼ï¼‰

1. ç›´æ¥åˆ›å»ºå¹¶å¾ªç¯èµ‹å€¼

    1. å­—é¢é‡

        ```js
        var n = 55;

        var arr = [],
            i;

        for (i = 0; i < n; i++) {
            arr[i] = i;
        }
        ```
    2. `Array`æ„é€ å‡½æ•°ï¼š

        ```js
        var n = 55;

        var arr = new Array(n),
            i, len;

        for (i = 0, len = arr.length; i < len; i++) {
            arr[i] = i;
        }
        ```
2. `Array.prototype.map`èµ‹å€¼

    1. `Array`ï¼š

        ```js
        var n = 55

        var arr = Array.apply(null, new Array(n)).map((item, index) => index)
        ```
    2. `Array`ã€`join`ã€`split`ï¼š

        ```js
        var n = 55

        var arr = new Array(n + 1).join().split('').map((item, index) => index)
        ```
    3. `Object.keys`ã€`Array`ã€`toString`ã€`split`ï¼š

        ```js
        var n = 55

        var arr = Object.keys(new Array(n + 1).toString().split('')).map((item, index) => index)
        ```
3. ES6çš„`Array.from`

    ```js
    var n = 55

    var arr = Array.from({ length: n }, (value, index) => index)
    ```
4. çº¯æ‰‹æ‰“å­—é¢é‡ï¼ˆæ€§èƒ½æœ€å¥½æ–¹å¼ï¼‰

---
## åŠŸèƒ½

### *åŸç”ŸJS*ç”¨è¯·æ±‚å›¾ç‰‡ä½œlogç»Ÿè®¡
```js
var sendLog = (function () {
    if (typeof Date.now !== 'function') {
        Date.now = function () {
            return new Date().getTime();
        };
    }

    var _unique = (function () {    /* äº§ç”Ÿå”¯ä¸€æ ‡è¯† */
        var time = Date.now() + '_',
            i = 0;

        return function () {
            i += 1;

            return time + i - 1;
        }
    }());

    var run = function (url) {
        var data = window['imgLogData'] || (window['imgLogData'] = {}),
            img = new Image(),
            uid = _unique();

        data[uid] = img;    // é˜²æ­¢imgè¢«åƒåœ¾å¤„ç†

        img.onload = img.onerror = function () {    /* æˆåŠŸæˆ–å¤±è´¥åé”€æ¯å¯¹è±¡ */
            img.onload = img.onerror = null;
            img = null;
            delete data[uid];
        };

        img.src = url + '&_cache=' + uid;   // å‘é€ç»Ÿè®¡å†…å®¹
    };

    return run;
}());


/* ä½¿ç”¨æµ‹è¯• */
sendLog('ç»Ÿè®¡url');
```

### *åŸç”ŸJS*éªŒè¯é‚®ç®±æœ‰æ•ˆæ€§
>æ¥è‡ªï¼š[Stack Overflow: Validate email address in JavaScript?](http://stackoverflow.com/questions/46155/validate-email-address-in-javascript#answer-46181)ã€‚

```js
function validateEmail(email) {

    return /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email);
}
```

>ä¸å­˜åœ¨å¯ä»¥åˆ¤æ–­ä¸–ç•Œä»»ä½•ä¸€ä¸ªæœ‰æ•ˆé‚®ç®±çš„æ­£åˆ™ã€‚

>åŒ¹é…ä¸­å›½å¤§é™†æ‰‹æœºå·ç çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š[ChinaMobilePhoneNumberRegex](https://github.com/VincentSit/ChinaMobilePhoneNumberRegex)ã€‚

### *åŸç”ŸJS*åˆ›å»ºå…¼å®¹çš„XHRå¯¹è±¡
```js
function createXHR() {
    if (typeof XMLHttpRequest !== 'undefined') {    // ie7+å’Œå…¶ä»–æµè§ˆå™¨

        return new XMLHttpRequest();
    } else if (typeof ActiveXObject !== 'undefined') {
        if (typeof arguments.callee.activeXString !== 'string') {
            var versions = ['MSXML2.XMLHttp.6.0', 'MSXML2.XMLHttp.3.0', 'MSXML2.XMLHttp'],
                i, len;

            for (i = 0, len = versions.length; i < len; i++) {
                try {
                    new ActiveXObject(versions[i]);
                    arguments.callee.activeXString = versions[i];
                    break;
                } catch (e) {
                    // è·³è¿‡
                }
            }
        }

        return new ActiveXObject(arguments.callee.activeXString);   // è¿”å›ActiveXObjectå¯¹è±¡
    } else {// å…¨éƒ¨ä¸æ”¯æŒï¼ŒæŠ›å‡ºé”™è¯¯
        throw new Error('don\'t support XMLHttpRequest');
    }
}


/* ä½¿ç”¨æµ‹è¯• */
var xhr = createXHR();

xhr.onreadystatechange = function () {  // æˆ–DOM2çº§ã€ieäº‹ä»¶ç»‘å®šæ–¹å¼
    if (xhr.readyState === 4) {
        console.log(xhr.getResponseHeader(æŸå“åº”å¤´), xhr.getAllResponseHeaders());

        if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304) {
            console.log(xhr.responseText);
        } else {
            console.log('è¯·æ±‚å¤±è´¥ï¼š' + xhr.status);
        }

        // xhr.abort();
        // xhr = null;
    }
};
xhr.open(è¯·æ±‚ç±»å‹, URL[, æ˜¯å¦å¼‚æ­¥[, ç”¨æˆ·å[, å¯†ç ]]]);
xhr.setRequestHeader(æŸè¯·æ±‚å¤´, å€¼);
xhr.send(null);
```

### *åŸç”ŸJS*åŠ¨æ€æ·»åŠ è„šæœ¬ã€æ ·å¼
1. åŠ¨æ€æ·»åŠ è„šæœ¬

    1. å¼‚æ­¥ï¼ˆJSæ–‡ä»¶åœ°å€ï¼‰

        1. JSONP

            >åŠ¨æ€åˆ›å»ºçš„`<script>`é»˜è®¤æ˜¯`async`ï¼ˆå¯ä»¥æ‰‹åŠ¨è®¾ç½®`dom.async = false`ï¼Œè¿™æ ·å°±æ˜¯`defer`æ•ˆæœâ€”â€”æŒ‰æ·»åŠ é¡ºåºåŠ è½½ï¼Œå°½ç®¡æ­¤æ—¶`dom.defer === false`ï¼‰ã€‚

            ```js
            const newScript = document.createElement('script')
            const appendPlace = document.getElementsByTagName('body')[0] || document.getElementsByTagName('head')[0]

            newScript.src = 'JSæ–‡ä»¶åœ°å€'

            appendPlace.appendChild(newScript)
            ```

        2. <details>

            <summary>ï¼ˆæ–‡æ¡£æœªåŠ è½½å®Œæˆæ—¶ï¼‰ç›´æ¥<code>document.write</code></summary>

            >å› ä¸º`document.write`éœ€è¦å‘æ–‡æ¡£æµä¸­å†™å…¥å†…å®¹ï¼Œå› æ­¤åœ¨å…³é—­ï¼ˆå·²åŠ è½½ï¼‰çš„æ–‡æ¡£ä¸Šè°ƒç”¨`document.write`ä¼šè‡ªåŠ¨è°ƒç”¨`document.open`ï¼Œè¿™å°†æ¸…ç©ºè¯¥æ–‡æ¡£çš„å†…å®¹ã€‚

            ```js
            document.write('<script src="JSæ–‡ä»¶åœ°å€"><\/script>');
            ```
            </details>
    2. åŒæ­¥ï¼ˆJSä»£ç æ–‡æœ¬ï¼‰

        >åŠ¨æ€åˆ›å»ºçš„ã€æ²¡æœ‰`src`å±æ€§çš„ã€é€šè¿‡`text`å±æ€§è®¾ç½®JSä»£ç æ–‡æœ¬çš„`<script>`ï¼Œæ·»åŠ åçš„è„šæœ¬è¢«é©¬ä¸Šæ‰§è¡Œï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯å½“å‰è„šæœ¬ä¸€éƒ¨åˆ†ï¼Œä½†å®é™…ä¸æ˜¯ï¼Œä½œç”¨åŸŸä¸åŒï¼›è¿™ä¸ªä¹Ÿæ˜¯jQueryçš„ajaxåŠ è½½æ‰§è¡Œå¤–éƒ¨JSè„šæœ¬çš„æ–¹å¼ï¼‰ã€‚

        ```js
        var newScript = document.createElement('script')
        var appendPlace = document.getElementsByTagName('body')[0] || document.getElementsByTagName('head')[0]

        try {
            newScript.appendChild(document.createTextNode('JSä»£ç æ–‡æœ¬'))
        } catch (e) {
            newScript.text = 'JSä»£ç æ–‡æœ¬'  // ie8-ï¼ŒSafariè€ç‰ˆæœ¬
        }

        appendPlace.appendChild(newScript)  // å¼€å§‹åŒæ­¥æ‰§è¡Œ`JSä»£ç æ–‡æœ¬`ï¼ˆæ–°å»ºä¸€ä¸ªç‹¬ç«‹ä½œç”¨åŸŸï¼‰

        // ä¸Šé¢ä»£ç åŒæ­¥æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œä¸‹é¢çš„ä»£ç 
        ```

        - <details>

            <summary>é€šè¿‡<code>XMLHttpRequest</code>çš„åŒæ­¥è¯·æ±‚è·å¾—JSä»£ç æ–‡æœ¬</summary>

            ```js
            /**
             * åŒæ­¥åŠ è½½JSè„šæœ¬
             * @param {String} url - JSæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„
             * @returns {Boolean} - æ˜¯å¦åŠ è½½æˆåŠŸ
             */
            function syncLoadJS(url) {
              var xmlHttp, appendPlace, newScript;

              if (window.ActiveXObject) {
                /* ie */
                try {
                  xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
                } catch (e) {
                  xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
              } else if (window.XMLHttpRequest) {
                xmlHttp = new XMLHttpRequest();
              }

              xmlHttp.open("GET", url, false); // é‡‡ç”¨åŒæ­¥åŠ è½½
              xmlHttp.send(null); // å‘é€åŒæ­¥è¯·æ±‚ï¼Œè‹¥æµè§ˆå™¨ä¸ºChromeæˆ–Operaï¼Œåˆ™å¿…é¡»å‘å¸ƒåæ‰èƒ½è¿è¡Œï¼Œä¸ç„¶ä¼šæŠ¥é”™

              /* 4ä»£è¡¨æ•°æ®å‘é€å®Œæ¯• */
              if (xmlHttp.readyState === 4) {
                /* 0ä¸ºè®¿é—®çš„æœ¬åœ°ï¼Œ200åˆ°300ä»£è¡¨è®¿é—®æœåŠ¡å™¨æˆåŠŸï¼Œ304ä»£è¡¨æ²¡åšä¿®æ”¹è®¿é—®çš„æ˜¯ç¼“å­˜ */
                if ((xmlHttp.status >= 200 && xmlHttp.status < 300) || xmlHttp.status === 0 || xmlHttp.status === 304) {
                  newScript = document.createElement("script");
                  appendPlace = document.getElementsByTagName("body")[0] || document.getElementsByTagName("head")[0];

                  try {
                    newScript.appendChild(document.createTextNode(xmlHttp.responseText));
                  } catch (e) {
                    newScript.text = xmlHttp.responseText;
                  }

                  appendPlace.appendChild(newScript);

                  return true;
                } else {
                  return false;
                }
              } else {
                return false;
              }
            }
            ```
            </details>
2. åŠ¨æ€æ·»åŠ æ ·å¼

    >æ ·å¼çš„æ‰€æœ‰3ç§æƒ…å†µï¼ˆ`<style>`ã€`<link>`ã€`style`å†…åµŒæ ·å¼ï¼‰ï¼ŒåŠ¨æ€æ·»åŠ æˆ–åˆ é™¤ä¹‹åéƒ½æ˜¯é©¬ä¸Šé‡æ–°è®¡ç®—CSSOMï¼Œç„¶åæ¸²æŸ“ã€‚

    1. æ·»åŠ `<style>`

        ```js
        var newStyle = document.createElement('style');

        newStyle.type = 'text/css';

        try {
            newStyle.appendChild(document.createTextNode('CSSä»£ç æ–‡æœ¬'));
        }
        catch (e) {
            newStyle.styleSheet.cssText = 'CSSä»£ç æ–‡æœ¬';  // ie
        }

        document.getElementsByTagName('head')[0].appendChild(newStyle);
        ```
    2. æ·»åŠ `<link>`

        >å¿…é¡»å°†`<link>`æ·»åŠ åˆ°`<head>`ï¼Œæ‰èƒ½ä¿è¯åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­çš„è¡Œä¸ºä¸€è‡´ã€‚

        ```js
        var newLink = document.createElement('link');

        newLink.rel = 'styleSheet';
        newLink.type = 'text/css';

        newLink.href = 'CSSæ–‡ä»¶åœ°å€';

        document.getElementsByTagName('head')[0].appendChild(newLink);
        ```
    3. æ·»åŠ `style`å†…åµŒæ ·å¼

        ```js
        var oneDom = document.getElementById('èŠ‚ç‚¹id');

        oneDom.style.cssText += '; CSSä»£ç æ–‡æœ¬'
        ```

    >CSSä»£ç æ–‡æœ¬ï¼Œå¦‚ï¼š`div {background-color: yellow;}`ã€‚

### *åŸç”ŸJS*è·å–æ˜Ÿåº§
```js
/**
 * è·å–æ˜Ÿåº§
 * @param {String|Number} birthday - å¹´æœˆæ—¥ï¼ˆ8ä½ï¼Œå¦‚ï¼š'19900220'æˆ–19900220ï¼‰ æˆ– ç©ºå­—ç¬¦ä¸²
 * @returns {String} constellation - æ˜Ÿåº§ æˆ– ç©ºå­—ç¬¦ä¸²
 */
function getConstellation (birthday) {
  birthday = birthday.toString()

  var constellation = ''

  if (birthday && birthday.length === 8) {
    var month = birthday.slice(4, 6)
    var day = birthday.slice(6, 8)
    var conStr = 'é­”ç¾¯æ°´ç“¶åŒé±¼ç™½ç¾Šé‡‘ç‰›åŒå­å·¨èŸ¹ç‹®å­å¤„å¥³å¤©ç§¤å¤©èå°„æ‰‹é­”ç¾¯'
    var dayArr = [20, 19, 21, 20, 21, 22, 23, 23, 23, 24, 23, 22]

    constellation = conStr.substr(month * 2 - (day < dayArr[month - 1] ? 2 : 0), 2)

    if (constellation) {
      constellation += 'åº§'
    }
  }

  return constellation
}
```

>æœˆä»½æ ¼å¼åŒ–ä¸ºè‹±æ–‡ç¼©å†™ï¼š
>
>```js
>/**
> * æœˆä»½æ ¼å¼åŒ–
> * @param {Number} month - æœˆä»½ç¼–å·ï¼š0ï¼š1æœˆã€11ï¼š12æœˆ
> * @returns {String} - æœˆä»½è‹±æ–‡ç¼©å†™
> */
>function monthFormat (month) {
>  const monthArr = ['Jan.', 'Feb.', 'Mar.', 'Apr.', 'May', 'June', 'July', 'Aug.', 'Sept.', 'Oct.', 'Nov.', 'Dec.']
>  return monthArr[month]
>}
>
>
>/* ä½¿ç”¨æµ‹è¯• */
>monthFormat(new Date().getMonth())
>```

### *åŸç”ŸJS*åŠ å…¥æ”¶è—å¤¹
```js
function addFavorite(url, title) {  /* urlå¿…é¡»å¸¦æœ‰åè®®å¤´ */
    if (window.external && 'addFavorite' in window.external) {
        window.external.addFavorite(url, title);
    } else if (window.sidebar && window.sidebar.addPanel) {
        window.sidebar.addPanel(url, title);
    } else if (window.opera && window.print) {
        this.title = title;
        return true;
    } else {
        alert('åŠ å…¥æ”¶è—å¤±è´¥ï¼Œè¯·ä½¿ç”¨ ' + (navigator.userAgent.toLowerCase().indexOf('mac') !== -1 ? 'Command/Cmd' : 'Ctrl') + ' + D è¿›è¡Œæ·»åŠ ã€‚');
    }
}


/* ä½¿ç”¨æµ‹è¯• */
addFavorite(window.location.href, 'æ”¶è—åå­—');
```

### *åŸç”ŸJS*ä»å­—ç¬¦ä¸²ä¸­è·å–ç»å¯¹è·¯å¾„
```js
function getAbsoluteUrl(url) {
    var domA;

    if (typeof url === 'undefined') {

        return window.location.href;
    } else {
        domA = document.createElement('a');
        domA.href = url;

        return domA.href;
    }
}
```

### *åŸç”ŸJS*ä¸ä¼ é€’è¯·æ±‚å¤´çš„Referrerè¿›è¡Œè·³è½¬
>1. æ³¨æ„ï¼šå†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆContent-Security-Policyï¼ŒCSPï¼‰çš„`script-src`ä¼šé™åˆ¶è„šæœ¬è¿è¡Œï¼›éç”¨æˆ·æ“ä½œçš„æ‰“å¼€æ–°çª—å£ä¹Ÿä¼šå—åˆ°æµè§ˆå™¨çš„é™åˆ¶ï¼ˆ`window.open`ï¼‰ã€‚å› æ­¤ä»¥ä¸‹ä»£ç ä¸é è°±ã€‚
>2. å»ºè®®ä½¿ç”¨`<a>`ä¸­æ·»åŠ `rel="noreferrer"`æ¥æ›¿ä»£ã€‚

```js
// ä¸å‘é€referrerçš„å½“å‰é¡µé¢è·³è½¬
function noreferrerOpen (link) {
  const iframe = document.createElement('iframe')
  iframe.style.display = 'none'
  iframe.src = `javascript: "<script>top.location.replace('${link}')<\/script>"`
  document.getElementsByTagName('body')[0].appendChild(iframe)
}


// ä¸å‘é€referrerçš„æ–°çª—å£æ‰“å¼€
function noreferrerOpenNew (fullLink) {  // éœ€è¦å®Œæ•´URL
  // æ­¤æ—¶åªèƒ½çˆ¶çº§å‘å­çº§é€šä¿¡ï¼›è‹¥çˆ¶çº§ä¿®æ”¹å­çº§çš„locationï¼Œåˆ™çˆ¶å­é‡æ–°å»ºç«‹è¿æ¥ä¸”å­çº§æœ‰referrer
  return window.open(`javascript: window.name`, `<script>location.replace('${fullLink}')<\/script>`)
}
```

### *åŸç”ŸJS*æ ¼å¼åŒ–æ¥å£è¿”å›çš„æ•°æ®
æ ¹æ®ä¸šåŠ¡è¦æ±‚è¿›è¡Œï¼šæ•°æ®ç»“æ„è½¬åŒ–ï¼ˆå¦‚ï¼šæå–å±æ€§ï¼‰ã€æ•°æ®å¡«è¡¥é»˜è®¤å­—æ®µã€‚

1. æ•°æ®ç»“æ„è½¬åŒ–

    ```js
    // æŒ‰keyNameæå–
    function groupArrayByKey(arr, keyName) {
      return arr.reduce((acc, current) => {
        if (!acc[current[keyName]]) {
          acc[current[keyName]] = [];
        }
        acc[current[keyName]].push(current);
        return acc;
      }, {});
    }


    /* ä½¿ç”¨æµ‹è¯• */
    groupArrayByKey(
      [
        { classId: "1", name: "å¼ ä¸‰", age: 16 },
        { classId: "1", name: "æå››", age: 15 },
        { classId: "2", name: "ç‹äº”", age: 16 },
        { classId: "3", name: "èµµå…­", age: 15 },
        { classId: "2", name: "å­”ä¸ƒ", age: 16 },
      ],
      "classId",
    )
    ```
2. æ•°æ®å¡«è¡¥é»˜è®¤å­—æ®µ

    ```js
    /**
     * æ¯é¡¹éƒ½æ·»åŠ  é”®-å€¼ï¼ˆé»˜è®¤å€¼ï¼‰
     * @param {Array|Object} data - è¦å¤„ç†çš„æ•°æ®
     * @param {Object} [params = {}] - è¦æ·»åŠ çš„é”®-å€¼çš„å¯¹è±¡ã€‚é”®æ˜¯è¦æ·»åŠ çš„é”®ï¼Œå€¼æ˜¯æ·»åŠ é”®çš„é»˜è®¤å€¼
     * @returns {Array|Object} å¤„ç†å¥½çš„æ•°æ®
     */
    function formatData(data, params = {}) {
      if (isObjEmpty(params)) {
        return data;
      }

      // æ˜¯æ•°ç»„
      if (Array.isArray(data)) {
        return data.map((item) => {
          // éœ€è¦æ·»åŠ é”®-å€¼
          for (let [key, value] of Object.entries(params)) {
            if (typeof item[key] === "undefined") {
              item[key] = value;
            }
          }

          return item;
        });
      }
      // æ˜¯å¯¹è±¡
      else {
        // éœ€è¦æ·»åŠ é”®-å€¼
        for (let [key, value] of Object.entries(params)) {
          if (typeof data[key] === "undefined") {
            data[key] = value;
          }
        }

        return data;
      }
    }

    // æ˜¯å¦æ˜¯ç©ºå¯¹è±¡
    const isObjEmpty = (obj) => {
      if (obj !== Object(obj)) {    /* å‚æ•°ä¸æ˜¯å¯¹è±¡ */
        throw new TypeError("å‚æ•°ä¸æ˜¯å¯¹è±¡");
      } else if (typeof Object.keys === "function") {
        return Object.keys(obj).length === 0;
      } else {                      /* å…¼å®¹æ€§ï¼Œie9- */
        for (let one in obj) {
          if (obj.hasOwnProperty(one)) {
            return false;
          }
        }
        return true;
      }
    };


    /* ä½¿ç”¨æµ‹è¯• */
    formatData(
      [{}, { å‚æ•°1: "æœ‰å€¼" }],
      { å‚æ•°1: "é»˜è®¤å€¼", å‚æ•°2: false, å‚æ•°3: { a: "é»˜è®¤å€¼" } }
    )
    formatData(
      { å‚æ•°1: "æœ‰å€¼" },
      { å‚æ•°1: "é»˜è®¤å€¼", å‚æ•°2: false, å‚æ•°3: { a: "é»˜è®¤å€¼" } }
    )
    ```

### *åŸç”ŸJS*åˆ¤æ–­æ˜¯å¦æ”¯æŒWebP
1. åŒæ­¥åˆ¤æ–­

    ```js
    function checkWebp () { // Firefoxè¿”å›falseä½†æ˜¯å´æ”¯æŒWebPâ€¦
      try {
        return (document.createElement('canvas').toDataURL('image/webp').indexOf('data:image/webp') === 0)
      } catch (err) {
        return false
      }
    }
    ```

    [CodePen demo](https://codepen.io/realgeoffrey/pen/zMxadK)
2. å¼‚æ­¥åˆ¤æ–­

    ```js
    // 'feature' can be one of 'lossy', 'lossless', 'alpha' or 'animation'.
    // 'callback(feature, result)' will be passed back the detection result (in an asynchronous way!)
    function checkWebpFeature (feature, callback) {
      const kTestImages = {
        lossy: 'UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA',
        lossless: 'UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==',
        alpha: 'UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==',
        animation: 'UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA'
      }

      const img = new Image()
      img.onload = function () {
        const result = (img.width > 0) && (img.height > 0)
        callback(feature, result)
      }
      img.onerror = function () {
        callback(feature, false)
      }
      img.src = 'data:image/webp;base64,' + kTestImages[feature]
    }


    /* ä½¿ç”¨æµ‹è¯• */
    checkWebpFeature('lossless', function (feature, result) {
      console.log(result) // => true/false
    })
    ```

- çº¯HTMLæ–¹å¼

    ```html
    <picture>
      <source srcset="WebPå›¾ç‰‡åœ°å€" type="image/webp">
      <img src="éWebPå›¾ç‰‡åœ°å€">
    </picture>
    ```

    >`<img>`å¤–åµŒå¥—ä¸€å±‚`<picture>`ï¼Œæ ·å¼è¦æ³¨æ„ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨å­å…ƒç´ é€‰æ‹©å™¨ï¼ˆ`>`ï¼‰æ—¶ã€‚å¦‚ï¼š`xx > img`æ—¶æ— æ³•é€‰ä¸­ï¼Œéœ€è¦`xx > picture > img`ã€‚

### *åŸç”ŸJS*æ‰§è¡Œæ–¹æ³•çš„å‰/åè¿›è¡Œå¼€/å…³loading
```js
async function loadingFetch (func) { // funcï¼šæ–¹æ³•ï¼›è‹¥æ–¹æ³•è¿”å›Promiseå®ä¾‹ï¼Œåˆ™å®Œæˆ/å¤±è´¥åå…³é—­loadingï¼Œå¦åˆ™åŒæ­¥å…³é—­loading
  if (typeof func === 'function') {
    console.log('loading å¼€å§‹')  // æ‰“å¼€loading

    try {await func()} catch (e) {}

    console.log('loading ç»“æŸ')  // å…³é—­loading
  }
}


/* ä½¿ç”¨æµ‹è¯• */
// 1såè§¦å‘å…³é—­loading
loadingFetch(() => {
  return new Promise((resolve, reject) => {
    setTimeout(reject, 1000)
  })
})

// åŒæ­¥è§¦å‘å…³é—­loading
loadingFetch(() => { console.log('åŒæ­¥æ–¹æ³•') })
```

### *åŸç”ŸJS*ç‚¹å‡»ä¸‹è½½
`<a href="æ–‡ä»¶èµ„æºåœ°å€" download="æ–‡ä»¶å.æ–‡ä»¶ç±»å‹">æ–‡ä»¶èµ„æºåœ°å€ï¼šè‹¥æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™åŒæºå°±ä¸‹è½½ï¼Œä¸åŒæºå°±ä¾ç„¶æ˜¯å¯¼èˆªè·³è½¬ï¼›è‹¥æ˜¯Blobæˆ–Data URLåè®®ï¼Œåˆ™ä¸‹è½½</a>`

>1. `download`æŒ‡ç¤ºæµè§ˆå™¨ä¸‹è½½æ–‡ä»¶èµ„æºåœ°å€è€Œä¸æ˜¯å¯¼èˆªè·³è½¬ï¼ˆè‹¥hrefçš„å­—ç¬¦ä¸²ä¸åŒæºï¼Œåˆ™é€€å›æœªæ·»åŠ downloadçš„é€»è¾‘â€”â€”å¯¼èˆªè·³è½¬ï¼‰ã€‚
>2. æ”¯æŒå¤šç§æ–‡ä»¶ç±»å‹ã€‚
>3. ~~å…¼å®¹æ€§ä¸ä½³ã€‚~~
>4. è‹¥downloadæœªæŒ‡å®šå€¼æˆ–æœªæŒ‡å®šæ–‡ä»¶åç¼€ï¼Œåˆ™ä»å¤šç§æ–¹å¼ä¸­è®¾ç½®`æ–‡ä»¶å.æ–‡ä»¶ç±»å‹`ï¼šå“åº”å¤´çš„`Content-Disposition`ã€`Content-Type`ï¼ŒURLçš„æœ€åä¸€æ®µï¼ŒData URLçš„å¼€å¤´ï¼ŒBlobçš„`type`ã€‚

ä»¥ä¸‹æ–¹æ³•å‡ä¾èµ–`<a>`çš„`download`å±æ€§ï¼ˆJSçš„Blobæˆ–Data URLï¼Œéƒ½éœ€è¦å…ˆ[CORS](https://github.com/realgeoffrey/knowledge/blob/master/ç½‘ç«™å‰ç«¯/HTTPç›¸å…³/README.md#corscross-origin-resource-sharingè·¨åŸŸèµ„æºå…±äº«)ä¸‹è½½æ–‡ä»¶èµ„æºåœ°å€æˆåŠŸåå†è¿›è¡Œæ“ä½œï¼‰ï¼š

1. ä¸‹è½½æ–‡ä»¶ï¼ˆåˆ©ç”¨æ–‡ä»¶URLï¼Œæ”¯æŒè®¾ç½®æ–‡ä»¶åï¼‰

    >éœ€è¦æ–‡ä»¶èµ„æºå“åº”å¤´åŒ…å«æ­£ç¡®çš„Access-Control-Allow-Originå€¼ï¼ˆCORSï¼‰ã€‚

    ```js
    function getBlob(fileUrl, filename) {
      return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', fileUrl, true);
        xhr.responseType = 'blob';
        xhr.onloadend = () => {
          if (xhr.status >= 200 && xhr.status < 300) {  // åªæœ‰éƒ¨åˆ†2xxæ”¯æŒä¼ é€’æ•°æ®ï¼ˆå»ºè®®åªå¤„ç†200çš„å“åº”ï¼‰ï¼›304ä¸è¿”å›æ•°æ®
            const link = document.createElement('a');
            link.href = URL.createObjectURL(xhr.response); // Blob URLã€‚ä¹Ÿå¯ä»¥ç”¨Data URLï¼ˆbase64ï¼‰
            link.download = filename ?? '';

            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            window.URL.revokeObjectURL(link.href);

            resolve(xhr)
          } else {
            reject(xhr)
          }
        };
        xhr.send();
      })
    }
    ```

    >`loadend`äº‹ä»¶é’ˆå¯¹`XMLHttpRequest`æˆ–`FileReader`å®ä¾‹çš„å®Œæˆï¼ˆæ— è®ºæˆåŠŸã€å¤±è´¥ã€ç»ˆæ­¢ï¼‰ä»…è§¦å‘ä¸€æ¬¡ã€‚

    ><details>
    ><summary>Data URLï¼ˆbase64ï¼‰æ–¹æ¡ˆ</summary>
    >
    >```js
    >...
    >if (xhr.status >= 200 && xhr.status < 300) {
    >  const reader = new window.FileReader()
    >  reader.addEventListener('loadend', (e) => {
    >    const link = document.createElement('a');
    >    link.href = e.target.result;
    >    link.download = filename ?? '';
    >    link.style.display = 'none';
    >    document.body.appendChild(link);
    >    link.click();
    >    document.body.removeChild(link);
    >
    >    resolve(xhr)
    >  })
    >  reader.readAsDataURL(blob)
    >}
    >...
    >```
    ></details>
2. ä¸‹è½½æ–‡æœ¬ï¼ˆæŠŠJSå­—ç¬¦ä¸²å˜æˆæ–‡æœ¬æ–‡ä»¶ä¸‹è½½ï¼‰

    >Blobã€‚ä»£ç ç”Ÿæˆæ–‡æœ¬å†…å®¹å†åˆ›å»ºä¸‹è½½ã€‚

    ```js
    /**
     * ä¸‹è½½æ–‡æœ¬
     * @param {String} content - ä¿å­˜çš„å­—ç¬¦ä¸²å†…å®¹
     * @param {String} filename - æ–‡ä»¶åï¼ˆåŒ…æ‹¬åç¼€ï¼‰
     */
    function textDownload (content, filename) {
      // åˆ›å»ºéšè—çš„å¯ä¸‹è½½é“¾æ¥
      const eleLink = document.createElement('a')
      eleLink.download = filename ?? ''
      eleLink.style.display = 'none'

      // å­—ç¬¦å†…å®¹è½¬å˜æˆBlobå¯¹è±¡
      const blob = new window.Blob([content])
      // åˆ›å»ºBlob URL
      const url = URL.createObjectURL(blob)

      eleLink.href = url

      // è§¦å‘ä¸‹è½½
      document.body.appendChild(eleLink)
      eleLink.click()
      document.body.removeChild(eleLink)

      // é‡Šæ”¾Blob URL
      window.URL.revokeObjectURL(url)
    }


    /* ä½¿ç”¨æµ‹è¯• */
    textDownload('å†…å®¹å­—ç¬¦ä¸²', 'æ–‡ä»¶å.æ–‡ä»¶ç±»å‹')
    ```
3. ä¸‹è½½å›¾ç‰‡ï¼ˆåˆ©ç”¨Canvasï¼‰

    >1. Canvasã€‚ä»…æ”¯æŒï¼špng/jpg/webpã€‚
    >2. éœ€è¦æ–‡ä»¶èµ„æºå“åº”å¤´åŒ…å«æ­£ç¡®çš„Access-Control-Allow-Originå€¼ï¼ˆCORSï¼‰ã€‚

    ```js
    /**
     * ä¸‹è½½å›¾ç‰‡
     * @param {String} imgSrc - å›¾ç‰‡åœ°å€
     * @param {String} [filename = 'image.png'] - æ–‡ä»¶åï¼ˆåŒ…æ‹¬åç¼€ï¼‰
     */
    function imageDownload (imgSrc, filename = 'image.png') {
      let img = new Image()
      img.onload = function () {
        download(img)
        img.onload = img.onerror = null
        img = null
      }
      img.onerror = function () {
        img.onload = img.onerror = null
        img = null
      }
      img.crossOrigin = 'Anonymous'
      img.src = imgSrc

      // ä¸‹è½½é€»è¾‘
      function download (domImg) {
        // Canvasä¸Šç»˜åˆ¶å›¾åƒ
        const canvas = document.createElement('canvas')
        canvas.width = domImg.naturalWidth
        canvas.height = domImg.naturalHeight
        const context = canvas.getContext('2d')
        context.drawImage(domImg, 0, 0)

        // å›¾ç‰‡è½¬Data URLï¼ˆBase64ï¼‰åœ°å€
        let base64
        if (filename.endsWith('.png')) {
          base64 = canvas.toDataURL('image/png')
        } else if (filename.endsWith('.webp')) {
          base64 = canvas.toDataURL('image/webp')
        } else {
          base64 = canvas.toDataURL('image/jpeg')
        }

        // åˆ›å»ºéšè—çš„å¯ä¸‹è½½é“¾æ¥
        const eleLink = document.createElement('a')
        eleLink.download = filename
        eleLink.style.display = 'none'
        eleLink.href = base64

        // è§¦å‘ä¸‹è½½
        document.body.appendChild(eleLink)
        eleLink.click()
        document.body.removeChild(eleLink)
      }
    }


    /* ä½¿ç”¨æµ‹è¯• */
    imageDownload('å›¾ç‰‡åœ°å€', 'å›¾ç‰‡æ–‡ä»¶å.æ–‡ä»¶ç±»å‹')
    ```

### *åŸç”ŸJS*å†™å…¥å‰ªåˆ‡æ¿
```ts
async function clipboard (text: string | number): Promise<string> {
  text = String(text);

  try {
    await window.navigator.clipboard.writeText(text); // æ–°æ¥å£
  } catch {
    try {
      // éœ€è¦æµè§ˆå™¨tabæ˜¯activeæˆ–æœ‰äº¤äº’æ‰èƒ½è§¦å‘
      let textArea = document.createElement("input");

      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();

      document.execCommand("cut"); // å·²åºŸå¼ƒ
      document.body.removeChild(textArea);
    } catch {
      return Promise.reject(text);
    }
  }
  return Promise.resolve(text);
}


/* ä½¿ç”¨æµ‹è¯• */
clipboard("å†™å…¥çš„å†…å®¹~")
  .then((text) => {console.log(`\`${text}\`å†™å…¥æˆåŠŸï¼`)})
  .catch((text) => {console.warn(`\`${text}\`å†™å…¥å¤±è´¥ï¼`)})
```
>1. æ³¨æ„ï¼Œæœ‰äº›æµè§ˆå™¨å¯¹ä¸ä¿¡ä»»çš„åŸŸåä¼šé™é»˜å¤±è´¥ï¼ˆresolvedï¼‰ã€‚
>2. å¯ä»¥ä½¿ç”¨[clipboard.js](https://github.com/zenorocha/clipboard.js)ã€‚

### Reactç»„ä»¶ä¸šåŠ¡ç±»ä¼¼Promise.allçš„æ•ˆæœ
```tsx
import React, { useEffect, useState, useRef } from "react";
import { notification, Button } from "antd";

// æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚
function sleep(ms: number) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}

export default function Demo(props: { show: boolean }) {
  const resolveFunc1 = useRef<Function>(() => {});
  const resolveFunc2 = useRef<Function>(() => {});
  const resolveFunc3 = useRef<Function>(() => {});

  // è‹¥3ä¸ªæ–¹æ³•å‡è¢«è°ƒç”¨ï¼Œåˆ™readyè¢«èµ‹å€¼
  const [ready, setReady] = useState<any>(null);

  useEffect(() => {
    Promise.all([
      new Promise((resolve1) => {
        resolveFunc1.current = resolve1;
      }),
      new Promise((resolve2) => {
        resolveFunc2.current = resolve2;
      }),
      new Promise((resolve3) => {
        resolveFunc3.current = resolve3;
      }),
    ]).then((data) => {
      setReady(data);
    });
  }, []);

  useEffect(() => {
    if (ready) {
      const info = JSON.stringify(ready);
      console.log(info);
      notification.open({ message: info });
    }
  }, [ready]);

  // ä»¥ä¸‹æ¨¡æ‹Ÿ3ä¸ªæ–¹æ³•è¢«è°ƒç”¨æˆåŠŸ

  const [asyncSelfShow, setAsyncSelfShow] = useState<boolean>(false);
  useEffect(() => {
    // 1. æ¨¡æ‹Ÿå¼‚æ­¥è¿”å›
    sleep(2000).then(() => {
      resolveFunc1.current({ a: 1 });

      setAsyncSelfShow(true);
    });
  }, []);

  const { show } = props;
  useEffect(() => {
    // 2. å‚æ•°ä¼ å…¥æ»¡è¶³
    show && resolveFunc2.current({ b: 2 });
  }, [show]);

  const [selfShow, setSelfShow] = useState<boolean>(false);

  return (
    <div>
      <h3>ready: {JSON.stringify(ready)}</h3>

      <p>props.show: {show ? "true" : "false"}</p>
      <p>asyncSelfShowï¼š {asyncSelfShow ? "true" : "false"}</p>
      <p>
        selfShow: {selfShow ? "true" : "false"}
        <br/>
        <Button
          onClick={() => {
            // 3. ç»„ä»¶è‡ªèº«çŠ¶æ€å˜åŒ–
            resolveFunc3.current({ c: 3 });

            setSelfShow(!selfShow);
          }}
        >
          setSelfShow{!selfShow ? "true" : "false"}
        </Button>
        </p>
    </div>
  );
}
```

### *åŸç”ŸJS*åˆ¤æ–­æ˜¯å¦æœ‰å¾ªç¯å¼•ç”¨
```js
function hasCircularReference(obj, weakmap = new WeakMap()) {
  // åŸºæœ¬æ•°æ®ç±»å‹
  if (obj === null || (typeof obj !== "object" && typeof obj !== "function")) {
    return false;
  }

  if (weakmap.has(obj)) {
    return true;
  } else {
    weakmap.set(obj, true);

    for (const key of Object.keys(obj)) {
      if (hasCircularReference(obj[key], weakmap)) {
        return true;
      }
    }
    return false;
  }
}
```

---
## DOMç›¸å…³

### *åŸç”ŸJS*DOMå±•ç¤ºæˆ–æ¶ˆå¤±æ‰§è¡Œæ–¹æ³•ï¼ˆIntersectionObserverï¼‰
1. classå†™æ³•ï¼š

    ```ts
    /**
     * DOMå±•ç¤ºæˆ–æ¶ˆå¤±æ‰§è¡Œæ–¹æ³•ï¼ˆIntersectionObserverï¼‰
     * @constructor
     * @param {Object} target - è§‚å¯Ÿçš„ç›®æ ‡å…ƒç´ 
     * @param {Function} [show = () => {}] - å±•ç¤ºæ—¶è°ƒç”¨
     * @param {Function} [hide = () => {}] - æ¶ˆå¤±æ—¶è°ƒç”¨
     * @param {Number} [threshold = 0] - äº¤å‰æ¯”ä¾‹
     * @param {Boolean} [once = false] - æ˜¯å¦ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œå¦åˆ™æ‰§è¡Œæ— æ•°æ¬¡ï¼ˆä»…é’ˆå¯¹å±•ç¤ºã€‚è‹¥ä¸ºtrueï¼Œåˆ™å±•ç¤ºä¸€æ¬¡åï¼Œå±•ç¤ºã€æ¶ˆå¤±æ–¹æ³•å‡ä¸å†æ‰§è¡Œï¼‰
     * @param {Object} [root = null] - è§‚å¯Ÿçš„ç›¸å¯¹ç‰©ã€‚null: viewportï¼›ç¥–å…ˆå…ƒç´ 
     */
    export class DisplayDom {
      io: IntersectionObserver | undefined;

      constructor({
        target,
        show = () => {},
        hide = () => {},
        threshold = 0.01,
        once = false,
        root = null,
      }: {
        target: Element;
        show?: Function;
        hide?: Function;
        threshold?: number;
        once?: boolean;
        root?: Element | Document | null;
      }) {
        const thresholdSafe = Math.max(Math.min(threshold, 1), 0.01); // å–å€¼åœ¨[0.01, 1]
        try {
          this.io = new window.IntersectionObserver(
            (entries) => {
              if (entries[0].intersectionRatio >= thresholdSafe) {
                // å‡ºç°
                show();

                if (once) {
                  this.stop();
                }
              } else {
                // ä¸å‡ºç°
                hide();
              }
            },
            { threshold: [thresholdSafe], root },
          );

          this.io.observe(target); // å¼€å§‹è§‚å¯Ÿ
        } catch (error) {
          console.error(
            error,
            `\nä¸æ”¯æŒIntersectionObserverï¼Œå‡çº§æµè§ˆå™¨æˆ–ä»£ç ä½¿ç”¨polyfill: https://github.com/w3c/IntersectionObserver`,
          );
        }
      }

      stop() {
        this.io?.disconnect();
      }
    }

    /* ä½¿ç”¨æµ‹è¯• */
    var a = new DisplayDom({
      target: document.getElementById('asd'),
      show: () => { console.log('show') },
      hide: () => { console.log('hide') }
    })

    // a.stop()
    ```
2. æ„é€ å‡½æ•°å†™æ³•ï¼š

    ```js
    /**
     * DOMå±•ç¤ºæˆ–æ¶ˆå¤±æ‰§è¡Œæ–¹æ³•ï¼ˆIntersectionObserverï¼‰
     * @constructor
     * @param {Object} target - è§‚å¯Ÿçš„ç›®æ ‡å…ƒç´ 
     * @param {Function} [show = () => {}] - å±•ç¤ºæ—¶è°ƒç”¨
     * @param {Function} [hide = () => {}] - æ¶ˆå¤±æ—¶è°ƒç”¨
     * @param {Number} [threshold = 0] - äº¤å‰æ¯”ä¾‹
     * @param {Boolean} [once = false] - æ˜¯å¦ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œå¦åˆ™æ‰§è¡Œæ— æ•°æ¬¡ï¼ˆä»…é’ˆå¯¹å±•ç¤ºã€‚è‹¥ä¸ºtrueï¼Œåˆ™å±•ç¤ºä¸€æ¬¡åï¼Œå±•ç¤ºã€æ¶ˆå¤±æ–¹æ³•å‡ä¸å†æ‰§è¡Œï¼‰
     * @param {Object} [root = null] - è§‚å¯Ÿçš„ç›¸å¯¹ç‰©ã€‚null: viewportï¼›ç¥–å…ˆå…ƒç´ 
     */
    function DisplayDom ({ target, show = () => {}, hide = () => {}, threshold = 0.01, once = false, root = null } = {}) {
      threshold = Math.max(Math.min(threshold, 1), 0.01)  // å–å€¼åœ¨[0.01, 1]
      try {
        const io = new window.IntersectionObserver(
          (entries) => {
            if (entries[0].intersectionRatio >= threshold) { // å±•ç¤º
              show()

              if (once) {
                this.stop()
              }
            } else {  // æ¶ˆå¤±
              hide()
            }
          },
          { threshold: [threshold], root }
        )

        io.observe(target)    // å¼€å§‹è§‚å¯Ÿ

        this.stop = () => {
          io.disconnect()
        }
      } catch (error) {
        console.error(error.message, `\nä¸æ”¯æŒIntersectionObserverï¼Œå‡çº§æµè§ˆå™¨æˆ–ä»£ç ä½¿ç”¨polyfill: https://github.com/w3c/IntersectionObserver`)
      }
    }


    /* ä½¿ç”¨æµ‹è¯• */
    var a = new DisplayDom({
      target: document.getElementById('asd'),
      show: () => { console.log('show') },
      hide: () => { console.log('hide') }
    })

    // a.stop()
    ```

### *åŸç”ŸJS*åˆ¤æ–­æ˜¯å¦ä¸º`Node`ã€æ˜¯å¦ä¸º`Element`
```js
// åˆ¤æ–­æ˜¯å¦ä¸ºNode
function isNode(o) {
  return typeof Node === 'object' ? o instanceof Node : !!o && typeof o === 'object' && typeof o.nodeType === 'number' && typeof o.nodeName === 'string';
}

// åˆ¤æ–­æ˜¯å¦ä¸ºElement
function isElement(o) {
  return typeof HTMLElement === 'object' ? o instanceof HTMLElement : !!o && typeof o === 'object' && o !== null && o.nodeType === 1 && typeof o.nodeName === 'string';
}
```

### *åŸç”ŸJS*è¾“å…¥æ¡†å…‰æ ‡ä½ç½®çš„è·å–å’Œè®¾ç½®
```js
var cursorPosition = {

    /**
     * è·å–å…‰æ ‡ä½ç½®å’Œé€‰ä¸­é•¿åº¦
     * @param {Object} dom - æ ‡ç­¾inputæˆ–textareaçš„DOMå¯¹è±¡
     * @returns {Object} - {å…‰æ ‡èµ·å§‹ä½ç½®,é€‰ä¸­é•¿åº¦}
     */
    get: function (dom) {
        var start = 0,  // å…‰æ ‡èµ·å§‹ä½ç½®
            selLen = 0, // å…‰æ ‡é€‰ä¸­é•¿åº¦
            sel, ieSel;

        if ('selectionStart' in dom) {
            start = dom.selectionStart;
            selLen = dom.selectionEnd - start;
        } else if (document.selection) {    /* ie */
            sel = document.selection.createRange();
            selLen = sel.text.length;

            if (dom.nodeName.toLowerCase() === 'textarea') {
                ieSel = document.body.createTextRange();
                ieSel.moveToElementText(dom);
            } else {
                ieSel = dom.createTextRange();
            }

            ieSel.setEndPoint('EndToEnd', sel);
            start = ieSel.text.length - selLen;
        }

        return {start: start, select: selLen};
    },

    /**
     * è®¾ç½®å…‰æ ‡èµ·å§‹ä½ç½®å’Œé€‰ä¸­é•¿åº¦
     * @param {Object} dom - æ ‡ç­¾inputæˆ–textareaçš„DOMå¯¹è±¡
     * @param {Number} start - å…‰æ ‡èµ·å§‹ä½ç½®
     * @param {Number} len - é€‰ä¸­é•¿åº¦
     * @returns {Number} end - ç»“æŸä½ç½®ï¼ˆstart+lenï¼‰
     */
    set: function (dom, start, len) {
        var valueLen = dom.value.length,
            end, ieSel;

        /* åˆå§‹åŒ–start */
        start = parseInt(start, 10);
        if (!start) {
            start = 0;
        } else if (start > valueLen) {
            start = valueLen;
        }

        /* åˆå§‹åŒ–len */
        len = parseInt(len, 10);
        if (!len) {
            len = 0;
        }

        /* åˆå§‹åŒ–end */
        end = start + len;
        if (end > valueLen) {
            end = valueLen;
        }

        if (valueLen !== 0) {
            if (dom.setSelectionRange) {
                dom.setSelectionRange(start, end);
                dom.focus();
            } else {    /* ie */
                ieSel = dom.createTextRange();
                ieSel.moveStart('character', -valueLen);
                ieSel.moveEnd('character', -valueLen);
                ieSel.moveStart('character', start);
                ieSel.moveEnd('character', len);
                ieSel.select();
            }
        } else {
            if (dom.setSelectionRange) {
                dom.focus();
            } else {    /* ie */
                ieSel = dom.createTextRange();
                ieSel.select();
            }
        }

        return end;
    }
};


/* ä½¿ç”¨æµ‹è¯• */
$(è¾“å…¥æ¡†é€‰æ‹©å™¨).on('mouseup keyup', function () {
    console.log(cursorPosition.get(this));
});

console.log(cursorPosition.set(è¾“å…¥æ¡†dom, èµ·å§‹ä½ç½®, é€‰ä¸­é•¿åº¦));
```

[CodePen demo](https://codepen.io/realgeoffrey/pen/BXQvbZ)

### *åŸç”ŸJS*æ–‡æœ¬é€‰åŒºè¦†ç›–æŸDOMçš„æ–‡æœ¬èŒƒå›´
```js
/**
 * æ–‡æœ¬é€‰åŒºè¦†ç›–æŸDOMæ–‡æœ¬èŒƒå›´
 * @param {Object} dom - DOMå¯¹è±¡
 * @returns {Boolean} æ˜¯å¦æˆåŠŸ
 */
function selectElement (dom) {
  if (window.getSelection && dom) {  // ie9+
    let sel = window.getSelection()
    sel.removeAllRanges()
    let range = document.createRange()
    range.selectNode(dom)
    sel.addRange(range)
    return true
  } else {
    return false
  }
}
```

### *åŸç”ŸJS*é’ˆå¯¹WAPçš„é˜»æ­¢æ»šåŠ¨å†’æ³¡ï¼ˆä»…DOMï¼‰
>1. å› ä¸º`scroll`äº‹ä»¶ä¸ä¼šå†’æ³¡ï¼Œæ‰€ä»¥`stopPropagation`ã€`preventDefault`æ— æ³•è¾¾åˆ°æ•ˆæœã€‚
>2. iOSå¯ä»¥åœ¨DOMæ»šåŠ¨åˆ°é¡¶éƒ¨æˆ–åº•éƒ¨æ—¶ï¼Œé€šè¿‡`-webkit-overflow-scrolling: touch;`ç»§ç»­è§¦å‘ã€Œæ©¡çš®ç­‹æ•ˆæœã€ã€‚

```html
<style>
    .bounce {
        overflow-y: scroll;
        -webkit-overflow-scrolling: touch;  /* å¢åŠ DOMçš„å›å¼¹æ•ˆæœï¼ˆiOSï¼‰ */

        height: å›ºå®šé«˜åº¦;
    }
</style>

<div class="bounce" id="j-bounce">
    a<br>
    b<br>
    c<br>
    d<br>
    e<br>
    f<br>
    g<br>
</div>

<script>
const ScrollStopPropagation = function (dom) {
  const _stopPropagation = function () {
    const startTopScroll = dom.scrollTop  // æ»šåŠ¨é«˜åº¦
    const domHeight = dom.offsetHeight  // å æ®é«˜åº¦
    const contentHeight = dom.scrollHeight  // å†…å®¹é«˜åº¦ï¼ˆå æ®é«˜åº¦+å¯æ»šåŠ¨æœ€å¤§é«˜åº¦

    /*
     * åœ¨è§¦æ‘¸å¼€å§‹æ—¶ï¼Œè‹¥å‘ç°æ»šåŠ¨åŒºåŸŸå·²ç»å¤„äºæé™çŠ¶æ€æ—¶ï¼Œåˆ™æ‰‹å·¥è®¾ç½® scrollTop çš„å€¼ï¼Œ
     * å°†æ»šåŠ¨å†…å®¹å‘è¾¹ç¼˜æ–¹å‘åç§» 1pxï¼ˆè¿™å®é™…ä¸Šæ”¹å˜äº†æ»šåŠ¨åŒºåŸŸçš„æé™çŠ¶æ€ï¼‰ï¼Œ
     * ä»è€Œè¯±ä½¿æµè§ˆå™¨å¯¹æ»šåŠ¨åŒºå—ä½¿ç”¨æ©¡çš®ç­‹æ•ˆæœï¼Œè€Œä¸ä¼šæŠŠè§¦æ‘¸äº‹ä»¶å‘ä¸Šä¼ æ’­åˆ° DOM æ ‘ï¼ˆå¼•èµ·æ•´é¡µæ»šåŠ¨ï¼‰ã€‚
     */
    if (startTopScroll <= 0) {
      dom.scrollTop = 1
    } else if (startTopScroll + domHeight >= contentHeight) {
      dom.scrollTop = contentHeight - domHeight - 1
    }
  }

  dom.addEventListener('touchstart', _stopPropagation, false)

  this.stop = () => {
    dom.removeEventListener('touchstart', _stopPropagation, false)
  }
}

/* ä½¿ç”¨æµ‹è¯• */
const a = new ScrollStopPropagation(document.getElementById('j-bounce'))


// a.stop()
</script>
```

[CodePen demo](https://codepen.io/realgeoffrey/pen/oKYJOg)

>å‚è€ƒï¼š[ScrollFix](https://github.com/joelambert/ScrollFix)ã€‚

### *åŸç”ŸJS*è·å–æ»šåŠ¨æ¡å®½åº¦ï¼ˆæˆ–é«˜åº¦ï¼‰
```js
function getScrollBarWidth() {
    if (typeof arguments.callee.barWidth !== 'undefined') {

        return arguments.callee.barWidth;
    }

    var dom = document.createElement('div');

    dom.style.cssText = 'overflow: scroll; width: 100px; height: 100px;';

    document.body.appendChild(dom);

    arguments.callee.barWidth = dom.offsetWidth - dom.clientWidth;

    document.body.removeChild(dom);

    return arguments.callee.barWidth;
}
```

### *åŸç”ŸJS*å±•ç¤ºé¡µé¢å¸§æ•°
>ç±»ä¼¼æ•ˆæœï¼›DevToolsçš„Renderingä¸­çš„FPS meterã€‚

```js
/**
 * å±•ç¤ºfps
 * @constructor
 * @param {Object} [dom] - å±•ç¤ºçš„DOM
 */
function ShowFPS (dom) {
  let fps = 0
  let before = Date.now()
  let now
  const show = function (fps) {
    dom.innerHTML = 'fps: ' + fps
  }

  let father
  if (!dom) {
    dom = document.createElement('span')
    dom.style.cssText = 'position: fixed; top: 0px; background: white; color: black; z-index: 1;'

    father = document.getElementsByTagName('body')[0] || document.getElementsByTagName('head')[0]
    father.appendChild(dom)
  }

  const self = this

  this.id = requestAnimationFrame(function repeatShow () {
    now = Date.now()

    if (now - before >= 1000) {
      before = now
      show(fps)
      fps = 0
    } else {
      fps += 1
    }

    self.id = requestAnimationFrame(repeatShow)
  })

  this.stop = () => {
    cancelAnimationFrame(this.id)

    if (father) {
      father.removeChild(dom)
    } else {
      dom.innerHTML = ''
    }
  }
}


/* ä½¿ç”¨æµ‹è¯• */
var a = new ShowFPS();

// a.stop();
```

>1. FrameTimeï¼šä¸¤å¸§ç”»é¢é—´éš”è€—æ—¶ï¼ˆæˆ–å•å¸§æ¸²æŸ“è€—æ—¶ï¼‰ã€‚
>2. FPSï¼šæ¯ç§’åˆ·æ–°å¤šå°‘å¸§ã€‚
>
>    1. å¸§ç‡é«˜ï¼Œæœªå¿…æµç•…ã€‚å¸§ç‡ç¨³å®šæ‰æµç•…ã€‚
>    2. é™æ€é¡µé¢ï¼Œç†è®ºFPSåº”è¯¥ä¸º0ï¼Œå¦åˆ™è¯´æ˜æœ‰å†—ä½™åˆ·æ–°ï¼Œå®¹æ˜“å¼•èµ·æ‰‹æœºå‘çƒ­åŠè€—ç”µã€‚
>    3. æ»šåŠ¨é¡µé¢ï¼Œå…³æ³¨FPSã€å¡é¡¿ç‡ã€‚
>3. å¡é¡¿ï¼šæ‰å¸§ï¼Œä¸€å¸§æ¸²æŸ“è€—æ—¶å¤§äºæ˜¾ç¤ºå™¨åˆ·æ–°é—´éš”ï¼ˆå¦‚ï¼šå ç”¨2æ¬¡æˆ–å¤šæ¬¡æ˜¾ç¤ºå™¨åˆ·æ–°è€—æ—¶ï¼‰ï¼Œè¡¨æ˜æµè§ˆå™¨å·²åˆ·æ–°ä½†ç”»é¢æ²¡æœ‰åˆ·æ–°ã€‚è‹¥å‡ºç°å¤šæ¬¡æ²¡æœ‰ç”»é¢åˆ·æ–°ï¼Œåˆ™å¯èƒ½æ˜¯ä¸€æ¬¡å¡é¡¿ã€‚
>4. æµç•…åº¦ï¼šåŸæœ¬ä¿æŒç€æŸä¸ªFPSï¼Œçªç„¶ä¸‹é™FPSæ‰°ä¹±ç”¨æˆ·è§†è§‰æƒ¯æ€§ã€å‡ºç°å½±å“ç”¨æˆ·ä½“éªŒçš„å¡é¡¿æ„Ÿï¼›æˆ–ä½äº18~24å¸§ï¼Œäººçœ¼åŸºæœ¬èƒ½æ„Ÿè§‰ç”»é¢ä¸è¿ç»­æ€§ï¼Œä¹Ÿå°±æ„Ÿè§‰åˆ°å¡é¡¿ã€‚

### *React*é»˜è®¤å›¾ç»„ä»¶
1. <details>

    <summary>classç»„ä»¶</summary>

    ```tsx
    import React, { Component } from "react";

    interface PropsType {
      src: string;
      defaultImage: string;
      className?: string;
      classNameForError?: string;
      style?: React.CSSProperties;
      onClick?: () => void;
      alt?: string;
    }

    export default class TheImage extends Component<PropsType> {
      state = {
        isError: false,
      };

      componentDidUpdate(prevProps: PropsType) {
        // æ£€æµ‹åˆ°å›¾ç‰‡æœ‰æ›´æ–°ï¼Œéœ€è¦é‡æ–°åŠ è½½
        if (prevProps.src !== this.props.src) {
          if (this.props.src && this.state.isError) {
            this.setState({
              isError: false,
            });
          }
          if (!this.props.src && !this.state.isError) {
            this.setState({
              isError: true,
            });
          }
        }
      }

      render() {
        const {
          src,
          defaultImage,
          className = "",
          classNameForError = "",
          style,
          onClick,
          alt,
        } = this.props;

        return (
          <img
            src={this.state.isError ? defaultImage : src}
            className={
              this.state.isError ? `${classNameForError} ${className}` : className
            }
            style={style}
            onClick={() => {
              onClick?.();
            }}
            onError={() => {
              this.setState({
                isError: true,
              });
            }}
            alt={alt || `å›¾${src}`}
          />
        );
      }
    }
    ```
    </details>
2. hookå‡½æ•°ç»„ä»¶

    ```tsx
    import React, { useEffect, useState } from "react";

    interface PropsType {
      src: string;
      defaultImage: string;
      className?: string;
      classNameForError?: string;
      style?: React.CSSProperties;
      onClick?: () => void;
      alt?: string;
    }

    export default function TheImage(props: PropsType) {
      const {
        src,
        defaultImage,
        className = "",
        classNameForError = "",
        style,
        onClick,
        alt,
      } = props;

      const [isError, setIsError] = useState(false);

      useEffect(() => {
        setIsError(!src);
      }, [src]);

      return (
        <img
          src={isError ? defaultImage : src}
          className={isError ? `${classNameForError} ${className}` : className}
          style={style}
          onClick={() => {
            onClick?.();
          }}
          onError={() => {
            setIsError(true);
          }}
          alt={alt || `å›¾${src}`}
        />
      );
    }
    ```

<details>
<summary>ä½¿ç”¨æµ‹è¯•</summary>

```tsx
/* ä½¿ç”¨æµ‹è¯• */
<TheImage
  src={this.state.switch ? 'https://fakeimg.pl/100/?text=true': '1'}
  defaultImage="https://fakeimg.pl/100/?text=default"
  style={{ width: "100px", height: "100px" }}
  className='abc'
  classNameForError='abc-error'
  onClick={() => {
    this.setState({
      switch: !this.state.switch
    })
  }}
/>
```
</details>

### *åŸç”ŸJS*æº¢å‡ºæ–‡æœ¬çš„çœç•¥
```html
<style>
  p {
    font-size: 12px; /* æ³¨æ„å¤ªå¤§çš„å­—ä½“ï¼Œä¸€è¡Œçš„æ’‘èµ·çš„scrollHeightå¯èƒ½è¶…è¿‡line-height */
    height: 40px;
    line-height: 20px;
  }
</style>

<p id="container">123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚123æˆ‘æ˜¯æ–‡æœ¬abcã€‚</p>

<script>
const container = document.getElementById('container')
const containerHeight = container.offsetHeight
// fixme: ä¸ä»…é’ˆå¯¹innerTextï¼Œè¿˜å¯ä»¥æŠŠæ¯ä¸ªå­èŠ‚ç‚¹container.childNodesï¼Œæ ¹æ®nodeTypeçš„å€¼æ¥åˆ†åˆ«å¤„ç†ã€‚å¦‚ï¼š`Node.ELEMENT_NODE`å½“åšä¸€ä¸ªæ•´ä½“ï¼Œ`Node.TEXT_NODE`åˆ†å‰²æ¯ä¸ªæ–‡å­—
const text = container.innerText
for (let i = 0; i < text.length; i++) {
  container.innerText = text.substring(0, i)
  if (containerHeight < container.scrollHeight) {
    container.style.overflow = 'hidden'
    container.innerHTML = text.substring(0, i - 3) + '<span style="cursor: pointer" onclick="container.innerHTML=text; container.style.overflow=\'unset\'">...</span>'

    console.log('äº§ç”Ÿçœç•¥')
    break
  }
}
</script>
```

>å¯å‚è€ƒï¼š[Ant Designï¼šTypographyæ’ç‰ˆçš„`ellipsis`](https://ant.design/components/typography-cn/)ã€‚

### ä¹å®«æ ¼æŠ½å¥–
>canvaså®ç°çš„æŠ½å¥–æ’ä»¶ï¼ˆå¤§è½¬ç›˜ã€ä¹å®«æ ¼ã€è€è™æœºï¼‰ï¼š[lucky-canvas](https://github.com/buuing/lucky-canvas)ã€‚

1. ç¼“åŠ¨å‡½æ•°è§¦å‘å›è°ƒï¼Œå¯ä»¥è®¾ç½®æœ€ç»ˆè§¦å‘å›è°ƒå‘½ä¸­çš„index

    fixme
2. åŸç”ŸJSï¼Œç›´æ¥ä¿®æ”¹DOM

    ```ts
    type initData = {
      // ä¸»å®¹å™¨
      container: Element;
      // å­çº§è½®æ’­çš„classåï¼Œè‹¥æ²¡ä¼ ï¼Œåˆ™è½®æ’­ç”¨å­çº§æ‰€æœ‰liæ ‡ç­¾
      subClass?: string;
      // å­çº§æ¿€æ´»åæ·»åŠ çš„classå
      currentClass?: string;
      // æ¯èµ°ä¸€æ ¼çš„æ—¶é—´(ms)
      speed?: number;
      // å¾ªç¯çš„åœˆæ•°
      lap?: number;
      // åŠ¨ç”»ç»“æŸå›è°ƒ
      callback?: Function;
    };

    export default class SlotMC {
      private domlist: NodeListOf<Element>;
      private container: Element;
      private currentClass: string;
      private speed: number;
      private ratio: number;
      private ease: boolean;
      private lap: number;
      private callback: Function;
      private playing: boolean;
      private length: number;
      private index: number;

      constructor(object: initData) {
        if (!object.container) {
          console.error('æ²¡æœ‰æŒ‡å®šcontainerå‚æ•°,æ— æ³•è·å–èŠ‚ç‚¹');
          return;
        }
        if (!object.subClass) {
          this.container = object.container;
          this.domlist = this.container.querySelectorAll('li');
        } else {
          this.container = object.container;
          this.domlist = this.container.querySelectorAll(`.${object.subClass.toString()}`);
        }
        this.currentClass = object.currentClass || 'current';
        this.speed = object.speed || 70; // æ¯è½¬ä¸€æ ¼çš„æ—¶é—´(ms)(è€è™æœºæ—¶ä¸ºæ•´ä¸ªåŠ¨ç”»çš„æ—¶é—´)
        this.ratio = object.lap || 3; // å˜é€Ÿæ—¶ï¼Œé€Ÿåº¦çš„å€æ•°(ä¹å®«æ ¼,ç›´)
        this.ease = true; // å…ˆæ…¢åå¿«ï¼Œç»“æŸæ—¶å˜æ…¢(è€è™æœºæ—¶ä¸ºé€Ÿåº¦æ•ˆæœçš„é€Ÿåº¦æ›²çº¿)
        this.lap = object.lap || 3; // å¾ªç¯çš„åœˆæ•°
        this.callback = object.callback || function () {}; // ç»“æŸåçš„å›è°ƒå‡½æ•°

        this.playing = false;
        this.length = this.domlist.length;
        for (let i = 0; i < this.length; i++) {
          // @ts-ignore
          this.domlist[i].index = i;
        }
      }

      public hit(pos: number) {
        let { speed } = this;
        let roundIndex = 0; // æ¯åœˆå†…å½“å‰åºåˆ—
        let lap = 0; // åœˆæ•°
        let slowStart = true;
        let slowEnd = true;
        let finish = false; // ç»“æŸçš„æ ‡è¯†
        if (!this.playing) {
          this.playing = true;
          this.domlist[0].classList.add(this.currentClass);
          if (this.ease) {
            speed = this.speed * this.ratio;
          }
          /** è¶…å‡ºèŒƒå›´æˆ–è€…æœªæä¾›ä½ç½® */
          if (!pos || pos > this.domlist.length) {
            // eslint-disable-next-line no-param-reassign
            pos = 1;
          }

          const loop = () => {
            const choose = this.container.querySelector(`.${this.currentClass}`);
            // @ts-ignore
            this.index = choose.index + 1;
            if (this.index === this.length) {
              this.index = 0;
            }
            choose.classList.remove(this.currentClass);
            this.domlist[this.index].classList.add(this.currentClass);

            // eslint-disable-next-line no-plusplus
            roundIndex++;
            if (roundIndex === this.length) {
              // è®¡ç®—åœˆæ•°
              // eslint-disable-next-line no-plusplus
              lap++;
              roundIndex = 0;
            }
            if (this.ease && roundIndex === Math.floor(this.length / 2) && slowStart) {
              clearInterval(timeout);
              speed = this.speed;
              slowStart = false;
              timeout = setInterval(loop, speed);
            }
            if (lap > this.lap) {
              // åœˆè·‘å®Œäº†
              if (this.ease && slowEnd) {
                // åœˆè·‘å®Œäº†ï¼Œè¿›å…¥å˜é€Ÿ
                clearInterval(timeout);
                speed = this.speed * this.ratio;
                slowEnd = false;
                timeout = setInterval(loop, speed);
              }
              if (this.index + 1 === pos && finish) {
                clearInterval(timeout);
                this.playing = false;
                this.callback?.call(this, pos);
              }
              finish = true;
            }
          };
          let timeout = setInterval(loop, speed);
        }
      }
    }
    ```

    <details>
    <summary>ä½¿ç”¨æµ‹è¯•</summary>

    ```html
    <!-- ä½¿ç”¨æµ‹è¯• -->
    <style>
      .current {
        background-color: red;
      }
    </style>

    <ul id="j-ul">
      <li >ä¸åŒ…å«</li>
      <li class="box">1</li>
      <li class="box">2</li>
      <li class="box">3</li>
      <li class="box">4</li>
      <li class="box">5</li>
      <li class="box">6</li>
      <li class="box">7</li>
      <li class="box">8</li>
      <li class="box">9</li>
      <li class="box">...</li>
      <li class="box">ç¬¬nä¸ª</li>
      <li >ä¸åŒ…å«</li>
    </ul>

    <script>
    let sl = new SlotMC({
      container: document.getElementById('j-ul'),
      subClass: 'box'
    });
    sl.hit(2);
    // å»é™¤currentç±»ä¹‹åç»§ç»­è°ƒç”¨ï¼šsl.hit(n)
    </script>
    ```
    </details>

---
## ä»»åŠ¡æ‰§è¡Œ

### sleep
1. è¦æ±‚ï¼š

    å»¶æ—¶ä¸€æ®µæ—¶é—´ä¹‹åæ‰§è¡Œå‰©ä½™ä»£ç ã€‚
2. å®ç°æ–¹å¼ï¼š

    1. `async-await`ã€`Promise`ã€`setTimeout`

        ```js
        function sleep (ms) {
          return new Promise((resolve) => setTimeout(resolve, ms))
        }

        async function demo () {
          // ä½¿ç”¨
          console.time(1)
          await sleep(1000) // å»¶æ—¶æ‰§è¡Œ
          console.timeEnd(1)
          console.time(2)
          await sleep(1000) // å»¶æ—¶æ‰§è¡Œ
          console.timeEnd(2)
        }

        demo()
        ```

    - æ”¯æŒå–æ¶ˆçš„sleepï¼š

        ```ts
        type CancelablePromise = Promise<any> & { cancel: any };

        function sleep(timeout: number): CancelablePromise {
          let res: (v: string) => void;
          let timer: ReturnType<typeof setTimeout>;
          const promise = new Promise((resolve) => {
            res = resolve;
            timer = setTimeout(() => {
              resolve("done");
            }, timeout);
          }) as CancelablePromise;
          promise.cancel = function (data: string) {
            res(data);
            clearTimeout(timer);
          };

          return promise;
        }
        ```
    2. `Promise`ã€`setTimeout`

        ```js
        function sleep (ms) {
          return new Promise((resolve) => setTimeout(resolve, ms))
        }

        // ä½¿ç”¨
        console.time(1)
        sleep(1000).then(() => {    // å»¶æ—¶æ‰§è¡Œ
          console.timeEnd(1)
          console.time(2)
          sleep(1000).then(() => {  // å»¶æ—¶æ‰§è¡Œ
            console.timeEnd(2)
          })
        })
        ```
    3. `setTimeout`

        ```js
        // ä½¿ç”¨
        console.time(1)
        setTimeout(() => {  // å»¶æ—¶æ‰§è¡Œ
          console.timeEnd(1)
          console.time(2)
          setTimeout(() => {  // å»¶æ—¶æ‰§è¡Œ
            console.timeEnd(2)
          }, 1000)
        }, 1000)
        ```

    4. <details>

        <summary>JSå¾ªç¯ä»£ç å ç”¨ä¸»çº¿ç¨‹ï¼ˆé˜»å¡ã€å¡æ­»çº¿ç¨‹ï¼‰</del></summary>

        ```js
        function sleep (ms) {
          ms += new Date().getTime()
          while (new Date() < ms) {}
        }

        // ä½¿ç”¨
        console.time(1)
        sleep(1000) // å»¶æ—¶æ‰§è¡Œ
        console.timeEnd(1)
        console.time(2)
        sleep(1000) // å»¶æ—¶æ‰§è¡Œ
        console.timeEnd(2)
        ```
        </details>

### *åŸç”ŸJS*è½®è¯¢
```ts
// æä¾›ç»™ å‚æ•°taskFn è¿”å› `å¤±è´¥çš„ã€å€¼ä¸ºCANCEL_TOKEN çš„Promiseå®ä¾‹`
export const CANCEL_TOKEN = new Error("ä¸»åŠ¨ç»“æŸæ•´ä¸ªè½®è¯¢çš„æ ‡å¿—");

interface Options<T> {

  // è½®è¯¢æ‰§è¡Œæ–¹æ³•(å‚æ•°1ï¼šè½®è¯¢ç¬¬å‡ æ¬¡ï¼Œèµ·å§‹ä¸º1)
  //   è‹¥è¿”å› Promise.resolveï¼Œåˆ™æ‰§è¡ŒæˆåŠŸã€æ•´ä¸ªè½®è¯¢æˆåŠŸç»“æŸï¼›
  //   è‹¥è¿”å› Promise.rejectï¼Œåˆ™æ‰§è¡Œå¤±è´¥ï¼š
  //     ä¸»åŠ¨ç»“æŸæ•´ä¸ªè½®è¯¢ çº¦å®šï¼šè¿”å› `å¤±è´¥çš„ã€å€¼ä¸ºCANCEL_TOKEN çš„Promiseå®ä¾‹`ï¼›
  //     è‹¥ è½®è¯¢é‡è¯•æ¬¡æ•°ç”¨å®Œ æˆ– ä¸»åŠ¨ç»“æŸæ•´ä¸ªè½®è¯¢ æˆ– æ•´ä¸ªè½®è¯¢è¶…æ—¶ï¼Œåˆ™æ•´ä¸ªè½®è¯¢å¤±è´¥ç»“æŸï¼Œå¦åˆ™ç»§ç»­è½®è¯¢ã€‚
  taskFn: (num: number) => Promise<T>;

  // è½®è¯¢é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ï¼š5æ¬¡
  retries?: number;
  // é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ï¼š1000ms
  retryInterval?: number;

  // æ•´ä¸ªè½®è¯¢è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œè‹¥ä¸ä¼ åˆ™æ²¡æœ‰æ•´ä½“è¶…æ—¶æ—¶é—´
  masterTimeout?: number;
  // é‡è¯•å›è°ƒ(å‚æ•°1ï¼šå‰©ä½™é‡è¯•æ¬¡æ•°, å‚æ•°2ï¼šæœ¬æ¬¡é”™è¯¯ä¿¡æ¯)
  progressCallback?: (retriesRemain: number, err: unknown) => void;
}

// è½®è¯¢æ‰§è¡Œï¼ˆè½®è¯¢æ— æ³•åœ¨å¤–éƒ¨ç»ˆæ­¢ï¼Œåªèƒ½åœ¨ ä¼ å‚taskFn è¿”å›Promiseå®ä¾‹å¤„ç†ï¼‰
export const promisePoller = <T>(options: Options<T>): Promise<T> => {
  const { taskFn, retries = 5, retryInterval = 1000, masterTimeout, progressCallback } = options;

  let timeoutId: ReturnType<typeof setTimeout>;
  let pollingSafe = true; // æ˜¯å¦å¯ä»¥ç»§ç»­è½®è¯¢
  const rejections: Array<unknown> = []; // å­˜æ”¾å¤±è´¥ä¿¡æ¯
  let retriesRemain = retries;  // å‰©ä½™é‡è¯•æ¬¡æ•°

  return new Promise((resolve, reject) => {
    if (masterTimeout) {
      timeoutId = setTimeout(() => {
        pollingSafe = false;
        reject(rejections.concat("è½®è¯¢æ€»æ—¶é—´è¶…æ—¶"));
      }, masterTimeout);
    }

    const poll = () => {
      taskFn(retries - retriesRemain + 1)
        .then((result) => {
          clearTimeout(timeoutId);
          resolve(result);
        })
        .catch((err: typeof CANCEL_TOKEN | unknown) => {
          if (err === CANCEL_TOKEN) {
            clearTimeout(timeoutId);
            reject(rejections.concat("ä¸»åŠ¨ç»“æŸæ•´ä¸ªè½®è¯¢"));
          } else {
            // å­˜å‚¨è½®è¯¢å¤±è´¥ä¿¡æ¯
            rejections.push(err);

            // å‰©ä½™é‡è¯•æ¬¡æ•°å‡ä¸€
            retriesRemain -= 1;

            progressCallback?.(retriesRemain, err);

            if (retriesRemain > 0) {
              pollingSafe && new Promise((resolve2) => {
                setTimeout(resolve2, retryInterval)
              }).finally(() => {
                poll()
              });
            } else {
              clearTimeout(timeoutId);
              reject(rejections);
            }
          }
        });
    };

    poll();
  });
};


/* ä½¿ç”¨æµ‹è¯• */
promisePoller({
  taskFn: async (num: number) => {
    console.log(`æ‰§è¡Œç¬¬${num}æ¬¡`);
    await delay(200);
    if (Math.random() < 0.5) {
      // å¤±è´¥
      return Promise.reject(new Error(`æ‰§è¡Œç¬¬${num}æ¬¡å¤±è´¥`)); // æˆ–ï¼š throw new Error(`æ‰§è¡Œç¬¬${num}æ¬¡å¤±è´¥`)
    } else if (Math.random() < 0.5) {
      // æˆåŠŸ
      return num;
    } else {
      // ä¸»åŠ¨ç»“æŸæ•´ä¸ªè½®è¯¢
      return Promise.reject(CANCEL_TOKEN);  // æˆ–ï¼š throw CANCEL_TOKEN
    }
  },
})
  .then((data) => console.log('æ•´ä¸ªè½®è¯¢æˆåŠŸ', data))
  .catch((err) => console.error('æ•´ä¸ªè½®è¯¢å¤±è´¥', err));

function delay(ms: number) {
  return new Promise((resolve, reject) => {
    if (Math.random() < 0.5) {
      setTimeout(() => {
        reject('delay éšæœºå¤±è´¥')
      }, ms);
    } else {
      setTimeout(() => {
        resolve('delay éšæœºæˆåŠŸ')
      }, ms);
    }
  });
}
```
>å‚è€ƒï¼š[promise-poller](https://github.com/joeattardi/promise-poller)ã€‚

### *åŸç”ŸJS*èŠ‚æµå‡½æ•°
```ts
class Throttle<T extends any[]> {
  constructor(func: (...args: T) => void, delay: number = 300, atBegin: boolean = true) {
    this.delay = delay;
    this.atBegin = atBegin;
    this.func = func;
  }

  private delay: number;
  private atBegin: boolean;
  private func: (...args: T) => void;

  private timer: number = 0;

  // åˆ·æ–°æ‰§è¡Œ
  public flush: (...args: T) => void = (...args: T) => {
    if (!this.timer) {
      this.atBegin && this.func.apply(this, args);
      this.timer = setTimeout(() => {
        !this.atBegin && this.func.apply(this, args);
        this.timer = 0;
      }, this.delay);
    }
  };

  // å–æ¶ˆæ‰§è¡Œ
  public cancel: () => void = () => {
    if (this.timer) {
      clearTimeout(this.timer);
      this.timer = 0;
    }
  };

  // åˆ¤æ–­æ˜¯å¦èŠ‚æµä¸­
  public isPending: () => boolean = () => {
    return this.timer !== 0;
  };
}


/* ä½¿ç”¨æµ‹è¯• */
const a = new Throttle((a: number, b: string)=>{})
a.flush(1, '');a.flush(1, '');
a.isPending();
a.cancel()
```

### *åŸç”ŸJS*ç”¨`setTimeout`æ¨¡æ‹Ÿ`setInterval`
```js
/**
 * ç”¨setTimeoutæ¨¡æ‹ŸsetInterval
 * @constructor
 * @param {Function} func - å¾ªç¯æ‰§è¡Œå‡½æ•°
 * @param {Number} ms - é—´éš”æ¯«ç§’
 */
function SetInterval(func, ms) {
  let timeoutId;

  if (typeof func === "function") {
    timeoutId = setTimeout(function cb() {
      timeoutId = setTimeout(cb, ms);

      func();
    }, ms);
  }

  this.stop = function () {
    clearTimeout(timeoutId);
  };
}


/* ä½¿ç”¨æµ‹è¯• */
var a = new SetInterval(function () {
  console.log(1);

  if (...) {
    a.stop();
  }
}, 1000);

// a.stop();
```

### *åŸç”ŸJS*`requestAnimationFrame`çš„é€’å½’
```js
/**
 * æ¯ä¸€å¸§éƒ½æ‰§è¡Œä¸€æ¬¡func
 * @constructor
 * @param {Function} func - æ‰§è¡Œçš„å‡½æ•°
 */
function RepeatRAF(func) {
  let requestId;

  if (typeof func === "function") {
    requestId = requestAnimationFrame(function cb() {
      requestId = requestAnimationFrame(cb);

      func();
    });
  }

  this.stop = function () {
    cancelAnimationFrame(requestId);
  };
}


/* ä½¿ç”¨æµ‹è¯• */
var a = new RepeatRAF(function () {
  console.log(1);

  if (...) {
    a.stop();
  }
});

// a.stop();
```

### *åŸç”ŸJS*`requestAnimationFrame`æ¨¡æ‹Ÿ`setTimeout`å’Œ`setInterval`
1. æ¨¡æ‹Ÿ`setTimeout`

    ```js
    function SetTimeout(func, ms) {
      const start = Date.now();

      let requestId;

      if (typeof func === "function") {
        requestId = requestAnimationFrame(function cb() {
          if (Date.now() - start >= ms) {
            func();
          } else {
            requestId = requestAnimationFrame(cb);
          }
        });
      }

      this.stop = function () {
        cancelAnimationFrame(requestId);
      };
    }

    /* ä½¿ç”¨æµ‹è¯• */
    var a = new SetTimeout(function () {
      console.log(1);

      if (...) {
        a.stop();
      }
    }, 1000);

    // a.stop();
    ```
2. æ¨¡æ‹Ÿ`setInterval`

    ```js
    function SetInterval(func, ms) {
      let start = Date.now();

      let requestId;

      if (typeof func === "function") {
        requestId = requestAnimationFrame(function cb() {
          requestId = requestAnimationFrame(cb);

          if (Date.now() - start >= ms) {
            func();
            start = Date.now();
          }
        });
      }

      this.stop = function () {
        cancelAnimationFrame(requestId);
      };
    }

    /* ä½¿ç”¨æµ‹è¯• */
    var a = new SetInterval(function () {
      console.log(1);

      if (...) {
        a.stop();
      }
    }, 100);

    // a.stop();
    ```

---
## ç®—æ³•æ€è·¯

### *åŸç”ŸJS*åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºç©º
```js
function isObjEmpty(obj) {
  if (obj !== Object(obj)) {  /* å‚æ•°ä¸æ˜¯å¯¹è±¡ */
    throw new TypeError("å‚æ•°ä¸æ˜¯å¯¹è±¡");
  } else if (typeof Object.keys === "function") {
    return Object.keys(obj).length === 0;
  } else {                    /* å…¼å®¹æ€§ï¼Œie9- */
    for (var one in obj) {
      if (obj.hasOwnProperty(one)) {
        return false;
      }
    }
    return true;
  }
}
```

### æ— ç¼è½®æ’­
1. è¦æ±‚ï¼š

    ä¸€å…±æœ‰`n`æ•°é‡çš„é¡¹ï¼ˆ**1**,**2**,**3**,...,**n**ï¼‰ï¼Œä¸­é—´å±•ç¤ºå†…å®¹æœ‰`i`æ•°é‡çš„é¡¹ï¼Œå·¦å³ï¼ˆæˆ–ä¸Šä¸‹ï¼‰åˆ†åˆ«å±•ç¤ºå¾…è½®æ’­æœ‰`m`æ•°é‡çš„é¡¹ï¼ˆè½®æ’­åˆ°ä»»ä½•é¡¹éƒ½å¯ä»¥çœ‹è§å·¦å³`m`æ•°é‡çš„é¡¹ï¼‰ï¼Œå¯ä»¥æ— ç¼å‘å·¦å³ï¼ˆæˆ–ä¸Šä¸‹ï¼‰è½®æ’­ã€‚
2. å®ç°æ–¹å¼ï¼š

    1. æ–¹æ³•1ï¼š

        1. *åŸå§‹é¡¹*å‰é¢å¤åˆ¶*åŸå§‹é¡¹*æœ€åçš„ **n-(m+i)+1**é¡¹~**n**é¡¹ çš„ä¸€å…±`m+i`æ•°é‡çš„é¡¹ï¼›*åŸå§‹é¡¹*åé¢å¤åˆ¶*åŸå§‹é¡¹*æœ€å‰çš„ **1**é¡¹~**m+i**é¡¹ çš„ä¸€å…±`m+i`æ•°é‡çš„é¡¹ã€‚
        2. å› ä¸ºå‰åæ–°å¢äº†é¡¹ï¼Œæ»šåŠ¨å‰çš„åˆå§‹ä½ç½®è¦å‘å·¦ï¼ˆæˆ–ä¸Šï¼‰ç§»åŠ¨`m+i`æ•°é‡çš„é¡¹çš„è·ç¦»ã€‚
        3. è½®æ’­åˆ°è¾¾*åŸå§‹é¡¹*è¾¹ç¼˜ï¼š

            1. å³ï¼ˆæˆ–ä¸‹ï¼‰è½®æ’­ï¼šå½“å®Œå…¨æ’­æ”¾å®ŒåŸå§‹æœ€åä¸€é¡¹æ—¶ï¼ˆæœ€å`i`æ•°é‡çš„é¡¹å…¨éƒ¨è½®æ’­å®Œæ¯•ï¼‰ï¼ŒæŠŠæ•´ä¸ªè½®æ’­å†…å®¹å‘å·¦ï¼ˆæˆ–ä¸Šï¼‰ç§»åŠ¨æ•´ä¸ª*åŸå§‹é¡¹*çš„è·ç¦»ã€‚
            2. å·¦ï¼ˆæˆ–ä¸Šï¼‰è½®æ’­ï¼šå½“å®Œå…¨æ’­æ”¾å®ŒåŸå§‹æœ€å‰ä¸€é¡¹æ—¶ï¼ˆæœ€å‰`i`æ•°é‡çš„é¡¹å…¨éƒ¨è½®æ’­å®Œæ¯•ï¼‰ï¼ŒæŠŠæ•´ä¸ªè½®æ’­å†…å®¹å‘å³ï¼ˆæˆ–ä¸‹ï¼‰ç§»åŠ¨æ•´ä¸ª*åŸå§‹é¡¹*çš„è·ç¦»ã€‚
    2. æ–¹æ³•2ï¼š

        ä¸å¤åˆ¶ã€ç§»åŠ¨æ•´ä¸ªDOMçš„æ–¹æ³•ã€‚
    3. æ–¹æ³•3ï¼š

        æ”¹å˜å•ä¸ªé¡¹çš„å †å å±‚çº§ã€‚

### è·å–æŸä¸€ä½çš„æ•°å­—
1. å­—ç¬¦ä¸²åŒ–åè·å–é‚£ä¸€ä½çš„å­—ç¬¦

    ```js
    /**
     * è·å–æŸä¸€ä½çš„æ•°å­—
     * @param {Number} num - æ“ä½œæ•°
     * @param {Number} [index = 0] - è·å–ä»å³å‘å·¦ç¬¬indexä½ç½®ä¸Šçš„æ•°å­—ï¼ˆè‹¥æ˜¯10è¿›åˆ¶ï¼Œåˆ™0ï¼šä¸ªä½ï¼›1ï¼šåä½ï¼›2ï¼šç™¾ä½...ï¼‰
     * @param {Number} [radix = 10] - è¿›åˆ¶
     * @returns {Number} - æ•°å­—ï¼ˆåè¿›åˆ¶è¡¨ç¤ºï¼‰
     */
    function getIndexNumber(num, index = 0, radix = 10) {
      const str = num.toString(radix);
      return parseInt(str[str.length - 1 - index], radix) || 0;
    }
    ```
2. ç®—æœ¯

    ```js
    /**
     * è·å–æŸä¸€ä½çš„æ•°å­—
     * @param {Number} num - æ“ä½œæ•°
     * @param {Number} [index = 0] - è·å–ä»å³å‘å·¦ç¬¬indexä½ç½®ä¸Šçš„æ•°å­—ï¼ˆè‹¥æ˜¯10è¿›åˆ¶ï¼Œåˆ™0ï¼šä¸ªä½ï¼›1ï¼šåä½ï¼›2ï¼šç™¾ä½...ï¼‰
     * @param {Number} [radix = 10] - è¿›åˆ¶
     * @returns {Number} - æ•°å­—ï¼ˆåè¿›åˆ¶è¡¨ç¤ºï¼‰
     */
    function getIndexNumber(num, index = 0, radix = 10) {
      return Math.floor(num / Math.pow(radix, index)) % radix;
    }
    ```

<details>
<summary>æ•°å­¦å…¬å¼</summary>

å¯¹äºä¸€ä¸ª $d$ è¿›åˆ¶çš„æ•°å­— $x$ï¼Œè¦è·å–å…¶ç¬¬ $k$ ä½ $x_k$ï¼ˆkï¼š0è¡¨ç¤ºå³è¾¹ç¬¬ä¸€ä½ã€1è¡¨ç¤ºå³è¾¹ç¬¬äºŒä½ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ï¼š

$x_k = \lfloor\frac{x}{d^k}\rfloor \bmod d$ï¼ˆ $\lfloor a \rfloor$è¡¨ç¤ºå¯¹æµ®ç‚¹æ•° $a$ å‘ä¸‹å–æ•´ï¼› $\bmod \space d$ è¡¨ç¤ºå¯¹ $d$ å–ä½™ï¼‰ã€‚
</details>

- <details>

    <summary>ä½¿ç”¨æµ‹è¯•</summary>

    ```js
    /* ä½¿ç”¨æµ‹è¯• */
    console.log(getIndexNumber(1, 0), 1);
    console.log(getIndexNumber(1, 1), 0);
    console.log(getIndexNumber(1, 2), 0);
    console.log("----");
    console.log(getIndexNumber(123456, 0), 6);
    console.log(getIndexNumber(123456, 1), 5);
    console.log(getIndexNumber(123456, 2), 4);
    console.log(getIndexNumber(123456, 3), 3);
    console.log(getIndexNumber(123456, 4), 2);
    console.log(getIndexNumber(123456, 5), 1);
    console.log(getIndexNumber(123456, 6), 0);
    console.log("----");
    console.log(getIndexNumber(0b101, 0, 2), 1);
    console.log(getIndexNumber(0b101, 1, 2), 0);
    console.log(getIndexNumber(0b101, 2, 2), 1);
    console.log(getIndexNumber(0b101, 3, 2), 0);
    console.log("----");
    console.log(getIndexNumber(0b101101, 0, 2), 1);
    console.log(getIndexNumber(0b101101, 1, 2), 0);
    console.log(getIndexNumber(0b101101, 2, 2), 1);
    console.log(getIndexNumber(0b101101, 3, 2), 1);
    console.log(getIndexNumber(0b101101, 4, 2), 0);
    console.log(getIndexNumber(0b101101, 5, 2), 1);
    console.log(getIndexNumber(0b101101, 6, 2), 0);
    console.log(getIndexNumber(0b101101, 7, 2), 0);
    console.log("----");
    console.log(getIndexNumber(0x4567890abcdef, 0, 16), 15);
    console.log(getIndexNumber(0x4567890abcdef, 1, 16), 14);
    console.log(getIndexNumber(0x4567890abcdef, 2, 16), 13);
    console.log(getIndexNumber(0x4567890abcdef, 3, 16), 12);
    console.log(getIndexNumber(0x4567890abcdef, 4, 16), 11);
    console.log(getIndexNumber(0x4567890abcdef, 5, 16), 10);
    console.log(getIndexNumber(0x4567890abcdef, 6, 16), 0);
    console.log(getIndexNumber(0x4567890abcdef, 7, 16), 9);
    console.log(getIndexNumber(0x4567890abcdef, 8, 16), 8);
    console.log(getIndexNumber(0x4567890abcdef, 9, 16), 7);
    console.log(getIndexNumber(0x4567890abcdef, 10, 16), 6);
    console.log(getIndexNumber(0x4567890abcdef, 11, 16), 5);
    console.log(getIndexNumber(0x4567890abcdef, 12, 16), 4);
    console.log(getIndexNumber(0x4567890abcdef, 13, 16), 0);
    ```
    </details>

---
## Node.jsç›¸å…³

### ç¡®ä¿æ–‡ä»¶å¤¹å­˜åœ¨
```js
const fs = require("fs");
const path = require("path");

// ç¡®ä¿æ–‡ä»¶å¤¹å­˜åœ¨ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå¯åˆ¤æ–­å¤šå±‚æ–‡ä»¶å¤¹ï¼‰
function validateFolder(pathWay) {
  if (fs.existsSync(pathWay)) {
    return true;
  } else {
    if (validateFolder(path.dirname(pathWay))) {
      fs.mkdirSync(pathWay);
      console.log(`åˆ›å»º ${pathWay}`);
      return true;
    }
  }
}
```

---
### jQueryæ–¹æ³•

#### jQueryæ»šåŠ¨åŠ è½½
1. ä»¥**æ”¾ç½®åœ¨åº•éƒ¨çš„èŠ‚ç‚¹ä¸å±å¹•çš„ç›¸å¯¹è·ç¦»**ä½œä¸ºæ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨çš„åˆ¤æ–­ï¼š

```html
<!--
data-nextï¼šåŠ è½½å†…å®¹æ ‡è¯†ï¼ˆ-1ï¼šå»é™¤æ»šåŠ¨åŠ è½½åŠŸèƒ½ï¼›0ï¼šå•æ¬¡ä¸åŠ è½½ï¼‰
data-statusï¼šæ˜¯å¦æ­£åœ¨åŠ è½½ï¼ˆ'ready'ï¼šä¸åœ¨åŠ è½½ä¸­ã€å¯ä»¥è¿›è¡ŒåŠ è½½ï¼›'busy'ï¼šåŠ è½½ä¸­ã€ä¸å…è®¸åŠ è½½ï¼‰
-->
<div class="j-load" data-next="1" data-status="ready">æ”¾ç½®åœ¨åº•éƒ¨çš„æ ‡è®°èŠ‚ç‚¹ï¼Œå†…å®¹æ·»åŠ åœ¨æ­¤èŠ‚ç‚¹å‰é¢</div>

<script>
    var scrollLoadObj = {
        namespace: '', /*äº‹ä»¶å‘½åç©ºé—´ */
        loadMore: function (next) { /*åŠ è½½é€»è¾‘ */
            var $load = $('.j-load'),
                newNext = 0;

            next = parseInt(next, 10);

            if (next !== -1 && $load.length >= 1) {
                if ($load.attr('data-status') === 'ready' && next !== 0) {
                    $load.attr('data-status', 'busy');

                    $.ajax({
                        url: '',
                        dataType: 'json',
                        data: {
                            id: next
                        }
                    }).done(function (data) {
                        /* åˆ é™¤é‡å¤å†…å®¹ */
                        /* å…¶ä»–å…·ä½“æ“ä½œ */

                        newNext = data.next;

                        $load.attr('data-next', newNext);
                    }).fail(function () {
                        console.log('ç½‘ç»œé”™è¯¯');
                    }).always(function () {
                        $load.attr('data-status', 'ready');

                        if (/* æŸæ¡ä»¶ */) {   /* ä¸å†åŠ è½½ */
                            $(window).off('scroll' + '.' + scrollLoadObj.namespace);
                            /* $load.hide(); */
                        } else {
                            scrollLoadObj.autoLoadMore(newNext);
                        }
                    });
                }
            } else {
                $(window).off('scroll' + '.' + scrollLoadObj.namespace);
                /* $load.hide(); */
            }
        },
        autoLoadMore: function (next) { /* è‹¥htmlå°äºè§†çª—åˆ™è§¦å‘åŠ è½½ */
            if ($('html').outerHeight(true) <= $(window).height()) {
                scrollLoadObj.loadMore(next);
            }
        },
        init: function () {
            if (typeof Date.now !== 'function') {
                Date.now = function () {
                    return new Date().getTime();
                };
            }

            scrollLoadObj.namespace = Date.now();

            $(function () {
                var $load = $('.j-load'),
                    scrollSetTimeoutId;

                scrollLoadObj.autoLoadMore($load.attr('data-next'));

                $(window).on('scroll' + '.' + scrollLoadObj.namespace, function () {
                    clearTimeout(scrollSetTimeoutId);

                    scrollSetTimeoutId = setTimeout(function () {
                        if ($load.offset().top <= $(window).scrollTop() + $(window).height()) {  /* èŠ‚ç‚¹é¡¶éƒ¨åœ¨å±å¹•åº•éƒ¨ä»¥ä¸Š */
                            scrollLoadObj.loadMore($load.attr('data-next'));
                        }
                    }, 200);
                });
            });
        }
    };


    /* ä½¿ç”¨æµ‹è¯• */
    scrollLoadObj.init();
</script>
```
2. ä»¥**æ–‡æ¡£æ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨**ä½œä¸ºæ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨çš„åˆ¤æ–­ï¼š

```html
<!--
data-nextï¼šåŠ è½½å†…å®¹æ ‡è¯†ï¼ˆ-1ï¼šå»é™¤æ»šåŠ¨åŠ è½½åŠŸèƒ½ï¼›0ï¼šå•æ¬¡ä¸åŠ è½½ï¼‰
data-statusï¼šæ˜¯å¦æ­£åœ¨åŠ è½½ï¼ˆ'ready'ï¼šä¸åœ¨åŠ è½½ä¸­ã€å¯ä»¥è¿›è¡ŒåŠ è½½ï¼›'busy'ï¼šåŠ è½½ä¸­ã€ä¸å…è®¸åŠ è½½ï¼‰
-->
<div class="j-load" data-next="1" data-status="ready">ä¸ä½œä¸ºæ ‡è®°èŠ‚ç‚¹ï¼Œä»…ä½œä¸ºå†…å®¹æ·»åŠ å®¹å™¨</div>

<script type="text/javascript">
    var scrollLoadObj = {
        namespace: '', /* äº‹ä»¶å‘½åç©ºé—´ */
        loadMore: function (next) { /* åŠ è½½é€»è¾‘ */
            var $load = $('.j-load'),
                newNext = 0;

            next = parseInt(next, 10);

            if (next !== -1 && $load.length >= 1) {
                if ($load.attr('data-status') === 'ready' && next !== 0) {
                    $load.attr('data-status', 'busy');

                    $.ajax({
                        url: '',
                        dataType: 'json',
                        data: {
                            id: next
                        }
                    }).done(function (data) {
                        /* åˆ é™¤é‡å¤å†…å®¹ */
                        /* å…¶ä»–å…·ä½“æ“ä½œ */

                        newNext = data.next;

                        $load.attr('data-next', newNext);
                    }).fail(function () {
                        console.log('ç½‘ç»œé”™è¯¯');
                    }).always(function () {
                        $load.attr('data-status', 'ready');

                        if (/* æŸæ¡ä»¶ */) {   /* ä¸å†åŠ è½½ */
                            $(window).off('scroll' + '.' + scrollLoadObj.namespace);
                        } else {
                            scrollLoadObj.autoLoadMore(newNext);
                        }
                    });
                }
            } else {
                $(window).off('scroll' + '.' + scrollLoadObj.namespace);
            }
        },
        autoLoadMore: function (next) { /* è‹¥htmlå°äºè§†çª—åˆ™è§¦å‘åŠ è½½ */
            if ($('html').outerHeight(true) <= $(window).height()) {
                scrollLoadObj.loadMore(next);
            }
        },
        init: function () {
            if (typeof Date.now !== 'function') {
                Date.now = function () {
                    return new Date().getTime();
                };
            }

            scrollLoadObj.namespace = Date.now();

            $(function () {
                var $load = $('.j-load'),
                    scrollSetTimeoutId;

                scrollLoadObj.autoLoadMore($load.attr('data-next'));

                $(window).on('scroll' + '.' + scrollLoadObj.namespace, function () {
                    clearTimeout(scrollSetTimeoutId);

                    scrollSetTimeoutId = setTimeout(function () {
                        if ($(window).height() + $(window).scrollTop() >= $(document).height()) {  /* æ–‡æ¡£æ»šåŠ¨åˆ°åº•éƒ¨ */
                            scrollLoadObj.loadMore($load.attr('data-next'));
                        }
                    }, 200);
                });
            });
        }
    };


    /* ä½¿ç”¨æµ‹è¯• */
    scrollLoadObj.init();
</script>
```

>Zeptoé»˜è®¤ï¼šæ²¡æœ‰`deferred`çš„å¯¹è±¡ã€æ²¡æœ‰`outerHeight`æ–¹æ³•ã€‚

#### jQueryå›¾ç‰‡å»¶æ—¶åŠ è½½ï¼ˆlazyloadï¼‰
>1. [lazysizes](https://github.com/aFarkas/lazysizes)
>2. vueçš„æŸä¸ªæ‡’åŠ è½½åº“ï¼š[vue-lazyload](https://github.com/hilongjw/vue-lazyload)ã€‚

```html
<img src="é»˜è®¤å›¾åœ°å€" data-src="çœŸå®å›¾åœ°å€" data-error="çœŸå®å›¾é”™è¯¯åçš„é»˜è®¤å›¾åœ°å€" class="j-img-1">
<img src="é»˜è®¤å›¾åœ°å€" data-src-user="çœŸå®å›¾åœ°å€" data-error-user="çœŸå®å›¾é”™è¯¯åçš„é»˜è®¤å›¾åœ°å€" class="j-img-2">

<script>
    /**
     * å›¾ç‰‡å»¶æ—¶åŠ è½½
     * @constructor
     * @param {String} className - è§¦å‘çš„ç±»å
     * @param {String} [dataSrc = 'data-src'] - imgæ ‡ç­¾ä¸Šå­˜æ”¾ã€ŒçœŸå®åœ°å€ã€çš„å±æ€§
     * @param {Function} func - å›¾ç‰‡åŠ è½½æˆåŠŸåå›è°ƒå‡½æ•°ï¼Œthiså’Œå‚æ•°ä¸ºå›¾ç‰‡DOM
     * @param {String} [dataError = 'data-error'] - imgæ ‡ç­¾ä¸Šå­˜æ”¾ã€ŒçœŸå®åœ°å€åŠ è½½å¤±è´¥åæ˜¾ç¤ºçš„åœ°å€ã€çš„å±æ€§
     * @param {Function} errorFunc - å›¾ç‰‡åŠ è½½å¤±è´¥åå›è°ƒå‡½æ•°ï¼Œthiså’Œå‚æ•°ä¸ºå›¾ç‰‡DOM
     */
    function ImgLazyLoad(className, dataSrc, func, dataError, errorFunc) {
        if (typeof Date.now !== 'function') {
            Date.now = function () {
                return new Date().getTime();
            };
        }

        var _timeoutId,
            _namespace = Date.now(), /* äº‹ä»¶å‘½åç©ºé—´ */
            _lazyLoad = function (domArr, className, dataSrc, func, dataError, errorFunc) { /* å›¾ç‰‡å»¶æ—¶åŠ è½½ */
                dataSrc = dataSrc || 'data-src';
                dataError = dataError || 'data-error';

                $.each(domArr, function (index, value) {
                    var $this = $(value);

                    var srcReal = $this.attr(dataSrc),
                        srcError = $this.attr(dataError),
                        newImg = new Image();

                    if (srcReal) {
                        newImg.src = srcReal;

                        newImg.onerror = function () {
                            if (srcError) {
                                $this.attr('src', srcError)
                                    .removeAttr(dataError);
                            }

                            $this.removeClass(className);

                            if (typeof errorFunc === 'function') {
                                errorFunc.call(value, value);
                            }

                            /* é˜²æ­¢å†…å­˜æ³„éœ² */
                            newImg.onload = null;
                            newImg.onerror = null;
                            newImg = null;
                        };

                        if (newImg.complete) {    /* ç¼“å­˜åŠ è½½ */
                            $this.attr('src', srcReal)
                                .removeAttr(dataSrc)
                                .removeClass(className);

                            if (typeof func === 'function') {
                                func.call(value, value);
                            }

                            /* é˜²æ­¢å†…å­˜æ³„éœ² */
                            newImg.onerror = null;
                            newImg = null;
                        } else {
                            newImg.onload = function () {   /* æ–°åŠ è½½ */
                                $this.attr('src', srcReal)
                                    .removeAttr(dataSrc)
                                    .removeClass(className);

                                if (typeof func === 'function') {
                                    func.call(value, value);
                                }

                                /* é˜²æ­¢å†…å­˜æ³„éœ² */
                                newImg.onload = null;
                                newImg.onerror = null;
                                newImg = null;
                            };
                        }
                    } else {
                        if (srcError) {
                            $this.attr('src', srcError)
                                .removeAttr(dataError);
                        }

                        $this.removeClass(className);

                        if (typeof errorFunc === 'function') {
                            errorFunc.call(value, value);
                        }

                        /* é˜²æ­¢å†…å­˜æ³„éœ² */
                        newImg = null;
                    }
                });
            },
            _getImgArr = function (className, offset) { /* è·å–å±å¹•å†…domæ•°ç»„ */
                var $all = $('.' + className),
                    screenTop = $(window).scrollTop(),
                    screenBottom = screenTop + $(window).height(),
                    domArr = [];

                if (typeof offset !== 'number') {
                    offset = 50;
                }

                $all.each(function (index, element) {
                    var elemTop = $(element).offset().top,
                        elemBottom = elemTop + $(element).height(); /* jQueryå¯ä»¥ç”¨outerHeight */

                    if (elemTop <= screenBottom + offset && elemBottom >= screenTop - offset) {  /* èŠ‚ç‚¹é¡¶éƒ¨åœ¨å±å¹•åº•éƒ¨ä»¥ä¸Š && èŠ‚ç‚¹åº•éƒ¨åœ¨å±å¹•é¡¶éƒ¨ä»¥ä¸‹ */
                        domArr.push(element);
                    }
                });

                return domArr;
            },
            _run = function (className, func) {    /* è§¦å‘ */
                clearTimeout(_timeoutId);
                _timeoutId = setTimeout(function () {
                    _lazyLoad(_getImgArr(className), className, dataSrc, func, dataError, errorFunc);
                }, 200);
            },
            _init = function (className, func) {
                _run(className, func);

                $(window).on('scroll' + '.' + _namespace, function () {
                    _run(className, func);
                });
            };

        this.stop = function () {    /* è§£ç»‘äº‹ä»¶ç»‘å®š */
            $(window).off('scroll' + '.' + _namespace);
        };

        _init(className, func);
    }


    /* ä½¿ç”¨æµ‹è¯• */
    var a = new ImgLazyLoad('j-img-1'),
        b = new ImgLazyLoad(
            'j-img-2',
            'data-src-user',
            function (e) {
                console.log('æˆåŠŸ', this, this === e);
            },
            'data-error-user',
            function (e) {
                console.log('å¤±è´¥', this, this === e);
            }
        );

    // a.stop();
    // b.stop();
</script>
```

[CodePen demo](https://codepen.io/realgeoffrey/pen/gVLZyg)

>æ»šåŠ¨äº‹ä»¶ä»£ç†å¯ä»¥ä»£ç†åœ¨`window`æˆ–ç›‘æ§å›¾ç‰‡åŠ è½½çš„æ»šåŠ¨èŠ‚ç‚¹ä¸Šã€‚

---
#### jQueryèŠ‚ç‚¹è·Ÿéšå±å¹•æ»šåŠ¨è€Œç›¸å¯¹é™æ­¢
1. `fixed`ï¼š

```html
<style>
    .z-affix-top {
        width: å®½åº¦;
        position: fixed;
        left: ;
        margin-left: ;
        top: ;
    }
    .z-affix-bottom {
        width: å®½åº¦;
        position: absolute;
        left: ;
    }
</style>

<script>
    /**
     * è·Ÿéšå±å¹•æ»šåŠ¨è€Œç›¸å¯¹é™æ­¢ï¼ˆfixedï¼‰ï¼Œå½“åˆ°è¾¾åº•éƒ¨æŸè·ç¦»æ—¶ã€Œæ¢å¤ã€æ»šåŠ¨
     * @constructor
     * @param {Object} $target - è·Ÿå±ç›®æ ‡çš„jQueryå¯¹è±¡
     * @param {Number} topOffset - è§¦å‘æ·»åŠ topClassçš„è·æ–‡æ¡£é¡¶éƒ¨çš„è·ç¦»
     * @param {String} topClass - è·Ÿéšå±å¹•çš„ç±»ï¼Œè¦è§„å®šèŠ‚ç‚¹çš„å®½åº¦ã€ä½ç½®ï¼ˆfixedï¼‰
     * @param {Number} [bottomOffset = 0] - è§¦å‘æ·»åŠ bottomClassçš„è·æ–‡æ¡£åº•éƒ¨çš„è·ç¦»
     * @param {String} [bottomClass = ''] - è§¦åº•çš„ç±»ï¼Œè¦è§„å®šèŠ‚ç‚¹çš„å®½åº¦ã€ä½ç½®ï¼ˆabsoluteï¼‰ï¼Œtopç”±ä»£ç è®¡ç®—è·å¾—
     */
    function FollowFixed($target, topOffset, topClass, bottomOffset, bottomClass) {
      if (typeof Date.now !== 'function') {
        Date.now = function () {
          return new Date().getTime();
        };
      }

      var _namespace = Date.now(),  // äº‹ä»¶å‘½åç©ºé—´
        _isIE = function (num) {    // åˆ¤æ–­ieç‰ˆæœ¬
          var dom = document.createElement('b');

          dom.innerHTML = '<!--[if IE ' + num + ']><i></i><![endif]-->';

          return dom.getElementsByTagName('i').length;
        },
        _followFixed = function () {
          var scollTop = $(window).scrollTop(),
            documentHeight = $(document).height(),
            targetHeight = $target.height();   // jQueryå¯ä»¥ç”¨outerHeight

          if (scollTop >= topOffset) {    // æ»šåŠ¨è·ç¦»è¶…è¿‡topOffset
            if (!$target.hasClass(bottomClass)) {   // æ²¡æœ‰æ·»åŠ bottomClass
              if (documentHeight - ($target.offset().top + targetHeight) > bottomOffset) {    // èŠ‚ç‚¹åº•éƒ¨è·ç¦»æ–‡æ¡£åº•éƒ¨è·ç¦» > bottomOffet
                requestAnimationFrame(function () {
                  $target.removeClass(bottomClass).addClass(topClass)
                    .removeAttr('style');
                });
              } else if (bottomClass) {   // è¶…è¿‡bottomOffet,å¹¶ä¸”bottomClasså­˜åœ¨
                requestAnimationFrame(function () {
                  $target.removeClass(topClass).addClass(bottomClass)
                    .css('top', documentHeight - $target.offsetParent().offset().top - targetHeight - bottomOffset);
                });
              }
            } else {    // æ·»åŠ äº†bottomClass
              if (scollTop < $target.offset().top) {  // æ»šåŠ¨å°äºèŠ‚ç‚¹
                requestAnimationFrame(function () {
                  $target.removeClass(bottomClass).addClass(topClass)
                    .removeAttr('style');
                });
              }
            }
          } else {
            requestAnimationFrame(function () {
              $target.removeClass(topClass + ' ' + bottomClass)
                .removeAttr('style');
            });
          }
        };

      if (!_isIE(6)) {
        bottomOffset = bottomOffset || 0;
        bottomClass = bottomClass || '';

        _followFixed();

        $(window).on('scroll' + '.' + _namespace, _followFixed);
      }

      this.stop = function () {
        $target.removeClass(topClass + ' ' + bottomClass);
        $(window).off('scroll' + '.' + _namespace);
      };
    }


    /* ä½¿ç”¨æµ‹è¯• */
    var a = new FollowFixed($('.target'), $('.target').offset().top, 'z-affix-top', 200, 'z-affix-bottom');

    // a.stop();
</script>
```

[CodePen demo](https://codepen.io/realgeoffrey/pen/LwbMKE)

2. `margin-top`ï¼š

```html
<div class="clearfix">
    <div class="father">
        å¯æœ‰å¯æ— çš„ã€å¸¦marginæˆ–ä¸å¸¦marginçš„èŠ‚ç‚¹
        <div class="target">targetå†…å®¹</div>
        å¯æœ‰å¯æ— çš„ã€å¸¦marginæˆ–ä¸å¸¦marginçš„èŠ‚ç‚¹ï¼Œie6ã€7ä¸‹å¯èƒ½éœ€è¦è§¦å‘hasLayout
    </div>
    <div class="dependent">
        çˆ¶çº§çš„å…„å¼ŸèŠ‚ç‚¹
    </div>
</div>

<script>
    /**
     * è·Ÿéšå±å¹•æ»šåŠ¨è€Œç›¸å¯¹é™æ­¢ï¼ˆmargin-topå˜åŒ–ï¼‰
     * @constructor
     * @param {String} target - ç›®æ ‡èŠ‚ç‚¹
     * @param {String} father - ç›®æ ‡èŠ‚ç‚¹çš„çˆ¶çº§èŠ‚ç‚¹
     * @param {String} dependent - ç›®æ ‡èŠ‚ç‚¹çš„çˆ¶çº§èŠ‚ç‚¹çš„å…„å¼Ÿå‚ç…§ç‰©ï¼ˆè·Ÿéšä¸è¶…è¿‡æ­¤å‚ç…§ç‰©ï¼‰
     */
    function FollowMarginTop(target, father, dependent) {
      if (typeof Date.now !== 'function') {
        Date.now = function () {
          return new Date().getTime();
        };
      }

      var namespace = Date.now(), /* äº‹ä»¶å‘½åç©ºé—´ */
        $target = $(target),
        startOffset = $target.offset().top,
        targetMarginTop = parseInt($target.css('margin-top'), 10) || 0,
        prevMarginBottom = parseInt($target.prev().css('margin-bottom'), 10) || 0,
        defaultMarginTop = Math.max(targetMarginTop, prevMarginBottom),
        maxMarginTop = $(dependent).height() - $(father).height() + defaultMarginTop; // jQueryå¯ä»¥ç”¨outerHeight

      $(window).on('scroll' + '.' + namespace, function () {
        var marginTop = $(window).scrollTop() - startOffset + defaultMarginTop;

        if (marginTop > defaultMarginTop) {
          if (marginTop > maxMarginTop) {
            marginTop = maxMarginTop;
          }
        } else {
          marginTop = defaultMarginTop;
        }

        requestAnimationFrame(function () {
          $target.css({ 'margin-top': marginTop });
        });
      });

      this.stop = function () {
        $target.css({ 'margin-top': targetMarginTop });
        $(window).off('scroll' + '.' + namespace);
      };
    }


    /* ä½¿ç”¨æµ‹è¯• */
    var a = new FollowMarginTop('.target', '.father', '.dependent');

    // a.stop();
</script>
```

[CodePen demo](https://codepen.io/realgeoffrey/pen/xvRmov)

#### jQueryå¼¹å‡ºtoast
1. jQuery

```html
<style>
    .æ ·å¼ç±» {
        position: fixed;
        _position: absolute;
        left: 50%;
        top: 50%;
        margin-top: -30px;
        margin-left: -450px;
        width: 900px;
        text-align: center;

        p {
            display: inline-block;
            *display: inline;
            *zoom: 1;
            max-width: 840px;
            _width: 840px;
            padding: 15px 30px;
            line-height: 30px;
            font-size: 14px;
            color: #fff;
            word-wrap: break-word;
            background-color: rgba(0, 0, 0, .7);
            filter: progid:DXImageTransform.Microsoft.Gradient(startColorStr=#70000000, endColorStr=#70000000)\9;
            *zoom: 1;
        }
    }
</style>
<script>
    function alertToast() {
        if ($('.j-pop-toast').length === 0) {
            $('body').append('<div class="j-pop-toast æ ·å¼ç±»" style="display: none;"><p></p></div>');
        }

        var $toast = $('.j-pop-toast'),
            $text = $toast.children('p'),
            self = arguments.callee,
            textArr = [],
            i, text;

        clearTimeout(self.setTimeoutId);

        for (i = 0; i < arguments.length; i++) {
            textArr.push(arguments[i]);
        }

        text = textArr.join('<br>');

        $text.html(text);

        setTimeout(function () {
            $toast.fadeIn(1000);
        }, 0);

        self.setTimeoutId = setTimeout(function () {
            $toast.fadeOut(1000);
        }, 2500);
    }


    /* ä½¿ç”¨æµ‹è¯• */
    alertToast('<span style="color: red;">red</span>', 'å“ˆå“ˆ');
</script>
```
2. Zepto

```html
<style>
    .æ ·å¼ç±» {
        transition: 1s;
        position: fixed;
        left: 50%;
        top: 50%;
        margin-left: rem(-230);
        margin-top: rem(-49);
        width: rem(460);
        text-align: center;

        p {
            display: inline-block;
            max-width: rem(460);    /*box-sizing: border-box;*/
            min-width: rem(166);
            padding: rem(29) rem(30);
            line-height: rem(40);
            font-size: rem(28);
            color: #fff;
            word-wrap: break-word;
            background-color: rgba(0, 0, 0, .7);
            border-radius: rem(4);
        }
        &.z-hidden {
            visibility: hidden;
            opacity: 0;
        }
    }
</style>
<script>
    function alertToast() {
        if ($('.j-pop-toast').length === 0) {
            $('body').append('<div class="j-pop-toast z-hidden æ ·å¼ç±»"><p></p></div>');
        }

        var $toast = $('.j-pop-toast'),
            $text = $toast.children('p'),
            self = arguments.callee,
            textArr = [],
            i, text;

        clearTimeout(self.setTimeoutId);

        for (i = 0; i < arguments.length; i++) {
            textArr.push(arguments[i]);
        }

        text = textArr.join('<br>');

        $text.html(text);

        setTimeout(function () {
            $toast.removeClass('z-hidden');
        }, 0);

        self.setTimeoutId = setTimeout(function () {
            $toast.addClass('z-hidden');
        }, 2500);
    }


    /* ä½¿ç”¨æµ‹è¯• */
    alertToast('<span style="color: red;">red</span>', 'å“ˆå“ˆ');
</script>
```

#### jQueryå…¨é€‰ã€å–æ¶ˆå…¨é€‰
```html
<div id="j-form">
  <label for="all">
    <input id="all" type="checkbox" name="all">
    å…¨é€‰
  </label>

  <br>

  <label for="1">
    <input id="1" type="checkbox" name="ones" value="1">
    1
  </label>
  <label for="2">
    <input id="2" type="checkbox" name="ones" value="2">
    2
  </label>
  <label for="3">
    <input id="3" type="checkbox" name="ones" value="3">
    3
  </label>
  <label for="a">
    <input id="a" type="checkbox" name="ones" value="a">
    a
  </label>
  <label for="b">
    <input id="b" type="checkbox" name="ones" value="b">
    b
  </label>
</div>

<a href="#" id="j-submit">æäº¤</a>

<script>
  var $allInput = $('#j-form').find('[name="all"]')
  var $oneInput = $('#j-form').find('[name="ones"]')

  $allInput.on('click', function () {
    $oneInput.prop('checked', this.checked)
  })

  $oneInput.on('click', function () {
    var flag = true

    $oneInput.each(function () {
      if (!this.checked) {
        flag = false

        return false
      }
    })

    $allInput.prop('checked', flag)
  })

  // æäº¤
  $('#j-submit').on('click', function () {
    var arr = []

    $('#j-form').find('[name="ones"]').each(function (index, item) {
      if (item.checked) {
        arr.push($(item).val())
      }
    })

    var data = arr.join(',')

    console.log(data)
  })
</script>
```

#### jQueryç‚¹å‡»æŒ‡å®šåŒºåŸŸä»¥å¤–æ‰§è¡Œå‡½æ•°
1. jQuery

```js
/**
 * ç‚¹å‡»æŒ‡å®šåŒºåŸŸä»¥å¤–æ‰§è¡Œå‡½æ•°ï¼ˆä¸€æ¬¡æ€§ï¼‰
 * @param {Object} $dom - jQueryèŠ‚ç‚¹
 * @param {Function} callback - å›è°ƒå‡½æ•°
 * @param {Number} [limit] - è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ï¼Œè‹¥æ²¡æœ‰ä¼ æˆ–ä¼ 0åˆ™ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆ
 * @param {String|Number} [namespace = Date.now()] - äº‹ä»¶å‘½åç©ºé—´
 */
function beyongOneAct($dom, callback, limit, namespace) {
    if (typeof Date.now !== 'function') {
        Date.now = function () {
            return new Date().getTime();
        };
    }

    namespace = namespace || Date.now();

    if (limit) {
        setTimeout(function () {
            $(document).off('click.' + namespace);
        }, limit);
    }

    $(document).on('click.' + namespace, function (e) {
        if (!$dom.is(e.target) && $dom.has(e.target).length === 0) {    /* ç‚¹å‡»ä¸åœ¨æŒ‡å®šåŒºåŸŸå†… */
            $(document).off('click.' + namespace);

            if (typeof callback === 'function') {
                callback();
            }
        }
    });
}


/* ä½¿ç”¨æµ‹è¯• */
beyongOneAct(
  $('.dom1,#dom2'),
  function () {
    console.log('ç‚¹å‡»åŒºåŸŸå¤–');
  },
  1000
);
```

[CodePen demo](https://codepen.io/realgeoffrey/pen/WVoLVM)

2. Zepto

```js
/**
 * ç‚¹å‡»æŒ‡å®šåŒºåŸŸä»¥å¤–æ‰§è¡Œå‡½æ•°ï¼ˆä¸€æ¬¡æ€§ï¼‰
 * @param {Object} $dom - jQueryèŠ‚ç‚¹
 * @param {Function} callback - å›è°ƒå‡½æ•°
 * @param {Number} [limit] - è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ï¼Œè‹¥æ²¡æœ‰ä¼ æˆ–ä¼ 0åˆ™ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆ
 * @param {String|Number} [namespace = Date.now()] - äº‹ä»¶å‘½åç©ºé—´
 */
function beyongOneAct($dom, callback, limit, namespace) {
    if (typeof Date.now !== 'function') {
        Date.now = function () {
            return new Date().getTime();
        };
    }

    namespace = namespace || Date.now();

    if (limit) {
        setTimeout(function () {
            $(document.body).off('click.' + namespace);
        }, limit);
    }

    $(document.body).on('click.' + namespace, function (e) {
        var withinArea = false,
            i;

        for (i = 0; i < $dom.length; i++) {
            if ($dom.get(i) === e.target || $dom.eq(i).has(e.target).length !== 0) {
                withinArea = true;
                break;
            }
        }

        if (!withinArea) {    /* ç‚¹å‡»ä¸åœ¨æŒ‡å®šåŒºåŸŸå†… */
            $(document.body).off('click.' + namespace);

            if (typeof callback === 'function') {
                callback();
            }
        }
    });
}


/* ä½¿ç”¨æµ‹è¯• */
beyongOneAct(
  $('.dom1,#dom2'),
  function () {
    console.log('ç‚¹å‡»åŒºåŸŸå¤–');
  },
  1000
);
```

[CodePen demo](https://codepen.io/realgeoffrey/pen/BXQMbq)

#### jQuery hoverå±•ç¤ºå†…å®¹å¹¶ä¸”å¯è·¨è¶Šé—´éš™åˆ°å†…å®¹
```html
<div class="j-box">
    <div class="j-trigger">
        hover
    </div>

    <div class="j-bullet" style="display: none;">
        å±•ç¤ºå†…å®¹
    </div>
</div>

<script type="text/javascript">
    var globalObj = {setTimeoutId: ''};

    $(document).on('mouseenter', '.j-trigger', function () {
        clearTimeout(globalObj.setTimeoutId);

        $(this).closest('.j-box').find('.j-bullet').show();
    }).on('mouseleave', '.j-trigger', function () {
        clearTimeout(globalObj.setTimeoutId);

        globalObj.setTimeoutId = setTimeout(function () {
            $('.j-bullet').hide();
        }, 500);
    }).on('mouseenter', '.j-bullet', function () {
        clearTimeout(globalObj.setTimeoutId);
    }).on('mouseleave', '.j-bullet', function () {
        globalObj.setTimeoutId = setTimeout(function () {
            $('.j-bullet').hide();
        }, 100);
    });
</script>
```

[CodePen demo](https://codepen.io/realgeoffrey/pen/QeGYPP)

#### jQueryå¯åŠ¨ã€æš‚åœCSSåŠ¨ç”»
```html
<style>
    .dom.z-hover {
        animation: func 1s infinite;
    }
    @keyframes func {

    }
</style>

<div class="dom j-dom-1">...</div>
<div class="dom j-dom-2">...</div>

<script>
    /**
     * hoverè§¦å‘animation
     * @constructor
     * @param {String} selector - é€‰æ‹©å™¨
     * @param {String} hoverClass - ç±»å
     */
    function AnimationHover(selector, hoverClass) {
        if (typeof Date.now !== 'function') {
            Date.now = function () {
                return new Date().getTime();
            };
        }

        var _isStop = false, // åœæ­¢åŠ¨ç”»flag
            _namespace = Date.now(), // äº‹ä»¶å‘½åç©ºé—´
            _init = function (selector, hoverClass) {
                $(document).on('mouseenter' + '.' + _namespace, selector, function () {
                    $(this).addClass(hoverClass);

                    _isStop = false;
                }).on('mouseleave' + '.' + _namespace, selector, function () {
                    _isStop = true;
                }).on('animationiteration' + '.' + _namespace, selector, function () {
                    if (_isStop) {
                        $(this).removeClass(hoverClass);

                        _isStop = false;
                    }
                });
            };

        _init(selector, hoverClass);

        this.stop = function () {
            $(selector).removeClass(hoverClass);

            $(document).off('mouseenter' + '.' + _namespace + ' ' + 'mouseleave' + '.' + _namespace + ' ' + 'animationiteration' + '.' + _namespace, selector);
        }
    }


    /* ä½¿ç”¨æµ‹è¯• */
    var a = new AnimationHover('.j-dom-1', 'z-hover');
    var b = new AnimationHover('.j-dom-2', 'z-hover');

    // a.stop;
    // b.stop;
</script>
```

[CodePen demo](https://codepen.io/realgeoffrey/pen/MNbZzB)

#### jQueryè·å–`HTTP response header`ä¿¡æ¯
```js
/**
 * è·å–HTTP response headerä¿¡æ¯
 * @param {String} [requestName] - åè®®å¤´å­—æ®µåï¼›è‹¥ä¸ä¼ å€¼ï¼Œåˆ™è¿”å›å®Œæ•´HTTPå¤´
 * @returns {String|Boolean} text - HTTPå¤´ä¿¡æ¯ æˆ– '' æˆ– false
 */
function getResponseHeaders(requestName) {
    var text = '';

    $.ajax({
        type: 'HEAD',
        url: window.location.href,
        async: false,
        complete: function (xhr, data) {
            var responseHeaders, headerArr, i;

            if (data !== 'error' && data !== 'timeout' && data !== 'parsererror') {
                responseHeaders = xhr.getAllResponseHeaders();

                if (requestName) {
                    requestName += ': ';

                    headerArr = responseHeaders.split(/[\r\n]+/);

                    for (i = 0; i < headerArr.length; i++) {
                        if (headerArr[i].indexOf(requestName) === 0) {
                            text = headerArr[i].slice(requestName.length);

                            break;
                        }
                    }
                } else {
                    text = responseHeaders;
                }
            } else {
                text = false;

                console.log('è·å–å¤´ä¿¡æ¯é”™è¯¯: ' + data);
            }
        }
    });

    return text;
}
```

#### jQueryä¿®å¤HTMLæ ‡ç­¾`placeholder`å±æ€§æ— æ•ˆ
```js
/**
 * ä¿®å¤HTMLæ ‡ç­¾`placeholder`å±æ€§æ— æ•ˆ
 * @param {Object} [$dom = $('input, textarea')] - jQueryèŠ‚ç‚¹
 */
function fixPlaceholder($dom) {
    $dom = $dom || $('input, textarea');

    if (!('placeholder' in document.createElement('input'))) {
        $dom.each(function (index, element) {
            var placeText = $(element).attr('placeholder');

            if ($(element).val() === '') {
                $(element).val(placeText);
            }

            $(this).on('focus', function () {
                if ($(this).val() === placeText) {
                    $(this).val('');
                }
            }).on('blur', function () {
                if ($(this).val() === '') {
                    $(this).val(placeText);
                }
            });
        });
    }
}
```

#### jQueryæ¨¡æ‹Ÿæ‰‹æœºæ—‹è½¬ï¼ˆä½¿é¡µé¢éƒ½ä»¥ã€Œæ¨ªå±ã€å±•ç¤ºï¼‰
```html
<style>
    .dom {
        position: fixed;
        top: 0;
        left: 0;
    }
    .z-reversal {
        top: 50%;
        left: 50%;
        /*margin: 0;*/
        -webkit-transform: translate(-50%, -50%) rotate(90deg);
        transform: translate(-50%, -50%) rotate(90deg);
    }
</style>

<div class="dom" id="j-dom-1">...</div>
<div class="dom" id="j-dom-2">...</div>

<script type="text/javascript">
    /**
     * æ¨ªå±å±•ç¤º
     * @constructor
     * @param {String} selector - é€‰æ‹©å™¨
     * @param {String} className - æ—‹è½¬ç±»
     */
    var ReversalAct = function (selector, className) {
        if (typeof Date.now !== 'function') {
            Date.now = function () {
                return new Date().getTime();
            };
        }

        var _setTimeoutId1 = '',
            _setTimeoutId2 = '',
            _namespace = Date.now(),
            _resizeEvent = 'onorientationchange' in window ? 'orientationchange' : 'resize',
            _portraitFunc = function (selector, className) {    /* å±å¹•é«˜åº¦>å®½åº¦ï¼ˆç«–å±ï¼‰ï¼Œå¢åŠ ã€Œé¡ºæ—¶é’ˆæ—‹è½¬90åº¦çš„ç±»ã€ */
                var $dom = $(selector);

                if ($(window).height() > $(window).width()) {
                    $dom.addClass(className);
                } else {
                    $dom.removeClass(className);
                }
            },
            _resizeFunc = function (selector) {   /* è®¾ç½®é«˜å®½çš„å€¼ï¼ˆè¾¹é•¿è¾ƒé•¿çš„ä¸€è¾¹è®¾ç½®ä¸ºå®½åº¦ï¼Œè¾ƒçŸ­çš„è®¾ç½®ä¸ºé«˜åº¦ï¼‰ */
                var wHeight = $(window).height(),
                    wWidth = $(window).width(),
                    i;

                if (wHeight > wWidth) {
                    i = wHeight;
                    wHeight = wWidth;
                    wWidth = i;
                }

                $(selector).css({'width': wWidth + 'px', 'height': wHeight + 'px'});
            },
            _bindEvent = function (selector, className) {
                $(window).on('resize' + '.' + _namespace, function () {
                    clearTimeout(_setTimeoutId2);

                    _setTimeoutId2 = setTimeout(function () {
                        _resizeFunc(selector);
                    }, 500);
                }).on(_resizeEvent + '.' + _namespace, function () {
                    clearTimeout(_setTimeoutId1);

                    _setTimeoutId1 = setTimeout(function () {
                        _portraitFunc(selector, className);
                    }, 500);
                });
            },
            _init = function (selector, className) {
                _bindEvent(selector, className);
                _resizeFunc(selector);
                _portraitFunc(selector, className);
            };

        _init(selector, className);

        this.stop = function () {
            $(window).off('resize' + '.' + _namespace)
                .off(_resizeEvent + '.' + _namespace);

            $(selector).removeClass(className)
                .removeAttr('style');
        };
    };


    /* ä½¿ç”¨æµ‹è¯• */
    var a = new ReversalAct('#j-dom-1, #j-dom-2', 'z-reversal');

    // a.stop();
</script>
```
>è‹¥å¯¹ä¸æ˜¯å…¨å±çš„èŠ‚ç‚¹ä½¿ç”¨æ—‹è½¬å‡½æ•°ï¼Œåˆ™éœ€è¦ç»™èŠ‚ç‚¹è®¾ç½®ï¼š`width: å®½åº¦ !important;height: auto !important;`ã€‚
